import{r as P,j as s,K as we,m as je,L as ze}from"./app-FQbzxGIw.js";import Ne from"./BreadcrumbsHeader-BKQz8BHC.js";import{D as fe}from"./DropdownInputField-D0XusS6V.js";import{S as pe,r as Se,d as Me,i as _e,T as ie,a as re}from"./transform-ChDKN-R9.js";import{f as ke}from"./index-BtiFw4lQ.js";import ve from"./SidebarModal-DD4dEoye.js";import Te,{personDetailTitle as Re}from"./PersonDetailContent-Bnjnk2Nd.js";import{I as ae}from"./InputError-BKQpvrj7.js";import{I as Z}from"./InputField-DUwBnDWI.js";import{I as oe}from"./InputLabel-BRo6d_Ci.js";import{S as Ee}from"./SelectField-B4xCJfut.js";import{B as ge}from"./button-9tywdtpe.js";import{S as Ce}from"./AdminLayout-D681-fmM.js";import{t as se,T as $e}from"./index-CMTh6Y7Z.js";import{c as Be}from"./createLucideIcon-CbmRPBK-.js";import"./breadcrumb-CZJEnQm8.js";import"./chevron-right-KG4eDgaU.js";import"./sidebar-kMsPs0kt.js";import"./input-BxejiG4V.js";import"./index-D9GFQlD6.js";import"./index-BvtReL5S.js";import"./floating-ui.react-dom-Bv5Tn9NB.js";import"./x-SzE7BJuj.js";import"./skeleton-C5JXX0Vb.js";import"./tooltip-D5qIOJrT.js";import"./clsx-B-dksMZM.js";import"./string-CFFdVFMV.js";import"./iconBase-C4pIma2P.js";import"./index-DPWqtkCr.js";import"./constants-0uClA9D3.js";import"./index-BDSYX5a9.js";import"./nav-user-NQ1-22E_.js";import"./avatar-B4QdFqbk.js";import"./dropdown-menu-Mj4r6j7K.js";import"./check-KP9WahT6.js";import"./useAppUrl-zATTBKeL.js";import"./users-round-fHMLq3qJ.js";import"./chevron-up-D1MoY1rl.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],Ae=Be("workflow",Ie);function q(e){return typeof e=="string"?new pe([[document.querySelector(e)]],[document.documentElement]):new pe([[e]],Se)}function De(e){let n;for(;n=e.sourceEvent;)e=n;return e}function K(e,n){if(e=De(e),n===void 0&&(n=e.currentTarget),n){var i=n.ownerSVGElement||n;if(i.createSVGPoint){var a=i.createSVGPoint();return a.x=e.clientX,a.y=e.clientY,a=a.matrixTransform(n.getScreenCTM().inverse()),[a.x,a.y]}if(n.getBoundingClientRect){var c=n.getBoundingClientRect();return[e.clientX-c.left-n.clientLeft,e.clientY-c.top-n.clientTop]}}return[e.pageX,e.pageY]}const he={capture:!0,passive:!1};function de(e){e.preventDefault(),e.stopImmediatePropagation()}function Oe(e){var n=e.document.documentElement,i=q(e).on("dragstart.drag",de,he);"onselectstart"in n?i.on("selectstart.drag",de,he):(n.__noselect=n.style.MozUserSelect,n.style.MozUserSelect="none")}function Xe(e,n){var i=e.document.documentElement,a=q(e).on("dragstart.drag",null);n&&(a.on("click.drag",de,he),setTimeout(function(){a.on("click.drag",null)},0)),"onselectstart"in i?a.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect)}var Ye=1e-12;function xe(e){return((e=Math.exp(e))+1/e)/2}function Fe(e){return((e=Math.exp(e))-1/e)/2}function Pe(e){return((e=Math.exp(2*e))-1)/(e+1)}const Le=function e(n,i,a){function c(f,d){var _=f[0],C=f[1],o=f[2],v=d[0],x=d[1],u=d[2],S=v-_,N=x-C,T=S*S+N*N,M,m;if(T<Ye)m=Math.log(u/o)/n,M=function(Y){return[_+Y*S,C+Y*N,o*Math.exp(n*Y*m)]};else{var j=Math.sqrt(T),A=(u*u-o*o+a*T)/(2*o*i*j),R=(u*u-o*o-a*T)/(2*u*i*j),$=Math.log(Math.sqrt(A*A+1)-A),O=Math.log(Math.sqrt(R*R+1)-R);m=(O-$)/n,M=function(Y){var w=Y*m,I=xe($),b=o/(i*j)*(I*Pe(n*w+$)-Fe($));return[_+b*S,C+b*N,o*I/xe(n*w+$)]}}return M.duration=m*1e3*n/Math.SQRT2,M}return c.rho=function(f){var d=Math.max(.001,+f),_=d*d,C=_*_;return e(d,_,C)},c}(Math.SQRT2,2,4);function Ve(e){var n=0,i=e.children,a=i&&i.length;if(!a)n=1;else for(;--a>=0;)n+=i[a].value;e.value=n}function We(){return this.eachAfter(Ve)}function He(e,n){let i=-1;for(const a of this)e.call(n,a,++i,this);return this}function Ge(e,n){for(var i=this,a=[i],c,f,d=-1;i=a.pop();)if(e.call(n,i,++d,this),c=i.children)for(f=c.length-1;f>=0;--f)a.push(c[f]);return this}function qe(e,n){for(var i=this,a=[i],c=[],f,d,_,C=-1;i=a.pop();)if(c.push(i),f=i.children)for(d=0,_=f.length;d<_;++d)a.push(f[d]);for(;i=c.pop();)e.call(n,i,++C,this);return this}function Ke(e,n){let i=-1;for(const a of this)if(e.call(n,a,++i,this))return a}function Ue(e){return this.eachAfter(function(n){for(var i=+e(n.data)||0,a=n.children,c=a&&a.length;--c>=0;)i+=a[c].value;n.value=i})}function Qe(e){return this.eachBefore(function(n){n.children&&n.children.sort(e)})}function Ze(e){for(var n=this,i=Je(n,e),a=[n];n!==i;)n=n.parent,a.push(n);for(var c=a.length;e!==i;)a.splice(c,0,e),e=e.parent;return a}function Je(e,n){if(e===n)return e;var i=e.ancestors(),a=n.ancestors(),c=null;for(e=i.pop(),n=a.pop();e===n;)c=e,e=i.pop(),n=a.pop();return c}function et(){for(var e=this,n=[e];e=e.parent;)n.push(e);return n}function tt(){return Array.from(this)}function nt(){var e=[];return this.eachBefore(function(n){n.children||e.push(n)}),e}function it(){var e=this,n=[];return e.each(function(i){i!==e&&n.push({source:i.parent,target:i})}),n}function*rt(){var e=this,n,i=[e],a,c,f;do for(n=i.reverse(),i=[];e=n.pop();)if(yield e,a=e.children)for(c=0,f=a.length;c<f;++c)i.push(a[c]);while(i.length)}function me(e,n){e instanceof Map?(e=[void 0,e],n===void 0&&(n=st)):n===void 0&&(n=ot);for(var i=new Q(e),a,c=[i],f,d,_,C;a=c.pop();)if((d=n(a.data))&&(C=(d=Array.from(d)).length))for(a.children=d,_=C-1;_>=0;--_)c.push(f=d[_]=new Q(d[_])),f.parent=a,f.depth=a.depth+1;return i.eachBefore(ct)}function at(){return me(this).eachBefore(lt)}function ot(e){return e.children}function st(e){return Array.isArray(e)?e[1]:null}function lt(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function ct(e){var n=0;do e.height=n;while((e=e.parent)&&e.height<++n)}function Q(e){this.data=e,this.depth=this.height=0,this.parent=null}Q.prototype=me.prototype={constructor:Q,count:We,each:He,eachAfter:qe,eachBefore:Ge,find:Ke,sum:Ue,sort:Qe,path:Ze,ancestors:et,descendants:tt,leaves:nt,links:it,copy:at,[Symbol.iterator]:rt};function ut(e,n){return e.parent===n.parent?1:2}function le(e){var n=e.children;return n?n[0]:e.t}function ce(e){var n=e.children;return n?n[n.length-1]:e.t}function ht(e,n,i){var a=i/(n.i-e.i);n.c-=a,n.s+=i,e.c+=a,n.z+=i,n.m+=i}function dt(e){for(var n=0,i=0,a=e.children,c=a.length,f;--c>=0;)f=a[c],f.z+=n,f.m+=n,n+=f.s+(i+=f.c)}function mt(e,n,i){return e.a.parent===n.parent?e.a:i}function te(e,n){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=n}te.prototype=Object.create(Q.prototype);function ft(e){for(var n=new te(e,0),i,a=[n],c,f,d,_;i=a.pop();)if(f=i._.children)for(i.children=new Array(_=f.length),d=_-1;d>=0;--d)a.push(c=i.children[d]=new te(f[d],d)),c.parent=i;return(n.parent=new te(null,0)).children=[n],n}function pt(){var e=ut,n=1,i=1,a=null;function c(o){var v=ft(o);if(v.eachAfter(f),v.parent.m=-v.z,v.eachBefore(d),a)o.eachBefore(C);else{var x=o,u=o,S=o;o.eachBefore(function(j){j.x<x.x&&(x=j),j.x>u.x&&(u=j),j.depth>S.depth&&(S=j)});var N=x===u?1:e(x,u)/2,T=N-x.x,M=n/(u.x+N+T),m=i/(S.depth||1);o.eachBefore(function(j){j.x=(j.x+T)*M,j.y=j.depth*m})}return o}function f(o){var v=o.children,x=o.parent.children,u=o.i?x[o.i-1]:null;if(v){dt(o);var S=(v[0].z+v[v.length-1].z)/2;u?(o.z=u.z+e(o._,u._),o.m=o.z-S):o.z=S}else u&&(o.z=u.z+e(o._,u._));o.parent.A=_(o,u,o.parent.A||x[0])}function d(o){o._.x=o.z+o.parent.m,o.m+=o.parent.m}function _(o,v,x){if(v){for(var u=o,S=o,N=v,T=u.parent.children[0],M=u.m,m=S.m,j=N.m,A=T.m,R;N=ce(N),u=le(u),N&&u;)T=le(T),S=ce(S),S.a=o,R=N.z+j-u.z-M+e(N._,u._),R>0&&(ht(mt(N,o,x),o,R),M+=R,m+=R),j+=N.m,M+=u.m,A+=T.m,m+=S.m;N&&!ce(S)&&(S.t=N,S.m+=j-m),u&&!le(T)&&(T.t=u,T.m+=M-A,x=o)}return x}function C(o){o.x*=n,o.y=o.depth*i}return c.separation=function(o){return arguments.length?(e=o,c):e},c.size=function(o){return arguments.length?(a=!1,n=+o[0],i=+o[1],c):a?null:[n,i]},c.nodeSize=function(o){return arguments.length?(a=!0,n=+o[0],i=+o[1],c):a?[n,i]:null},c}const J=e=>()=>e;function gt(e,{sourceEvent:n,target:i,transform:a,dispatch:c}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},transform:{value:a,enumerable:!0,configurable:!0},_:{value:c}})}function ue(e){e.stopImmediatePropagation()}function U(e){e.preventDefault(),e.stopImmediatePropagation()}function xt(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function yt(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function ye(){return this.__zoom||_e}function bt(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function _t(){return navigator.maxTouchPoints||"ontouchstart"in this}function vt(e,n,i){var a=e.invertX(n[0][0])-i[0][0],c=e.invertX(n[1][0])-i[1][0],f=e.invertY(n[0][1])-i[0][1],d=e.invertY(n[1][1])-i[1][1];return e.translate(c>a?(a+c)/2:Math.min(0,a)||Math.max(0,c),d>f?(f+d)/2:Math.min(0,f)||Math.max(0,d))}function wt(){var e=xt,n=yt,i=vt,a=bt,c=_t,f=[0,1/0],d=[[-1/0,-1/0],[1/0,1/0]],_=250,C=Le,o=Me("start","zoom","end"),v,x,u,S=500,N=150,T=0,M=10;function m(t){t.property("__zoom",ye).on("wheel.zoom",w,{passive:!1}).on("mousedown.zoom",I).on("dblclick.zoom",b).filter(c).on("touchstart.zoom",z).on("touchmove.zoom",B).on("touchend.zoom touchcancel.zoom",D).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}m.transform=function(t,l,r,h){var p=t.selection?t.selection():t;p.property("__zoom",ye),t!==p?$(t,l,r,h):p.interrupt().each(function(){O(this,arguments).event(h).start().zoom(null,typeof l=="function"?l.apply(this,arguments):l).end()})},m.scaleBy=function(t,l,r,h){m.scaleTo(t,function(){var p=this.__zoom.k,g=typeof l=="function"?l.apply(this,arguments):l;return p*g},r,h)},m.scaleTo=function(t,l,r,h){m.transform(t,function(){var p=n.apply(this,arguments),g=this.__zoom,y=r==null?R(p):typeof r=="function"?r.apply(this,arguments):r,k=g.invert(y),E=typeof l=="function"?l.apply(this,arguments):l;return i(A(j(g,E),y,k),p,d)},r,h)},m.translateBy=function(t,l,r,h){m.transform(t,function(){return i(this.__zoom.translate(typeof l=="function"?l.apply(this,arguments):l,typeof r=="function"?r.apply(this,arguments):r),n.apply(this,arguments),d)},null,h)},m.translateTo=function(t,l,r,h,p){m.transform(t,function(){var g=n.apply(this,arguments),y=this.__zoom,k=h==null?R(g):typeof h=="function"?h.apply(this,arguments):h;return i(_e.translate(k[0],k[1]).scale(y.k).translate(typeof l=="function"?-l.apply(this,arguments):-l,typeof r=="function"?-r.apply(this,arguments):-r),g,d)},h,p)};function j(t,l){return l=Math.max(f[0],Math.min(f[1],l)),l===t.k?t:new ie(l,t.x,t.y)}function A(t,l,r){var h=l[0]-r[0]*t.k,p=l[1]-r[1]*t.k;return h===t.x&&p===t.y?t:new ie(t.k,h,p)}function R(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function $(t,l,r,h){t.on("start.zoom",function(){O(this,arguments).event(h).start()}).on("interrupt.zoom end.zoom",function(){O(this,arguments).event(h).end()}).tween("zoom",function(){var p=this,g=arguments,y=O(p,g).event(h),k=n.apply(p,g),E=r==null?R(k):typeof r=="function"?r.apply(p,g):r,F=Math.max(k[1][0]-k[0][0],k[1][1]-k[0][1]),X=p.__zoom,V=typeof l=="function"?l.apply(p,g):l,H=C(X.invert(E).concat(F/X.k),V.invert(E).concat(F/V.k));return function(W){if(W===1)W=V;else{var G=H(W),ne=F/G[2];W=new ie(ne,E[0]-G[0]*ne,E[1]-G[1]*ne)}y.zoom(null,W)}})}function O(t,l,r){return!r&&t.__zooming||new Y(t,l)}function Y(t,l){this.that=t,this.args=l,this.active=0,this.sourceEvent=null,this.extent=n.apply(t,l),this.taps=0}Y.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,l){return this.mouse&&t!=="mouse"&&(this.mouse[1]=l.invert(this.mouse[0])),this.touch0&&t!=="touch"&&(this.touch0[1]=l.invert(this.touch0[0])),this.touch1&&t!=="touch"&&(this.touch1[1]=l.invert(this.touch1[0])),this.that.__zoom=l,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var l=q(this.that).datum();o.call(t,this.that,new gt(t,{sourceEvent:this.sourceEvent,target:m,transform:this.that.__zoom,dispatch:o}),l)}};function w(t,...l){if(!e.apply(this,arguments))return;var r=O(this,l).event(t),h=this.__zoom,p=Math.max(f[0],Math.min(f[1],h.k*Math.pow(2,a.apply(this,arguments)))),g=K(t);if(r.wheel)(r.mouse[0][0]!==g[0]||r.mouse[0][1]!==g[1])&&(r.mouse[1]=h.invert(r.mouse[0]=g)),clearTimeout(r.wheel);else{if(h.k===p)return;r.mouse=[g,h.invert(g)],re(this),r.start()}U(t),r.wheel=setTimeout(y,N),r.zoom("mouse",i(A(j(h,p),r.mouse[0],r.mouse[1]),r.extent,d));function y(){r.wheel=null,r.end()}}function I(t,...l){if(u||!e.apply(this,arguments))return;var r=t.currentTarget,h=O(this,l,!0).event(t),p=q(t.view).on("mousemove.zoom",E,!0).on("mouseup.zoom",F,!0),g=K(t,r),y=t.clientX,k=t.clientY;Oe(t.view),ue(t),h.mouse=[g,this.__zoom.invert(g)],re(this),h.start();function E(X){if(U(X),!h.moved){var V=X.clientX-y,H=X.clientY-k;h.moved=V*V+H*H>T}h.event(X).zoom("mouse",i(A(h.that.__zoom,h.mouse[0]=K(X,r),h.mouse[1]),h.extent,d))}function F(X){p.on("mousemove.zoom mouseup.zoom",null),Xe(X.view,h.moved),U(X),h.event(X).end()}}function b(t,...l){if(e.apply(this,arguments)){var r=this.__zoom,h=K(t.changedTouches?t.changedTouches[0]:t,this),p=r.invert(h),g=r.k*(t.shiftKey?.5:2),y=i(A(j(r,g),h,p),n.apply(this,l),d);U(t),_>0?q(this).transition().duration(_).call($,y,h,t):q(this).call(m.transform,y,h,t)}}function z(t,...l){if(e.apply(this,arguments)){var r=t.touches,h=r.length,p=O(this,l,t.changedTouches.length===h).event(t),g,y,k,E;for(ue(t),y=0;y<h;++y)k=r[y],E=K(k,this),E=[E,this.__zoom.invert(E),k.identifier],p.touch0?!p.touch1&&p.touch0[2]!==E[2]&&(p.touch1=E,p.taps=0):(p.touch0=E,g=!0,p.taps=1+!!v);v&&(v=clearTimeout(v)),g&&(p.taps<2&&(x=E[0],v=setTimeout(function(){v=null},S)),re(this),p.start())}}function B(t,...l){if(this.__zooming){var r=O(this,l).event(t),h=t.changedTouches,p=h.length,g,y,k,E;for(U(t),g=0;g<p;++g)y=h[g],k=K(y,this),r.touch0&&r.touch0[2]===y.identifier?r.touch0[0]=k:r.touch1&&r.touch1[2]===y.identifier&&(r.touch1[0]=k);if(y=r.that.__zoom,r.touch1){var F=r.touch0[0],X=r.touch0[1],V=r.touch1[0],H=r.touch1[1],W=(W=V[0]-F[0])*W+(W=V[1]-F[1])*W,G=(G=H[0]-X[0])*G+(G=H[1]-X[1])*G;y=j(y,Math.sqrt(W/G)),k=[(F[0]+V[0])/2,(F[1]+V[1])/2],E=[(X[0]+H[0])/2,(X[1]+H[1])/2]}else if(r.touch0)k=r.touch0[0],E=r.touch0[1];else return;r.zoom("touch",i(A(y,k,E),r.extent,d))}}function D(t,...l){if(this.__zooming){var r=O(this,l).event(t),h=t.changedTouches,p=h.length,g,y;for(ue(t),u&&clearTimeout(u),u=setTimeout(function(){u=null},S),g=0;g<p;++g)y=h[g],r.touch0&&r.touch0[2]===y.identifier?delete r.touch0:r.touch1&&r.touch1[2]===y.identifier&&delete r.touch1;if(r.touch1&&!r.touch0&&(r.touch0=r.touch1,delete r.touch1),r.touch0)r.touch0[1]=this.__zoom.invert(r.touch0[0]);else if(r.end(),r.taps===2&&(y=K(y,this),Math.hypot(x[0]-y[0],x[1]-y[1])<M)){var k=q(this).on("dblclick.zoom");k&&k.apply(this,arguments)}}}return m.wheelDelta=function(t){return arguments.length?(a=typeof t=="function"?t:J(+t),m):a},m.filter=function(t){return arguments.length?(e=typeof t=="function"?t:J(!!t),m):e},m.touchable=function(t){return arguments.length?(c=typeof t=="function"?t:J(!!t),m):c},m.extent=function(t){return arguments.length?(n=typeof t=="function"?t:J([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),m):n},m.scaleExtent=function(t){return arguments.length?(f[0]=+t[0],f[1]=+t[1],m):[f[0],f[1]]},m.translateExtent=function(t){return arguments.length?(d[0][0]=+t[0][0],d[1][0]=+t[1][0],d[0][1]=+t[0][1],d[1][1]=+t[1][1],m):[[d[0][0],d[0][1]],[d[1][0],d[1][1]]]},m.constrain=function(t){return arguments.length?(i=t,m):i},m.duration=function(t){return arguments.length?(_=+t,m):_},m.interpolate=function(t){return arguments.length?(C=t,m):C},m.on=function(){var t=o.on.apply(o,arguments);return t===o?m:t},m.clickDistance=function(t){return arguments.length?(T=(t=+t)*t,m):Math.sqrt(T)},m.tapDistance=function(t){return arguments.length?(M=+t,m):M},m}const be=({x:e,y:n,person:i,relation:a,onViewDetail:c})=>{const f=P.useRef(null),[d,_]=P.useState(!1);P.useEffect(()=>{const o=f.current;_(o&&o.scrollWidth>o.clientWidth)},[i]);const C=d?"text-xs":"text-sm";return s.jsx("foreignObject",{x:e,y:n,width:260,height:150,children:s.jsx("div",{className:`bg-white rounded-xl shadow-md border p-3 w-[240px] text-sm transition-all duration-200 hover:shadow-lg hover:border-2
        ${a==="Self"?"border-blue-400":"border-gray-300"}`,children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx("img",{src:(i==null?void 0:i.resident_picture_path)==null?"/images/default-avatar.jpg":`/storage/${i.resident_picture_path}`,alt:`${i==null?void 0:i.firstname}'s photo`,className:"w-14 h-14 rounded-full object-cover border"}),s.jsxs("div",{className:"flex-1 space-y-1",children:[s.jsxs("p",{ref:f,className:`m-0 leading-tight font-medium whitespace-nowrap overflow-hidden ${C}`,children:[i==null?void 0:i.lastname,", ",i==null?void 0:i.firstname," ",i!=null&&i.middlename?i.middlename.charAt(0)+". ":"",(i==null?void 0:i.suffix)??""]}),s.jsx("h2",{className:"m-0 font-semibold text-gray-800",children:a}),s.jsxs("button",{onClick:()=>c({...i,relation:a}),className:"m-0 p-0 text-xs text-blue-500 hover:underline flex items-center space-x-1",children:[s.jsx(ke,{className:"text-base"}),s.jsx("span",{children:"View details"})]})]})]})})})};function jt(e){var x,u,S,N,T;const n=(x=e.self)==null?void 0:x.data,i=((u=e.spouse)==null?void 0:u.data)||[],a=((S=e.siblings)==null?void 0:S.data)||[],c=((N=e.children)==null?void 0:N.data)||[],f=((T=e.parents)==null?void 0:T.data)||[],d={id:"virtual-root",relation:"Root",children:[]},_={...n,id:`self-${n.id}`,relation:"Self",children:[]},C=a.map(M=>({...M,id:`sibling-${M.id}`,relation:"Sibling",children:[]})),o=c.map(M=>{const m=[n==null?void 0:n.id,...i.map(j=>j.id)].filter(Boolean);return{...M,id:`child-${M.id}`,relation:"Child",children:[],parents:m}});let v;if(i.length>0){const M=i.map(m=>({...m,id:`spouse-${m.id}`,relation:"Spouse",children:[]}));v={id:`couple-${n.id}`,isCouple:!0,relation:"Couple",children:o,members:[_,...M]}}else v={..._,children:o};if(f.length>0){const M=f.map(j=>({...j,id:`parent-${j.id}`,relation:"Parent",children:[]})),m={id:`couple-parents-${n.id}`,isCouple:!0,relation:"ParentCouple",members:M,children:[v,...C]};d.children.push(m)}else d.children.push(v,...C);return d}const L=240,ee=90,zt=({familyData:e})=>{const n=P.useRef(),[i,a]=P.useState([]),[c,f]=P.useState([]),[d,_]=P.useState(!1),[C,o]=P.useState(null),v=x=>{o(x),_(!0)};return P.useEffect(()=>{const x=jt(e),u=me(x);pt().nodeSize([350,180])(u);const N=u.descendants(),T=Math.min(...N.map(w=>w.y)),M=Math.max(...N.map(w=>w.y)),m=600,j=1200,A=(m-(M-T))/2,R=[];u.descendants().forEach(w=>{var z;const I=w.x+j,b=w.y+A;if(w.data.isCouple&&((z=w.data.members)==null?void 0:z.length)>=1){const B=w.data.members,D=L+130;if(B.length===1)R.push({...B[0],x:I,y:b,relation:B[0].relation||"Relative",id:B[0].id});else{const t=B.find(r=>r.relation==="Self"),l=B.filter(r=>r.relation==="Spouse");if(t)t._x=I,R.push({...t,x:I,y:b,relation:"Self",id:t.id}),l.forEach((r,h)=>{const p=h%2===0?-1:1,g=Math.ceil((h+1)/2),y=I+p*D*g;R.push({...r,x:y,y:b,relation:"Spouse",id:r.id})});else{const r=Math.floor(B.length/2);B.forEach((h,p)=>{const g=(p-r)*D;R.push({...h,x:I+g,y:b,relation:h.relation||"Relative",id:h.id})})}}}else w.data.id!=="virtual-root"&&R.push({...w.data,x:I-L/2-65,y:b,relation:w.data.relation||"Relative",id:w.data.id})}),a(R);const $=[];u.descendants().forEach(w=>{var I,b;if(w.data.isCouple&&((I=w.data.members)==null?void 0:I.length)>=1){const z=w.y+A,D=w.data.members.map(t=>R.find(l=>l.id===t.id)).filter(Boolean);for(let t=0;t<D.length-1;t++)$.push({from:{x:D[t].x+L/2,y:D[t].y+ee/2},to:{x:D[t+1].x+L/2,y:D[t+1].y+ee/2}});if(((b=w.children)==null?void 0:b.length)>0){const t=w.children.map(g=>R.find(y=>y.id===g.data.id)).filter(Boolean);if(t.length===0)return;const l=D.map(g=>g.x+L/2),r=(Math.min(...l)+Math.max(...l))/2,h=z+ee/2,p=h+90;if($.push({from:{x:r,y:h},to:{x:r,y:p}}),t.length===1){const g=t[0],y=g.x+L/2;$.push({from:{x:r,y:p},to:{x:y,y:g.y}})}else{const g=t.map(E=>E.x+L/2),y=Math.min(...g),k=Math.max(...g);$.push({from:{x:y,y:p},to:{x:k,y:p}}),t.forEach(E=>{const F=E.x+L/2;$.push({from:{x:F,y:p},to:{x:F,y:E.y}})})}}}}),u.descendants().forEach(w=>{var I;if(!w.data.isCouple&&((I=w.children)==null?void 0:I.length)>0){const b=R.find(l=>l.id===w.data.id);if(!b)return;const z=b.x+L/2,B=b.y+ee/2,D=B+90,t=w.children.map(l=>R.find(r=>r.id===l.data.id)).filter(Boolean);if(t.length===1){const l=t[0],r=l.x+L/2;$.push({from:{x:z,y:B},to:{x:r,y:l.y}})}else if(t.length>1){$.push({from:{x:z,y:B},to:{x:z,y:D}});const l=t.map(p=>p.x+L/2),r=Math.min(...l),h=Math.max(...l);$.push({from:{x:r,y:D},to:{x:h,y:D}}),t.forEach(p=>{const g=p.x+L/2;$.push({from:{x:g,y:D},to:{x:g,y:p.y}})})}}}),f($);const O=q(n.current),Y=O.select("g");O.call(wt().scaleExtent([.3,2]).on("zoom",w=>{Y.attr("transform",w.transform)}))},[e]),s.jsxs("div",{className:"w-full border rounded-lg bg-dot-grid",children:[s.jsx("div",{className:"overflow-auto max-h-[600px] max-w-full rounded-lg",children:s.jsx("svg",{ref:n,width:1100,height:1e3,viewBox:"0 0 2000 2000",className:"block",children:s.jsxs("g",{children:[c.map((x,u)=>s.jsx("line",{x1:x.from.x,y1:x.from.y,x2:x.to.x,y2:x.to.y,stroke:"#1E40AF",strokeWidth:2},`line-${u}`)),i.map((x,u)=>s.jsx(be,{x:x.x,y:x.y,person:x,relation:x.relation},u)),i.map((x,u)=>s.jsx(be,{x:x.x,y:x.y,person:x,relation:x.relation,onViewDetail:v},u))]})})}),s.jsx(ve,{isOpen:d,onClose:()=>_(!1),title:Re,children:s.jsx(Te,{person:C})})]})};function un({family_tree:e,residents:n}){var O,Y,w,I;const i=((w=(Y=(O=e==null?void 0:e.self)==null?void 0:O.data)==null?void 0:Y.family)==null?void 0:w.family_name)||"Unnamed",a=[{label:"Residents Information",showOnMobile:!1},{label:"Residents Table",href:route("resident.index"),showOnMobile:!1},{label:"Family Tree",showOnMobile:!0}],c=we().props,f=(c==null?void 0:c.success)??null,d=(c==null?void 0:c.error)??null,_=n.map(b=>({value:b.id,label:`${b.firstname} ${b.middlename} ${b.lastname} ${b.suffix??""}`,image:b.resident_picture_path||null,birthdate:b.birthdate||null,purok_number:b.purok_number||null})),[C,o]=P.useState(!1),v=((I=e==null?void 0:e.self)==null?void 0:I.data)||null,{data:x,setData:u,post:S,errors:N,reset:T,clearErrors:M}=je({resident_id:null,related_to:null,relationship:"",family_relation_id:null,_method:void 0}),m=()=>{v&&u({resident_id:v.id,resident_id_name:`${v.firstname} ${v.middlename} ${v.lastname}`,resident_birthdate:v.birthdate,resident_image:v.resident_picture_path,resident_purok:v.purok_number,related_to:null,related_to_name:"",related_to_birthdate:null,related_to_image:null,related_to_purok:null,relationship:""}),o(!0)},j=b=>{b.preventDefault(),S(route("family_tree.store"),{onError:z=>{const B=Object.values(z).map((D,t)=>`<div key=${t}> ${D}</div>`);se.error("Validation Error",{description:s.jsx("div",{dangerouslySetInnerHTML:{__html:B.join("")}}),duration:4e3,closeButton:!0})}})},A=()=>{o(!1),T(),M()},R=(b,z)=>{z&&(u(`${b}`,z.value||z.id),u(`${b}_name`,z.label||`${z.firstname} ${z.middlename} ${z.lastname}`),u(`${b}_image`,z.image||null),u(`${b}_birthdate`,z.birthdate||null),u(`${b}_purok`,z.purok_number||null))},$=b=>{const z=_.find(B=>B.value==b);R("related_to",z)};return P.useEffect(()=>{f&&(A(),se.success(f,{description:"Operation successful!",duration:3e3,closeButton:!0})),c.success=null},[f]),P.useEffect(()=>{d&&(se.error(d,{description:"Operation failed!",duration:3e3,closeButton:!0}),A()),c.error=null},[d]),s.jsxs(Ce,{children:[s.jsx(ze,{title:"Resident Dashboard"}),s.jsx(Ne,{breadcrumbs:a}),s.jsx($e,{richColors:!0}),s.jsx(s.Fragment,{children:s.jsxs("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:[s.jsxs("div",{className:"overflow-hidden bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 my-8",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("h2",{className:"text-xl font-bold mb-3",children:[i," Family Tree"]}),s.jsxs("div",{className:"relative group z-5 mr-4",children:[s.jsx(ge,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",onClick:m,children:s.jsx(Ae,{})}),s.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add A Relation"})]})]}),s.jsx("div",{className:"h-[600px] w-full",children:s.jsx(zt,{familyData:e})})]}),s.jsxs(P.Suspense,{fallback:null,children:[" ",s.jsx(ve,{isOpen:C,onClose:()=>A(),title:"Add a Relationship to the Tree",children:s.jsx("div",{className:"w-full rounded-xl border border-white/20 bg-white/10 backdrop-blur-md shadow-lg text-sm text-black p-4 space-y-4",children:s.jsxs("form",{className:"space-y-8 bg-white p-6 rounded-xl shadow-md border border-gray-200",onSubmit:j,children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Add Family Relation"}),s.jsx("p",{className:"text-gray-600 text-sm",children:"Define the relationship between residents in the household. This helps maintain a proper family tree and household hierarchy."})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Resident Info"}),s.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"Select the primary resident. Their basic details will auto-populate."}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 md:gap-x-6",children:[s.jsxs("div",{className:"md:row-span-2 md:col-span-2 flex flex-col items-center space-y-2",children:[s.jsx(oe,{htmlFor:"resident_image",value:"Resident Profile"}),s.jsx("img",{src:x.resident_image?`/storage/${x.resident_image}`:"/images/default-avatar.jpg",alt:"Resident",className:"w-32 h-32 object-cover rounded-full border border-gray-200 shadow-sm"})]}),s.jsxs("div",{className:"md:col-span-4 space-y-4",children:[s.jsx(fe,{label:"Resident",name:"resident_id_name",value:x.resident_id_name||"",placeholder:"Select a resident",items:_,onChange:b=>{const z=_.find(B=>B.id===b);z&&(u("resident_id",z.id),u("resident_id_name",z.name),u("resident_image",z.image),u("resident_birthdate",z.birthdate),u("resident_purok",z.purok_number))},disabled:!0}),s.jsx(ae,{message:N.resident_id,className:"mt-1 text-sm text-red-500"}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsx(Z,{label:"Birthdate",name:"resident_birthdate",value:x.resident_birthdate||"",readOnly:!0}),s.jsx(Z,{label:"Purok Number",name:"resident_purok",value:x.resident_purok||"",readOnly:!0})]})]})]})]}),s.jsxs("div",{className:"space-y-4 mt-6",children:[s.jsx("h4",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Related Resident Info"}),s.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"Select the related resident and specify their relationship to the primary resident."}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 md:gap-x-6",children:[s.jsxs("div",{className:"md:row-span-2 md:col-span-2 flex flex-col items-center space-y-2",children:[s.jsx(oe,{htmlFor:"related_to_image",value:"Related Resident Profile"}),s.jsx("img",{src:x.related_to_image?`/storage/${x.related_to_image}`:"/images/default-avatar.jpg",alt:"Related Resident",className:"w-32 h-32 object-cover rounded-full border border-gray-200 shadow-sm"})]}),s.jsxs("div",{className:"md:col-span-4 space-y-4",children:[s.jsx(fe,{label:"Related To",name:"related_to_name",value:x.related_to_name||"",placeholder:"Select related resident",items:_,onChange:b=>{$(b.target.value)}}),s.jsx(ae,{message:N.related_to,className:"mt-1 text-sm text-red-500"}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsx(Z,{label:"Birthdate",name:"related_to_birthdate",value:x.related_to_birthdate||"",readOnly:!0}),s.jsx(Z,{label:"Purok Number",name:"related_to_purok",value:x.related_to_purok||"",readOnly:!0})]})]})]})]}),s.jsxs("div",{className:"mt-6",children:[s.jsx(oe,{value:"Relationship Type"}),s.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"Select the type of relationship between the primary resident and the related resident."}),s.jsx(Ee,{label:"Relationship",name:"relationship",value:x.relationship,onChange:b=>u("relationship",b.target.value),placeholder:"Select relationship",items:[{label:"Spouse",value:"spouse",subtitle:"Legally married partner of the head"},{label:"Child",value:"child",subtitle:"Son or daughter of the head"},{label:"Sibling",value:"sibling",subtitle:"Brother or sister of the head"},{label:"Parent",value:"parent",subtitle:"Father or mother of the head"}]}),s.jsx(ae,{message:N.relationship,className:"mt-1 text-sm text-red-500"})]}),s.jsx("div",{className:"flex justify-end mt-8",children:s.jsx(ge,{className:"bg-blue-700 hover:bg-blue-600 text-white px-6 py-2 rounded-lg shadow-md transition-all duration-200 ease-in-out",type:"submit",children:"Add Relation"})})]})})})]})]})})]})}export{un as default};
