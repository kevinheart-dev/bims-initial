import{r,K as ce,m as de,j as e,S as ue,a as P}from"./app-OMiIBAVv.js";import pe from"./DynamicTable-UkXv7no2.js";import{u as xe}from"./useAppUrl-D_iSPAaw.js";import{S as U}from"./skeleton-B3ns0wAt.js";import{u as ye}from"./useQuery-CCzURwkj.js";import ge from"./ActionMenu-BwZQbtv1.js";import he from"./DynamicTableControls-D0m5fsZs.js";import{I as ve}from"./input-BGuCCM3F.js";import{B as j}from"./button-DSR4zr8t.js";import{F as be}from"./FillterToggle-DNCt5F0M.js";import{I as x}from"./InputField-BN9Kcp6u.js";import{I as n}from"./InputError-LtgWhWIb.js";import{D as je}from"./DropdownInputField-BkfrznIy.js";import{I as fe,a as _e,b as Ne}from"./index-CK7UpZTr.js";import Se from"./SidebarModal-BhCVnGdX.js";import"./textarea-Cw2TG8Ij.js";import{t as y,T as we}from"./index-0Qv22I-m.js";import{S as Ce}from"./SelectField-0PSr83-z.js";import ke from"./DeleteConfirmationModal-TJ1uBlKB.js";import{S as Ee}from"./search-B5GIhMYd.js";import{L as Ie}from"./list-plus-BMoEcxBa.js";import{R as De}from"./rotate-ccw-X1iZFrTN.js";import{S as Oe}from"./square-pen-CIUQNKLN.js";import{T as qe}from"./trash-2-jR1sYQPd.js";import"./createLucideIcon-Axl_0YCz.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./dropdown-menu-Bvu9yf_7.js";import"./index-CI6SsBKC.js";import"./index-BLQZ4u8d.js";import"./floating-ui.react-dom-CMRH_ZRG.js";import"./check-CuPlmUjy.js";import"./chevron-right-Cy23RFOt.js";import"./tooltip-DovJGv4D.js";import"./ellipsis-PuzZ1_TO.js";import"./chevron-up-aIKK6lnp.js";import"./constants-iESbBslm.js";import"./iconBase-DPQdzrdi.js";import"./x-CWRGpm6F.js";const vt=()=>{const I=xe(),[B,f]=r.useState(!1),[V,_]=r.useState(""),[c,D]=r.useState(null),g=ce().props,N=(g==null?void 0:g.error)??null,[d,O]=r.useState({}),[q,A]=r.useState(d.name??""),[Q,S]=r.useState(!1),[F,H]=r.useState(null),{data:m,isLoading:K,isError:z,error:G,refetch:w}=ye({queryKey:["inventory_items",d],queryFn:async()=>{const{data:t}=await P.get(`${I}/inventory`,{params:d});return t},keepPreviousData:!0,staleTime:1e3*60*5}),T=m==null?void 0:m.inventory_items,J=m==null?void 0:m.categories,C=[{key:"id",label:"ID"},{key:"item_name",label:"Item"},{key:"item_category",label:"Category"},{key:"quantity",label:"Quantity"},{key:"unit",label:"Unit"},{key:"status",label:"Status"},{key:"received_date",label:"Date Recieved"},{key:"supplier",label:"Supplier"},{key:"actions",label:"Actions"}],W=C.map(t=>t.key),[h,X]=r.useState(()=>{const t=localStorage.getItem("inventory_visible_columns");return t?JSON.parse(t):W}),k=Object.entries(d||{}).some(([t,s])=>["inventory_status","item_category","date_recieved"].includes(t)&&s&&s!==""),[M,R]=r.useState(k);r.useEffect(()=>{k&&R(!0)},[k]),r.useEffect(()=>{localStorage.setItem("inventory_visible_columns",JSON.stringify(h))},[h]);const Y=t=>{t.preventDefault(),E("name",q)},E=(t,s)=>{O(a=>{const i={...a};return s&&s.trim()!==""?i[t]=s:delete i[t],delete i.page,i})},Z=(t,s)=>{s.key==="Enter"&&E(t,s.target.value)},ee={id:t=>t.id,item_name:t=>e.jsx("span",{className:"font-medium text-gray-900",children:t.item_name||"—"}),item_category:t=>e.jsx("span",{className:"text-sm text-gray-700",children:t.item_category||"—"}),quantity:t=>e.jsx("span",{className:"text-sm text-gray-700",children:t.quantity??"—"}),year_established:t=>e.jsx("span",{className:"text-sm text-gray-700",children:t.year_established||"—"}),unit:t=>e.jsx("span",{className:"text-sm text-gray-700",children:t.unit||"—"}),status:t=>{const s={available:"bg-green-100 text-green-800",low_stock:"bg-yellow-100 text-yellow-800",out_of_stock:"bg-red-100 text-red-800"};return e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${s[t.status]||"bg-gray-100 text-gray-800"}`,children:t.status||"—"})},received_date:t=>e.jsx("span",{className:"text-sm text-gray-500",children:t.received_date?new Date(t.received_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"—"}),supplier:t=>e.jsx("span",{className:"text-sm text-gray-700",children:t.supplier||"—"}),actions:t=>e.jsx(ge,{actions:[{label:"Edit",icon:e.jsx(Oe,{className:"w-4 h-4 text-green-500"}),onClick:()=>le(t.id)},{label:"Delete",icon:e.jsx(qe,{className:"w-4 h-4 text-red-600"}),onClick:()=>ne(t.id)}]})},te=()=>{_("add"),f(!0)},{data:u,setData:v,post:$,errors:o,reset:L,clearErrors:se}=de({inventory_items:[[]],_method:void 0,item_id:null}),ae=()=>{v("inventory_items",[...u.inventory_items||[],{}])},re=t=>{const s=[...u.inventory_items||[]];s.splice(t,1),v("inventory_items",s),y.warning("Item removed.",{duration:2e3})},b=()=>{f(!1),_(""),D(null),L(),se()},l=(t,s,a)=>{v(i=>{const p=[...i.inventory_items];return p[s]||(p[s]={}),p[s]={...p[s],[a]:t},{...i,inventory_items:p}})},oe=t=>{t.preventDefault(),$(route("inventory.store"),{onError:s=>{console.error("Validation Errors:",s);const a=Object.values(s).join("<br />");y.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:a}}),duration:3e3,closeButton:!0})},onSuccess:()=>{w(),b()}})},le=async t=>{_("edit");try{const a=(await P.get(`${I}/inventory/details/${t}`)).data.item;D(a),v({inventory_items:[{item_name:a.item_name||"",item_category:a.item_category||"",quantity:a.quantity||"",unit:a.unit||"",received_date:a.received_date||"",supplier:a.supplier||"",status:a.status||""}],_method:"PUT",item_id:a.id}),f(!0)}catch(s){console.error("Error fetching inventory details:",s)}},ie=t=>{t.preventDefault(),$(route("inventory.update",u.item_id),{onError:s=>{const a=Object.values(s).join("<br />");y.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:a}}),duration:3e3,closeButton:!0})},onSuccess:()=>{w(),b()}})},ne=t=>{H(t),S(!0)},me=()=>{ue.delete(route("inventory.destroy",F),{onError:t=>{console.error("Validation Errors:",t);const s=Object.values(t).join("<br />");y.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:s}}),duration:3e3,closeButton:!0})},onSuccess:()=>{w(),b()}}),S(!1)};return r.useEffect(()=>{N&&y.error(N,{description:"Operation failed!",duration:3e3,closeButton:!0}),g.error=null},[N]),K?e.jsxs("div",{className:"gap-2 space-y-4",children:[e.jsx(U,{className:"h-[20px] w-[100px] rounded-full"}),e.jsx(U,{className:"h-[10px] w-[100px] rounded-full"})]}):z?e.jsxs("div",{className:"text-red-500",children:["Error: ",G.message]}):e.jsxs("div",{className:"p-2 md:px-2 md:py-2",children:[e.jsx(we,{richColors:!0}),e.jsxs("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx(he,{allColumns:C,visibleColumns:h,setVisibleColumns:X,showFilters:M,toggleShowFilters:()=>R(t=>!t)})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[e.jsxs("form",{onSubmit:Y,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[e.jsx(ve,{type:"text",placeholder:"Search Inventory Items",value:q,onChange:t=>A(t.target.value),onKeyDown:t=>Z("name",t.target.value),className:"ml-4"}),e.jsx(j,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(Ee,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(j,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",onClick:te,children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add an Institution"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[M&&e.jsx(be,{queryParams:d,searchFieldName:E,visibleFilters:["inventory_status","item_category","date_recieved"],showFilters:!0,inventory_items:T.data,setQueryParams:O,setQuery:A,clearRouteAxios:!0,types:J}),e.jsx(pe,{passedData:T,allColumns:C,columnRenderers:ee,visibleColumns:h,showTotal:!0})]})]}),e.jsx(Se,{isOpen:B,onClose:()=>{b()},title:V=="add"?"Add Item/s":"Edit Item",children:e.jsxs("form",{className:"bg-gray-50 p-4 rounded-lg",onSubmit:c?ie:oe,children:[e.jsx("h3",{className:"text-2xl font-medium text-gray-700",children:"Barangay Inventory"}),e.jsx("p",{className:"text-sm text-gray-500 mb-8",children:"Please provide details about the barangay’s inventory items."}),Array.isArray(u.inventory_items)&&u.inventory_items.map((t,s)=>e.jsxs("div",{className:"border p-4 mb-4 rounded-md relative bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 mb-6 gap-4",children:[e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(x,{label:"Item Name",name:"item_name",value:t.item_name||"",onChange:a=>l(a.target.value,s,"item_name"),placeholder:"e.g. Rice, Medicine, Generator"}),e.jsx(n,{message:o[`inventory_items.${s}.item_name`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(je,{label:"Category",name:"item_category",value:t.item_category||"",onChange:a=>l(a.target.value,s,"item_category"),placeholder:"Select category",items:[{label:"Food",value:"food"},{label:"Medicine",value:"medicine"},{label:"Equipment",value:"equipment"},{label:"Relief Goods",value:"relief_goods"},{label:"Other",value:"other"}]}),e.jsx(n,{message:o[`inventory_items.${s}.item_category`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(x,{label:"Quantity",name:"quantity",type:"number",value:t.quantity||"",onChange:a=>l(a.target.value,s,"quantity"),placeholder:"Enter quantity"}),e.jsx(n,{message:o[`inventory_items.${s}.quantity`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(x,{label:"Unit",name:"unit",value:t.unit||"",onChange:a=>l(a.target.value,s,"unit"),placeholder:"e.g. kg, pcs, box"}),e.jsx(n,{message:o[`inventory_items.${s}.unit`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(Ce,{label:"Status",name:"status",value:t.status||"",onChange:a=>l(a.target.value,s,"status"),items:[{label:"Available",value:"available"},{label:"Low Stock",value:"low_stock"},{label:"Out of Stock",value:"out_of_stock"}]}),e.jsx(n,{message:o[`inventory_items.${s}.status`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(x,{label:"Date Received",name:"received_date",type:"date",value:t.received_date||"",onChange:a=>l(a.target.value,s,"received_date")}),e.jsx(n,{message:o[`inventory_items.${s}.received_date`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(x,{label:"Supplier",name:"supplier",value:t.supplier||"",onChange:a=>l(a.target.value,s,"supplier"),placeholder:"e.g. Local Distributor, DOH"}),e.jsx(n,{message:o[`inventory_items.${s}.supplier`],className:"mt-1"})]})]}),c===null&&e.jsx("button",{type:"button",onClick:()=>re(s),className:"absolute top-1 right-2 flex items-center gap-1 text-sm text-red-400 hover:text-red-800 font-medium mt-1 mb-5 transition-colors duration-200",children:e.jsx(fe,{className:"text-2xl"})})]},s)),e.jsxs("div",{className:"flex justify-between items-center p-3",children:[c===null?e.jsxs("button",{type:"button",onClick:ae,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800 font-medium mt-4 transition-colors duration-200",children:[e.jsx(_e,{className:"text-2xl"}),e.jsx("span",{children:"Add Item"})]}):e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end items-center text-end mt-5 gap-4",children:[c==null&&e.jsxs(j,{type:"button",onClick:()=>L(),children:[e.jsx(De,{})," Reset"]}),e.jsxs(j,{className:"bg-blue-700 hover:bg-blue-400",type:"submit",children:[c?"Update":"Add"," ",e.jsx(Ne,{})]})]})]})]})}),e.jsx(ke,{isOpen:Q,onClose:()=>{S(!1)},onConfirm:me,residentId:F})]})};export{vt as default};
