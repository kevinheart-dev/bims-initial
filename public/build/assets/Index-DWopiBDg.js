import{K as pe,r as d,m as fe,j as e,L as ge,S as V,a as U}from"./app-CSbLTV9t.js";import{S as be}from"./AdminLayout-CQAB1boG.js";import{B as C}from"./button-Baqcf9KW.js";import{I as _e}from"./input-HZV2GfRj.js";import je from"./BreadcrumbsHeader-CQaDVuiA.js";import{t as p,T as ve}from"./index-BKWT8n_e.js";import Ne from"./DynamicTable-CYX8Y7lr.js";import ye from"./ActionMenu-BTyRiOW7.js";import{R as De,b as we}from"./constants-CQOY_faM.js";import ke from"./SidebarModal-Ca0ENWih.js";import Se from"./DynamicTableControls-nJkmjrjE.js";import{F as Ce}from"./FillterToggle-p8HB-wA3.js";import{u as Ee}from"./useAppUrl-CCPDQKWJ.js";import Re from"./PersonDetailContent-BL527x7d.js";import Ie from"./DeleteConfirmationModal-C2yWkaRr.js";import{u as Me}from"./handleResidentChange-Bj7ATBPS.js";import{D as Te}from"./DropdownInputField-D-lPqSgr.js";import{I as u}from"./InputError-BCqWxJV0.js";import{I as H}from"./InputLabel-D9dJg9rZ.js";import{I as h}from"./InputField-B1L9QxNV.js";import{c as Oe}from"./createLucideIcon-K65SoRPX.js";import{S as $e}from"./search-w3rx2qu6.js";import{S as Ae}from"./square-plus-CprPAGyR.js";import{M as Le}from"./move-right-DJWZOqZ0.js";import{E as Fe}from"./eye-CUAyTwAT.js";import{S as Be}from"./square-pen-BBjInpuo.js";import{T as Ve}from"./trash-2-D7SnOmvm.js";import"./sidebar-EM1pc_Vu.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./index-BWMtPXXG.js";import"./index-CLKsPuj0.js";import"./floating-ui.react-dom-DHVDvaGl.js";import"./x-DSSMIW7T.js";import"./skeleton-C3jJoeQy.js";import"./tooltip-b0GAWXCC.js";import"./nav-user-qFIfSs4r.js";import"./avatar-DBnd5X0z.js";import"./dropdown-menu-DsAxoPEU.js";import"./check-xGOvrYiq.js";import"./chevron-right-ZDo9j4tz.js";import"./users-round-CTpkNJgD.js";import"./heart-pulse-CgKjARwL.js";import"./chevron-up-BdT9BwPw.js";import"./breadcrumb-BysmSHHT.js";import"./ellipsis-Ci4G0pTK.js";import"./iconBase-DIY0yPu9.js";import"./index-Bw3HOa7F.js";import"./index-BqPLuFbr.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M4 9a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h4a1 1 0 0 1 1 1v4a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-4a1 1 0 0 1 1-1h4a2 2 0 0 0 2-2v-2a2 2 0 0 0-2-2h-4a1 1 0 0 1-1-1V4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4a1 1 0 0 1-1 1z",key:"1xbrqy"}]],He=Oe("cross",Ue);function Ft({deaths:P,puroks:z,queryParams:c,residents:E}){const K=[{label:"Resident Information",showOnMobile:!1},{label:"Deaths",showOnMobile:!0}];c=c||{};const R=Ee(),x=pe().props,j=(x==null?void 0:x.success)??null,v=(x==null?void 0:x.error)??null,[G,N]=d.useState(!1),[I,Y]=d.useState(null),[g,y]=d.useState(null),[M,Q]=d.useState(c.name??""),[X,b]=d.useState(!1),[D,_]=d.useState(""),[T,O]=d.useState(null),J=(t,a)=>{if(!t||!a)return"Unknown";const l=new Date(t),i=new Date(a);let n=i.getFullYear()-l.getFullYear();const s=i.getMonth()-l.getMonth();return(s<0||s===0&&i.getDate()<l.getDate())&&n--,n},W=t=>{t.preventDefault(),w("name",M)},w=(t,a)=>{a&&a.trim()!==""?c[t]=a:delete c[t],c.page&&delete c.page,V.get(route("death.index",c))},Z=(t,a)=>{if(a.key==="Enter")w(t,a.target.value);else return},k=[{key:"id",label:"ID"},{key:"name",label:"Resident Name"},{key:"sex",label:"Sex"},{key:"age",label:"Age of Death"},{key:"birthdate",label:"Date of Birth"},{key:"date_of_death",label:"Date of Death"},{key:"cause_of_death",label:"Cause of Death"},{key:"burial_place",label:"Burial Place"},{key:"purok_number",label:"Purok Number"},{key:"remarks",label:"Remarks"},{key:"actions",label:"Actions"}],q=E.map(t=>({label:`${t.firstname} ${t.middlename} ${t.lastname} ${t.suffix??""}`,value:t.id.toString()})),[$,ee]=d.useState(k.map(t=>t.key)),S=Object.entries(c||{}).some(([t,a])=>["purok","sex","age_group","date_of_death"].includes(t)&&a&&a!=="");d.useEffect(()=>{S&&L(!0)},[S]);const[A,L]=d.useState(S),te={id:t=>e.jsx("span",{className:"text-xs font-semibold text-gray-500",children:t.id}),name:t=>{var a,l,i,n;return e.jsxs("span",{className:"font-medium text-gray-800",children:[(a=t.resident)==null?void 0:a.firstname," ",((l=t.resident)==null?void 0:l.middlename)??""," ",(i=t.resident)==null?void 0:i.lastname,e.jsxs("span",{className:"text-gray-500",children:[" ",((n=t.resident)==null?void 0:n.suffix)??""]})]})},sex:t=>{var n,s,f;const a=(n=t==null?void 0:t.resident)==null?void 0:n.sex,l=((s=De)==null?void 0:s[a])??a??"Unknown",i=((f=we)==null?void 0:f[a])??"bg-gray-100 text-gray-800";return e.jsx("span",{className:`py-1 px-3 rounded-full text-xs font-semibold shadow-sm whitespace-nowrap ${i}`,children:l})},birthdate:t=>{var a;return(a=t.resident)!=null&&a.birthdate?e.jsx("span",{className:"text-gray-700 text-sm",children:new Date(t.resident.birthdate).toLocaleDateString()}):e.jsx("span",{className:"italic text-gray-400",children:"—"})},age:t=>{var l;const a=J((l=t.resident)==null?void 0:l.birthdate,t.date_of_death);return a===null?e.jsx("span",{className:"italic text-gray-400",children:"Unknown"}):e.jsxs("div",{className:"flex flex-col text-sm",children:[e.jsxs("span",{className:"font-bold text-indigo-700",children:[a," yrs"]}),a>60&&e.jsx("span",{className:"text-xs text-rose-500 font-semibold mt-0.5",children:"Senior Citizen"})]})},date_of_death:t=>t.date_of_death?e.jsx("span",{className:"text-red-600 font-medium",children:new Date(t.date_of_death).toLocaleDateString()}):e.jsx("span",{className:"italic text-gray-400",children:"—"}),purok_number:t=>{var a;return e.jsx("span",{className:"text-gray-700 font-medium",children:((a=t.resident)==null?void 0:a.purok_number)??"—"})},cause_of_death:t=>t.cause_of_death?e.jsx("span",{className:"text-gray-700",children:t.cause_of_death}):e.jsx("span",{className:"italic text-gray-400",children:"—"}),burial_place:t=>t.burial_place?e.jsx("span",{className:"text-gray-700",children:t.burial_place}):e.jsx("span",{className:"italic text-gray-400",children:"—"}),remarks:t=>t.remarks?e.jsx("span",{className:"text-gray-700",children:t.remarks}):e.jsx("span",{className:"italic text-gray-400",children:"—"}),actions:t=>e.jsx(ye,{actions:[{label:"View",icon:e.jsx(Fe,{className:"w-4 h-4 text-indigo-600"}),onClick:()=>me(t.id)},{label:"Edit",icon:e.jsx(Be,{className:"w-4 h-4 text-green-500"}),onClick:()=>oe(t.resident_id)},{label:"Delete",icon:e.jsx(Ve,{className:"w-4 h-4 text-red-600"}),onClick:()=>de(t.resident_id)}]})},{data:o,setData:r,post:F,errors:m,reset:ae,clearErrors:se}=fe({resident_id:null,resident_name:"",resident_image:null,birthdate:null,purok_number:null,date_of_death:new Date().toISOString().split("T")[0],cause_of_death:"",place_of_death:"",burial_place:"",burial_date:null,death_certificate_number:"",remarks:"",death_id:null,_method:void 0}),re=Me(E,r),le=()=>{_("add"),b(!0)},ie=t=>{t.preventDefault(),F(route("death.store"),{onError:a=>{const l=Object.values(a).map((i,n)=>`<div key=${n}> ${i}</div>`);p.error("Validation Error",{description:e.jsx("div",{dangerouslySetInnerHTML:{__html:l.join("")}}),duration:4e3,closeButton:!0})}})},ne=t=>{t.preventDefault(),F(route("death.update",o.resident_id),{onError:()=>{const a=Object.values(m).map((l,i)=>`<div key=${i}> ${l}</div>`);p.error("Validation Error",{description:e.jsx("div",{dangerouslySetInnerHTML:{__html:a.join("")}}),duration:4e3,closeButton:!0})}})},B=()=>{_(null),b(!1),O(null),y(null),ae(),se()},oe=async t=>{var a,l,i;_("add"),y(null);try{const s=(await U.get(`${R}/death/details/${t}`)).data.details;y(s),r("resident_id",s.id),r("resident_name",`${s.firstname} ${s.middlename??""} ${s.lastname} ${s.suffix??""}`.replace(/\s+/g," ")),r("purok_number",s.purok_number),r("birthdate",s.birthdate),r("resident_image",s.resident_picture_path),r("date_of_death",s.date_of_death),r("death_id",s.death_id),r("cause_of_death",s.cause_of_death??""),r("place_of_death",s.place_of_death??""),r("burial_place",s.burial_place??""),r("burial_date",s.burial_date??""),r("death_certificate_number",s.death_certificate_number??""),r("remarks",s.remarks??""),r("_method","PUT")}catch(n){console.error("Error fetching placeholders:",n);let s="Error",f="Something went wrong. Please try again.";if(((a=n.response)==null?void 0:a.status)===422&&((i=(l=n.response)==null?void 0:l.data)!=null&&i.errors)){s="Validation Error";const ue=Object.values(n.response.data.errors).flat();f=e.jsx("ul",{className:"list-disc ml-5",children:ue.map((xe,he)=>e.jsx("li",{children:xe},he))})}p.error(s,{description:f,duration:4e3,closeButton:!0})}finally{b(!0)}},de=t=>{Y(t),N(!0)},ce=()=>{V.delete(route("death.destroy",I),{onError:t=>{const a=Object.values(t).map((l,i)=>`<div key=${i}> ${l}</div>`);p.error("Validation Error",{description:e.jsx("div",{dangerouslySetInnerHTML:{__html:a.join("")}}),duration:4e3,closeButton:!0})}}),N(!1)},me=async t=>{_("view");try{const a=await U.get(`${R}/resident/showresident/${t}`);O(a.data.resident)}catch(a){console.error("Error fetching placeholders:",a)}b(!0)};return d.useEffect(()=>{j&&(B(),p.success(j,{description:"Operation successful!",duration:3e3,closeButton:!0})),x.success=null},[j]),d.useEffect(()=>{v&&p.error(v,{description:"Operation failed!",duration:3e3,closeButton:!0}),x.error=null},[v]),e.jsxs(be,{children:[e.jsx(ge,{title:"Resident Information"}),e.jsxs("div",{children:[e.jsx(ve,{richColors:!0}),e.jsx(je,{breadcrumbs:K}),e.jsx("div",{className:"p-2 md:p-4",children:e.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-red-50 rounded-xl shadow-sm",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-full",children:e.jsx(He,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:"Death Records"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Maintain and monitor resident"," ",e.jsx("span",{className:"font-medium",children:"death records"}),". Use the tools below to"," ",e.jsx("span",{className:"font-medium",children:"search, filter, or export"}),"information for reports and documentation."]})]})]})}),e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx(Se,{allColumns:k,visibleColumns:$,setVisibleColumns:ee,showFilters:A,toggleShowFilters:()=>L(t=>!t)})}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:e.jsxs("form",{onSubmit:W,className:"flex w-[380px] max-w-lg items-center space-x-1",children:[e.jsx(_e,{type:"text",placeholder:"Search Resident Name",value:M,onChange:t=>Q(t.target.value),onKeyDown:t=>Z("name",t.target.value),className:"w-full"}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(C,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx($e,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(C,{className:"bg-blue-700 hover:bg-blue-400 ",type:"button",onClick:le,children:e.jsx(Ae,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add Resident Death"})]})]})})]}),A&&e.jsx(Ce,{queryParams:c,searchFieldName:w,visibleFilters:["purok","sex","age_group","date_of_death"],puroks:z,showFilters:!0,clearRouteName:"death.index",clearRouteParams:{}}),e.jsx(Ne,{passedData:P,allColumns:k,columnRenderers:te,queryParams:c,visibleColumns:$,showTotal:!0})]})})}),e.jsxs(ke,{isOpen:X,onClose:B,title:D==="add"?g?"Edit Resident Death Details":"Add Resident Death Details":"View Resident Details",children:[D==="add"&&e.jsx("div",{className:"w-full rounded-xl border border-white/20 bg-white/10 backdrop-blur-md shadow-lg text-sm text-black p-4 space-y-4",children:e.jsxs("form",{onSubmit:g?ne:ie,className:"space-y-6",children:[e.jsxs("h3",{className:"text-2xl font-bold text-gray-900 mb-2 flex items-center gap-2",children:["Death Record –"," ",o.resident_name||"Select a Resident"]}),e.jsx("p",{className:"text-gray-600 mb-6 text-sm",children:"Please provide the death details of the resident, including the official date of death and supporting information."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-y-4 md:gap-x-6",children:[e.jsxs("div",{className:"md:row-span-2 md:col-span-2 flex flex-col items-center space-y-2",children:[e.jsx(H,{htmlFor:"resident_image",value:"Profile Photo"}),e.jsx("img",{src:o.resident_image?`/storage/${o.resident_image}`:"/images/default-avatar.jpg",alt:"Resident",className:"w-32 h-32 object-cover rounded-full border border-gray-200 shadow-sm"})]}),e.jsxs("div",{className:"md:col-span-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx(Te,{label:"Full Name",name:"resident_name",value:o.resident_name||"",placeholder:"Select a resident",onChange:t=>re(t),items:q,readOnly:g}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Choose the resident whose death record is being created."}),e.jsx(u,{message:m.resident_id,className:"mt-1 text-sm text-red-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{label:"Birthdate",name:"birthdate",value:o.birthdate||"",readOnly:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Automatically filled once a resident is selected."}),e.jsx(u,{message:m.birthdate,className:"mt-1 text-sm text-red-500"})]}),e.jsxs("div",{children:[e.jsx(h,{label:"Purok Number",name:"purok_number",value:o.purok_number,readOnly:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"The resident’s registered purok. Auto-filled."}),e.jsx(u,{message:m.purok_number,className:"mt-1 text-sm text-red-500"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{label:"Cause of Death",name:"cause_of_death",value:o.cause_of_death,onChange:t=>r("cause_of_death",t.target.value),placeholder:"e.g., Illness, Accident"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Specify the medical or situational reason for death."}),e.jsx(u,{message:m.cause_of_death,className:"mt-1 text-sm text-red-500"})]}),e.jsxs("div",{children:[e.jsx(h,{label:"Place of Death",name:"place_of_death",value:o.place_of_death,onChange:t=>r("place_of_death",t.target.value),placeholder:"e.g., Hospital, Home"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Indicate where the death occurred."}),e.jsx(u,{message:m.place_of_death,className:"mt-1 text-sm text-red-500"})]}),e.jsxs("div",{children:[e.jsx(h,{label:"Burial Place",name:"burial_place",value:o.burial_place,onChange:t=>r("burial_place",t.target.value),placeholder:"e.g., Municipal Cemetery"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Location of the burial site."}),e.jsx(u,{message:m.burial_place,className:"mt-1 text-sm text-red-500"})]}),e.jsxs("div",{children:[e.jsx(h,{label:"Burial Date",name:"burial_date",type:"date",value:o.burial_date||"",onChange:t=>r("burial_date",t.target.value)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select the date when burial took place."}),e.jsx(u,{message:m.burial_date,className:"mt-1 text-sm text-red-500"})]}),e.jsxs("div",{children:[e.jsx(h,{label:"Death Certificate Number",name:"death_certificate_number",value:o.death_certificate_number,onChange:t=>r("death_certificate_number",t.target.value),placeholder:"e.g., DC-12345"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter the official certificate number (if available)."}),e.jsx(u,{message:m.death_certificate_number,className:"mt-1 text-sm text-red-500"})]}),e.jsxs("div",{children:[e.jsx(h,{label:"Date of Death",name:"date_of_death",type:"date",value:o.date_of_death||"",onChange:t=>r("date_of_death",t.target.value),className:`w-full rounded-lg border-gray-300 shadow-sm
                focus:border-indigo-500 focus:ring focus:ring-indigo-200
                focus:ring-opacity-50 text-sm`}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Required. The exact date of death."}),e.jsx(u,{message:m.date_of_death,className:"mt-1 text-sm text-red-500"})]})]}),e.jsxs("div",{children:[e.jsx(H,{value:"Remarks"}),e.jsx("textarea",{name:"remarks",value:o.remarks,onChange:t=>r("remarks",t.target.value),placeholder:"Additional notes about the death record...",className:"w-full mt-1 rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 text-sm",rows:3}),e.jsx(u,{message:m.remarks,className:"mt-1 text-sm text-red-500"})]}),e.jsx("div",{className:"flex justify-end items-center",children:e.jsxs(C,{className:"bg-blue-700 hover:bg-blue-600 text-white px-6 py-2 rounded-lg shadow-md flex items-center gap-2",type:"submit",children:[g?"Update":"Add"," ",e.jsx(Le,{className:"w-4 h-4"})]})})]})}),D==="view"&&T?e.jsx(Re,{person:T,deceased:!0}):null]}),e.jsx(Ie,{isOpen:G,onClose:()=>{N(!1)},onConfirm:ce,residentId:I})]})]})}export{Ft as default};
