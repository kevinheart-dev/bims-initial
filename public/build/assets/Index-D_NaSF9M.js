import{K as ye,r as m,m as _e,j as a,L as je,$ as K,S,a as X}from"./app-FQbzxGIw.js";import ve from"./BreadcrumbsHeader-BKQz8BHC.js";import{S as Ne,a as ke}from"./AdminLayout-D681-fmM.js";import Fe from"./ActionMenu-CzwL-S4C.js";import{B as b}from"./button-9tywdtpe.js";import{I as Ce}from"./input-BxejiG4V.js";import Se from"./DynamicTable-BMSA2BaJ.js";import Me from"./DynamicTableControls-Dp8-Etap.js";import{F as Ee}from"./FillterToggle-C5Vn0ru6.js";import{u as $e}from"./useAppUrl-zATTBKeL.js";import{F as we,f as Z,l as Ae}from"./constants-0uClA9D3.js";import De from"./SidebarModal-DD4dEoye.js";import{I as G}from"./InputLabel-BRo6d_Ci.js";import{D as x}from"./DropdownInputField-D0XusS6V.js";import{I as V}from"./InputError-BKQpvrj7.js";import{I as h}from"./InputField-DUwBnDWI.js";import{I as Ie,a as Re}from"./index-BtiFw4lQ.js";import{G as Oe}from"./iconBase-C4pIma2P.js";import{t as M,T as Te}from"./index-CMTh6Y7Z.js";import Ue from"./DeleteConfirmationModal-B0Xpw4Vn.js";import{E as Y}from"./ExportButton-tGc-eDMS.js";import{U as Be}from"./users-DYyEf1iS.js";import{S as Pe}from"./search-BMvlfdsT.js";import{H as Le}from"./house-plus-B5eWNDu8.js";import{R as ze}from"./rotate-ccw-C8GY2dtN.js";import{M as Ke}from"./move-right-Bmm93ya7.js";import{U as Xe}from"./users-round-fHMLq3qJ.js";import{S as Ze}from"./square-pen-BPpyNhve.js";import{T as Ge}from"./trash-2-DbTjliIz.js";import{U as Ve}from"./user-DDv7YMvZ.js";import"./breadcrumb-CZJEnQm8.js";import"./chevron-right-KG4eDgaU.js";import"./createLucideIcon-CbmRPBK-.js";import"./sidebar-kMsPs0kt.js";import"./index-D9GFQlD6.js";import"./index-BvtReL5S.js";import"./floating-ui.react-dom-Bv5Tn9NB.js";import"./x-SzE7BJuj.js";import"./skeleton-C5JXX0Vb.js";import"./tooltip-D5qIOJrT.js";import"./clsx-B-dksMZM.js";import"./nav-user-NQ1-22E_.js";import"./avatar-B4QdFqbk.js";import"./dropdown-menu-Mj4r6j7K.js";import"./check-KP9WahT6.js";import"./chevron-up-D1MoY1rl.js";import"./ellipsis-CzsbrfyR.js";import"./file-output--5Kcqojd.js";function Ye(g){return Oe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M24.79,121.59a12,12,0,0,0,16.81-2.38,48,48,0,0,1,76.81,0,12,12,0,0,0,16.8,2.39,12.24,12.24,0,0,0,2.38-2.39h0a48,48,0,0,1,76.81,0,12,12,0,1,0,19.19-14.41,72,72,0,0,0-25.3-21.22,40,40,0,1,0-64.58,0A71,71,0,0,0,128,94.31a71,71,0,0,0-15.71-10.74,40,40,0,1,0-64.58,0,72,72,0,0,0-25.3,21.22A12,12,0,0,0,24.79,121.59ZM176,44a16,16,0,1,1-16,16A16,16,0,0,1,176,44ZM80,44A16,16,0,1,1,64,60,16,16,0,0,1,80,44ZM208.29,195.57a40,40,0,1,0-64.58,0A71.31,71.31,0,0,0,128,206.3a71.31,71.31,0,0,0-15.71-10.73,40,40,0,1,0-64.58,0,72,72,0,0,0-25.3,21.22A12,12,0,0,0,41.6,231.21a48,48,0,0,1,76.81,0,12,12,0,0,0,16.8,2.39,12.24,12.24,0,0,0,2.38-2.39h0a48,48,0,0,1,76.81,0,12,12,0,1,0,19.19-14.41A71.91,71.91,0,0,0,208.29,195.57ZM80,156a16,16,0,1,1-16,16A16,16,0,0,1,80,156Zm96,0a16,16,0,1,1-16,16A16,16,0,0,1,176,156Z"},child:[]}]})(g)}function Va({families:g,queryParams:d=null,puroks:Q}){const J=[{label:"Residents Information",showOnMobile:!1},{label:"Families",href:route("family.index"),showOnMobile:!0}];d=d||{};const W=$e(),u=ye().props,y=(u==null?void 0:u.success)??null,_=(u==null?void 0:u.error)??null,[E,H]=m.useState(d.name??""),[q,j]=m.useState(!1),[p,$]=m.useState(null),[ee,v]=m.useState(!1),[w,ae]=m.useState(null),[N,se]=m.useState([]),te=e=>{e.preventDefault(),k("name",E)},k=(e,s)=>{s&&s.trim()!==""?d[e]=s:delete d[e],d.page&&delete d.page,S.get(route("family.index",d))},le=(e,s)=>{if(s.key==="Enter")k(e,s.target.value);else return},F=[{key:"family_id",label:"Family ID"},{key:"name",label:"Name of Family Head"},{key:"family_name",label:"Family Name"},{key:"income_bracket",label:"Income Bracket"},{key:"income_category",label:"Income Category"},{key:"family_type",label:"Family Type"},{key:"family_member_count",label:"Members"},{key:"house_number",label:"House Number"},{key:"purok_number",label:"Purok Number"},{key:"actions",label:"Actions"}],re=e=>{S.get(route("family.showfamily",e))},[A,ie]=m.useState(F.map(e=>e.key)),[Qe,Je]=m.useState(!0),[We,He]=m.useState(!1),C=Object.entries(d||{}).some(([e,s])=>["purok","famtype","household_head","income_bracket"].includes(e)&&s&&s!==" ");m.useEffect(()=>{C&&I(!0)},[C]);const[D,I]=m.useState(C),ne={family_id:e=>e.id,name:e=>e.latest_head?`${e.latest_head.firstname??""} ${e.latest_head.middlename??""} ${e.latest_head.lastname??""} ${e.latest_head.suffix??""}`:"Unknown",is_household_head:e=>e.is_household_head?a.jsx("span",{className:"py-1 px-2 rounded-xl bg-green-100 text-green-800",children:"Yes"}):a.jsx("span",{className:"py-1 px-2 rounded-xl bg-red-100 text-red-800",children:"No"}),family_name:e=>a.jsx(K,{href:route("family.showfamily",(e==null?void 0:e.id)??0),className:"hover:text-blue-500 hover:underline",children:((e==null?void 0:e.family_name)??"Unnamed")+" Family"}),family_member_count:e=>a.jsxs("span",{className:"flex items-center",children:[(e==null?void 0:e.family_member_count)??0," ",a.jsx(Ve,{className:"ml-2 h-5 w-5"})]}),income_bracket:e=>{var i,t;const s=e==null?void 0:e.income_bracket,l=(i=Ae)==null?void 0:i[s],r=(t=Z)==null?void 0:t[s];return l?a.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${(r==null?void 0:r.className)??""}`,children:l}):a.jsx("span",{className:"text-gray-500 italic",children:"Unknown"})},income_category:e=>{var l;const s=(l=Z)==null?void 0:l[e==null?void 0:e.income_bracket];return s?a.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${s.className}`,children:s.label}):a.jsx("span",{className:"text-gray-500 italic",children:"Unknown"})},family_type:e=>{var s;return((s=we)==null?void 0:s[e==null?void 0:e.family_type])??"Unknown"},house_number:e=>{var l,r,i,t;return((t=(i=(r=(l=e==null?void 0:e.latest_head)==null?void 0:l.household_residents)==null?void 0:r[0])==null?void 0:i.household)==null?void 0:t.house_number)??"Unknown"},purok_number:e=>{var s,l,r;return((r=(l=(s=e==null?void 0:e.latest_head)==null?void 0:s.street)==null?void 0:l.purok)==null?void 0:r.purok_number)??"Unknown"},actions:e=>a.jsx(Fe,{actions:[{label:"View Family",icon:a.jsx(Xe,{className:"w-4 h-4 text-blue-600"}),onClick:()=>re(e==null?void 0:e.id)},{label:"Edit",icon:a.jsx(Ze,{className:"w-4 h-4 text-green-500"}),onClick:()=>xe(e==null?void 0:e.id)},{label:"Delete",icon:a.jsx(Ge,{className:"w-4 h-4 text-red-600"}),onClick:()=>fe(e==null?void 0:e.id)}]})};m.useEffect(()=>{(async()=>{try{const s=await X.get("/family/residents-members");se(s.data.members||[])}catch(s){console.error("Error fetching data:",s)}})()},[]);const oe=()=>{j(!0)},R={resident_id:null,resident_name:"",resident_image:null,birthdate:"",purok_number:"",relationship_to_head:"",household_position:""},O=N.map(e=>({label:`${e.firstname} ${e.middlename} ${e.lastname} ${e.suffix??""}`,value:e.id.toString()})),{data:o,setData:c,post:T,errors:U,reset:B,clearErrors:me}=_e({resident_id:null,resident_name:"",resident_image:null,birthdate:null,purok_number:null,house_number:null,family_name:"",family_type:"",members:[R],family_id:null,_method:void 0}),P=()=>{j(!1),$(null),B(),me()},de=()=>{c("members",[...o.members||[],{...R}])},ce=e=>{const s=[...o.members||[]];s.splice(e,1),c("members",s),M.warning("Member removed.",{duration:2e3})},ue=e=>{Number(e.target.value);const s=N.find(l=>l.id==e.target.value);s&&(c("resident_id",s.id),c("resident_name",`${s.firstname} ${s.middlename} ${s.lastname} ${s.suffix??""}`),c("purok_number",s.purok_number),c("house_number",s.latest_household.house_number),c("birthdate",s.birthdate),c("resident_image",s.resident_picture_path))},he=(e,s)=>{const l=[...o.members],r=N.find(i=>i.id==e.target.value);r&&(l[s]={...l[s],resident_id:r.id??"",resident_name:`${r.firstname??""} ${r.middlename??""} ${r.lastname??""} ${r.suffix??""}`,purok_number:r.purok_number??"",birthdate:r.birthdate??"",resident_image:r.image??null},c({...o,members:l}))},L=(e,s)=>{const{name:l,value:r}=e.target,i=[...o.members];i[s]={...i[s],[l]:r},c("members",i)},pe=e=>{e.preventDefault(),T(route("family.store"),{onError:s=>{console.error("Validation Errors:",s)}})},be=e=>{e.preventDefault(),T(route("family.update",o.family_id),{onError:s=>{console.error("Validation Errors:",s)}})},xe=async e=>{var s,l;try{const i=(await X.get(`${W}/family/getfamilydetails/${e}`)).data.family_details,t=i.members.filter(n=>n.is_household_head===1).sort((n,f)=>new Date(f.updated_at)-new Date(n.updated_at))[0]||i.members[0];c({resident_id:(t==null?void 0:t.id)??null,resident_name:`${t==null?void 0:t.firstname} ${t!=null&&t.middlename?(t==null?void 0:t.middlename)+" ":""}${t==null?void 0:t.lastname} ${t==null?void 0:t.suffix}`.trim(),resident_image:t==null?void 0:t.resident_picture_path,birthdate:(t==null?void 0:t.birthdate)??null,purok_number:(t==null?void 0:t.purok_number)??null,house_number:((s=t==null?void 0:t.household)==null?void 0:s.house_number)??((l=i.household)==null?void 0:l.house_number)??null,family_type:i.family_type,family_name:i.family_name,members:(i.members||[]).map(n=>{var z;const f=((z=n.household_residents)==null?void 0:z[0])||{};return{resident_id:n.id,resident_name:`${n.firstname} ${n.middlename?n.middlename+" ":""}${n.lastname} ${n.suffix}`.trim(),resident_image:n.resident_picture_path,birthdate:n.birthdate,purok_number:n.purok_number,relationship_to_head:f.relationship_to_head??"",household_position:f.household_position??""}}).filter(n=>n.relationship_to_head.toLowerCase()!=="self"),family_id:i.id,_method:"PUT"}),console.log(i),$(i),j(!0)}catch(r){console.error("Error fetching family details:",r)}},fe=e=>{ae(e),v(!0)},ge=()=>{S.delete(route("family.destroy",w)),v(!1)};return m.useEffect(()=>{y&&(P(),M.success(y,{description:"Operation successful!",duration:3e3,closeButton:!0})),u.success=null},[y]),m.useEffect(()=>{_&&M.error(_,{description:"Operation failed!",duration:3e3,closeButton:!0}),u.error=null},[_]),a.jsxs(Ne,{children:[a.jsx(je,{title:"Family"}),a.jsx(ve,{breadcrumbs:J}),a.jsx(Te,{richColors:!0}),a.jsx("div",{className:"pt-4",children:a.jsxs("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:[a.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[a.jsx("div",{className:"mb-6",children:a.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl shadow-sm",children:[a.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:a.jsx(Be,{className:"w-6 h-6 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:"Family Records"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Manage and track families registered in the barangay."})]})]})}),a.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[a.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[a.jsx(Me,{allColumns:F,visibleColumns:A,setVisibleColumns:ie,showFilters:D,toggleShowFilters:()=>I(e=>!e)}),a.jsx(Y,{url:"report/export-family-excel",queryParams:d,label:"Export Family as XLSX"}),a.jsx(Y,{url:"report/export-familymembers-excel",queryParams:d,icon:a.jsx(ke,{}),label:"Export Family Members as XLSX"})]}),a.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[a.jsxs("form",{onSubmit:te,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[a.jsx(Ce,{type:"text",placeholder:"Search Family or House No.",value:E,onChange:e=>H(e.target.value),onKeyDown:e=>le("name",e.target.value),className:"w-full"}),a.jsxs("div",{className:"relative group z-50",children:[a.jsx(b,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:a.jsx(Pe,{})}),a.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]})]}),a.jsxs("div",{className:"relative group z-50",children:[a.jsx(b,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",onClick:oe,children:a.jsx(Ye,{className:"w-4 h-4"})}),a.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add a Family"})]}),a.jsx(K,{href:route("resident.create"),children:a.jsxs("div",{className:"relative group z-50",children:[a.jsx(b,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",children:a.jsx(Le,{className:"w-4 h-4"})}),a.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add Household"})]})})]})]}),D&&a.jsx(Ee,{queryParams:d,searchFieldName:k,visibleFilters:["purok","famtype","household_head","income_bracket"],puroks:Q,showFilters:!0,clearRouteName:"family.index",clearRouteParams:{}}),a.jsx(Se,{passedData:g,allColumns:F,columnRenderers:ne,queryParams:d,visibleColumns:A,showTotal:!0})]}),a.jsxs(De,{isOpen:q,onClose:()=>{P()},title:p?"Edit a Family":"Create a Family",children:[a.jsxs("p",{className:"text-sm text-black bg-white/10 backdrop-blur-sm border border-white/40 rounded-lg p-4 mb-6 shadow-lg",children:[a.jsx("strong",{children:"Reminder:"})," To add a family, the household head and all family members must already be registered as residents. If they are not yet registered, please create a household first before proceeding."]}),a.jsxs("form",{className:"bg-gradient-to-br from-blue-50 via-white to-blue-100 border border-blue-200 rounded-2xl shadow-xl p-8 text-gray-800",onSubmit:p?be:pe,children:[" "," ",a.jsxs("div",{className:"mb-8 text-left",children:[" ",a.jsxs("h2",{className:"text-2xl font-bold text-blue-900 mb-2",children:[" ",p?"Update Family Profile":"Register a New Family"," "]})," ",a.jsxs("p",{className:"text-gray-600 text-sm max-w-2xl",children:[" ","Provide accurate household details for the barangay records. Start by selecting the household head, then add all family members with their corresponding relationships and roles."," "]})," "]})," ",a.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 mb-6",children:[a.jsx("h3",{className:"text-xl font-semibold text-blue-800 mb-4 flex items-center gap-2",children:"Family Head Information"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[a.jsxs("div",{className:"md:row-span-2 md:col-span-2 flex flex-col items-center space-y-3",children:[a.jsx(G,{htmlFor:"resident_image",value:"Profile Photo"}),a.jsx("img",{src:o.resident_image?`/storage/${o.resident_image}`:"/images/default-avatar.jpg",alt:"Resident Image",className:"w-32 h-32 object-cover rounded-full border border-gray-300 shadow-sm"})]}),a.jsxs("div",{className:"md:col-span-4 space-y-4",children:[a.jsx(x,{label:"Full Name",name:"resident_name",value:o.resident_name||"",placeholder:"Select a resident",onChange:ue,items:O}),a.jsx(V,{message:U.resident_id,className:"mt-1"}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[a.jsx(h,{label:"Birthdate",name:"birthdate",value:o.birthdate||"",readOnly:!0}),a.jsx(h,{label:"Purok Number",name:"purok_number",value:o.purok_number,readOnly:!0}),a.jsx(h,{label:"House Number",name:"house_number",value:o.house_number,readOnly:!0})]}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4",children:[a.jsx(h,{label:"Family Name (Optional)",name:"family_name",value:o.family_name||"",onChange:e=>c("family_name",e.target.value),placeholder:"Enter family name (optional)"}),a.jsx(x,{label:"Family Type",value:o.family_type||"",items:[{label:"Nuclear",value:"nuclear"},{label:"Extended",value:"extended"},{label:"Single Parent",value:"single_parent"},{label:"Grandparent",value:"grandparent"},{label:"Childless",value:"childless"},{label:"Cohabiting Partners",value:"cohabiting_partners"},{label:"One-person Household",value:"one_person_household"},{label:"Roommates",value:"roommates"}],onChange:e=>c("family_type",e.target.value),placeholder:"e.g., Nuclear, Extended"})]})]})]})]})," ",a.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[" ",a.jsxs("h3",{className:"text-xl font-semibold text-blue-800 mb-4 flex items-center gap-2",children:[" ","Family Members"," "]})," ",a.jsxs("p",{className:"text-gray-600 text-sm mb-4",children:[" ","Add all household members below. Make sure their information is accurate and relationships to the household head are correctly specified."," "]})," ",a.jsxs("div",{className:"space-y-4",children:[" ",(o.members||[]).map((e,s)=>a.jsxs("div",{className:"relative bg-gray-50 border border-gray-200 p-5 rounded-lg shadow-sm hover:shadow-md transition-shadow",children:[" ",a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[" ",a.jsxs("div",{className:"md:row-span-2 md:col-span-2 flex flex-col items-center space-y-3",children:[" ",a.jsx(G,{htmlFor:"resident_image",value:"Profile Photo"})," ",a.jsx("img",{src:e.resident_image?`/storage/${e.resident_image}`:"/images/default-avatar.jpg",alt:"Resident Image",className:"w-24 h-24 object-cover rounded-full border border-gray-300"})," "]})," ",a.jsxs("div",{className:"md:col-span-4 space-y-3",children:[" ",a.jsx(x,{label:"Full Name",name:"resident_name",value:e.resident_name||"",placeholder:"Select a resident",onChange:l=>he(l,s),items:O})," ",a.jsx(V,{message:U[`members.${s}.resident_id`],className:"mt-1"})," ",a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[" ",a.jsx(h,{label:"Birthdate",name:"birthdate",value:e.birthdate||"",readOnly:!0})," ",a.jsx(h,{label:"Purok Number",name:"purok_number",value:e.purok_number||"",readOnly:!0})," "]})," "]})," "]})," "," ",a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[" ",a.jsx(x,{label:"Relationship to Head",name:"relationship_to_head",onChange:l=>L(l,s),value:e.relationship_to_head,items:[{label:"Spouse",value:"spouse"},{label:"Child",value:"child"},{label:"Sibling",value:"sibling"},{label:"Parent",value:"parent"},{label:"Parent-in-law",value:"parent_in_law"},{label:"Grandparent",value:"grandparent"}]})," ",a.jsx(x,{label:"Household Position",name:"household_position",onChange:l=>L(l,s),value:e.household_position,items:[{label:"Primary/Nuclear",value:"primary"},{label:"Extended",value:"extended"},{label:"Boarder",value:"boarder"}]})," "]})," "," ",a.jsxs("button",{type:"button",onClick:()=>ce(s),className:"absolute top-3 right-3 text-red-500 hover:text-red-700 text-2xl transition-colors",title:"Remove Member",children:[" ",a.jsx(Ie,{})," "]})," "]},s))," "," ",a.jsxs("div",{className:"flex justify-between items-center mt-6",children:[" ",a.jsxs("button",{type:"button",onClick:de,className:"flex items-center text-blue-700 hover:text-blue-900 text-sm font-medium transition",children:[" ",a.jsx(Re,{className:"text-3xl mr-1"})," ","Add Member"," "]})," ",a.jsxs("div",{className:"flex items-center gap-3",children:[" ",!p&&a.jsxs(b,{type:"button",onClick:B,children:[" ",a.jsx(ze,{})," Reset"," "]})," ",a.jsxs(b,{className:"bg-blue-700 hover:bg-blue-500 text-white",type:"submit",children:[" ",p?"Update":"Add"," ",a.jsx(Ke,{})," "]})," "]})," "]})," "]})," "]})," "]})]}),a.jsx(Ue,{isOpen:ee,onClose:()=>{v(!1)},onConfirm:ge,residentId:w})]})})]})}export{Va as default};
