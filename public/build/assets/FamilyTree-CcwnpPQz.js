import{r as F,j as c,K as ve,m as we,L as je}from"./app-CSbLTV9t.js";import ze from"./BreadcrumbsHeader-CQaDVuiA.js";import{D as fe}from"./DropdownInputField-D-lPqSgr.js";import{S as pe,r as Ne,d as Se,i as be,T as ie,a as re}from"./transform-ChDKN-R9.js";import{f as Me}from"./index-k6Ra7WmB.js";import _e from"./SidebarModal-Ca0ENWih.js";import ke,{personDetailTitle as Te}from"./PersonDetailContent-BL527x7d.js";import{I as oe}from"./InputError-BCqWxJV0.js";import{I as J}from"./InputField-B1L9QxNV.js";import{I as ae}from"./InputLabel-D9dJg9rZ.js";import{S as Re}from"./SelectField-7y4sEYBE.js";import{B as ge}from"./button-Baqcf9KW.js";import{S as Ee}from"./AdminLayout-CQAB1boG.js";import{t as se,T as Ce}from"./index-BKWT8n_e.js";import{c as $e}from"./createLucideIcon-K65SoRPX.js";import"./breadcrumb-BysmSHHT.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./chevron-right-ZDo9j4tz.js";import"./sidebar-EM1pc_Vu.js";import"./input-HZV2GfRj.js";import"./index-BWMtPXXG.js";import"./index-CLKsPuj0.js";import"./floating-ui.react-dom-DHVDvaGl.js";import"./x-DSSMIW7T.js";import"./skeleton-C3jJoeQy.js";import"./tooltip-b0GAWXCC.js";import"./string-CFFdVFMV.js";import"./iconBase-DIY0yPu9.js";import"./index-Bw3HOa7F.js";import"./constants-CQOY_faM.js";import"./index-BqPLuFbr.js";import"./heart-pulse-CgKjARwL.js";import"./nav-user-qFIfSs4r.js";import"./avatar-DBnd5X0z.js";import"./dropdown-menu-DsAxoPEU.js";import"./check-xGOvrYiq.js";import"./useAppUrl-CCPDQKWJ.js";import"./users-round-CTpkNJgD.js";import"./chevron-up-BdT9BwPw.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]],Ie=$e("workflow",Be);function q(e){return typeof e=="string"?new pe([[document.querySelector(e)]],[document.documentElement]):new pe([[e]],Ne)}function Ae(e){let n;for(;n=e.sourceEvent;)e=n;return e}function K(e,n){if(e=Ae(e),n===void 0&&(n=e.currentTarget),n){var i=n.ownerSVGElement||n;if(i.createSVGPoint){var o=i.createSVGPoint();return o.x=e.clientX,o.y=e.clientY,o=o.matrixTransform(n.getScreenCTM().inverse()),[o.x,o.y]}if(n.getBoundingClientRect){var u=n.getBoundingClientRect();return[e.clientX-u.left-n.clientLeft,e.clientY-u.top-n.clientTop]}}return[e.pageX,e.pageY]}const he={capture:!0,passive:!1};function de(e){e.preventDefault(),e.stopImmediatePropagation()}function De(e){var n=e.document.documentElement,i=q(e).on("dragstart.drag",de,he);"onselectstart"in n?i.on("selectstart.drag",de,he):(n.__noselect=n.style.MozUserSelect,n.style.MozUserSelect="none")}function Oe(e,n){var i=e.document.documentElement,o=q(e).on("dragstart.drag",null);n&&(o.on("click.drag",de,he),setTimeout(function(){o.on("click.drag",null)},0)),"onselectstart"in i?o.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect)}var Xe=1e-12;function xe(e){return((e=Math.exp(e))+1/e)/2}function Ye(e){return((e=Math.exp(e))-1/e)/2}function Le(e){return((e=Math.exp(2*e))-1)/(e+1)}const Fe=function e(n,i,o){function u(f,d){var w=f[0],C=f[1],s=f[2],j=d[0],b=d[1],h=d[2],M=j-w,S=b-C,E=M*M+S*S,k,m;if(E<Xe)m=Math.log(h/s)/n,k=function(L){return[w+L*M,C+L*S,s*Math.exp(n*L*m)]};else{var N=Math.sqrt(E),D=(h*h-s*s+o*E)/(2*s*i*N),T=(h*h-s*s-o*E)/(2*h*i*N),$=Math.log(Math.sqrt(D*D+1)-D),O=Math.log(Math.sqrt(T*T+1)-T);m=(O-$)/n,k=function(L){var W=L*m,_=xe($),y=s/(i*N)*(_*Le(n*W+$)-Ye($));return[w+y*M,C+y*S,s*_/xe(n*W+$)]}}return k.duration=m*1e3*n/Math.SQRT2,k}return u.rho=function(f){var d=Math.max(.001,+f),w=d*d,C=w*w;return e(d,w,C)},u}(Math.SQRT2,2,4);function Pe(e){var n=0,i=e.children,o=i&&i.length;if(!o)n=1;else for(;--o>=0;)n+=i[o].value;e.value=n}function Ve(){return this.eachAfter(Pe)}function We(e,n){let i=-1;for(const o of this)e.call(n,o,++i,this);return this}function Ge(e,n){for(var i=this,o=[i],u,f,d=-1;i=o.pop();)if(e.call(n,i,++d,this),u=i.children)for(f=u.length-1;f>=0;--f)o.push(u[f]);return this}function He(e,n){for(var i=this,o=[i],u=[],f,d,w,C=-1;i=o.pop();)if(u.push(i),f=i.children)for(d=0,w=f.length;d<w;++d)o.push(f[d]);for(;i=u.pop();)e.call(n,i,++C,this);return this}function qe(e,n){let i=-1;for(const o of this)if(e.call(n,o,++i,this))return o}function Ke(e){return this.eachAfter(function(n){for(var i=+e(n.data)||0,o=n.children,u=o&&o.length;--u>=0;)i+=o[u].value;n.value=i})}function Ue(e){return this.eachBefore(function(n){n.children&&n.children.sort(e)})}function Qe(e){for(var n=this,i=Ze(n,e),o=[n];n!==i;)n=n.parent,o.push(n);for(var u=o.length;e!==i;)o.splice(u,0,e),e=e.parent;return o}function Ze(e,n){if(e===n)return e;var i=e.ancestors(),o=n.ancestors(),u=null;for(e=i.pop(),n=o.pop();e===n;)u=e,e=i.pop(),n=o.pop();return u}function Je(){for(var e=this,n=[e];e=e.parent;)n.push(e);return n}function et(){return Array.from(this)}function tt(){var e=[];return this.eachBefore(function(n){n.children||e.push(n)}),e}function nt(){var e=this,n=[];return e.each(function(i){i!==e&&n.push({source:i.parent,target:i})}),n}function*it(){var e=this,n,i=[e],o,u,f;do for(n=i.reverse(),i=[];e=n.pop();)if(yield e,o=e.children)for(u=0,f=o.length;u<f;++u)i.push(o[u]);while(i.length)}function me(e,n){e instanceof Map?(e=[void 0,e],n===void 0&&(n=at)):n===void 0&&(n=ot);for(var i=new Z(e),o,u=[i],f,d,w,C;o=u.pop();)if((d=n(o.data))&&(C=(d=Array.from(d)).length))for(o.children=d,w=C-1;w>=0;--w)u.push(f=d[w]=new Z(d[w])),f.parent=o,f.depth=o.depth+1;return i.eachBefore(lt)}function rt(){return me(this).eachBefore(st)}function ot(e){return e.children}function at(e){return Array.isArray(e)?e[1]:null}function st(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function lt(e){var n=0;do e.height=n;while((e=e.parent)&&e.height<++n)}function Z(e){this.data=e,this.depth=this.height=0,this.parent=null}Z.prototype=me.prototype={constructor:Z,count:Ve,each:We,eachAfter:He,eachBefore:Ge,find:qe,sum:Ke,sort:Ue,path:Qe,ancestors:Je,descendants:et,leaves:tt,links:nt,copy:rt,[Symbol.iterator]:it};function ct(e,n){return e.parent===n.parent?1:2}function le(e){var n=e.children;return n?n[0]:e.t}function ce(e){var n=e.children;return n?n[n.length-1]:e.t}function ut(e,n,i){var o=i/(n.i-e.i);n.c-=o,n.s+=i,e.c+=o,n.z+=i,n.m+=i}function ht(e){for(var n=0,i=0,o=e.children,u=o.length,f;--u>=0;)f=o[u],f.z+=n,f.m+=n,n+=f.s+(i+=f.c)}function dt(e,n,i){return e.a.parent===n.parent?e.a:i}function te(e,n){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=n}te.prototype=Object.create(Z.prototype);function mt(e){for(var n=new te(e,0),i,o=[n],u,f,d,w;i=o.pop();)if(f=i._.children)for(i.children=new Array(w=f.length),d=w-1;d>=0;--d)o.push(u=i.children[d]=new te(f[d],d)),u.parent=i;return(n.parent=new te(null,0)).children=[n],n}function ft(){var e=ct,n=1,i=1,o=null;function u(s){var j=mt(s);if(j.eachAfter(f),j.parent.m=-j.z,j.eachBefore(d),o)s.eachBefore(C);else{var b=s,h=s,M=s;s.eachBefore(function(N){N.x<b.x&&(b=N),N.x>h.x&&(h=N),N.depth>M.depth&&(M=N)});var S=b===h?1:e(b,h)/2,E=S-b.x,k=n/(h.x+S+E),m=i/(M.depth||1);s.eachBefore(function(N){N.x=(N.x+E)*k,N.y=N.depth*m})}return s}function f(s){var j=s.children,b=s.parent.children,h=s.i?b[s.i-1]:null;if(j){ht(s);var M=(j[0].z+j[j.length-1].z)/2;h?(s.z=h.z+e(s._,h._),s.m=s.z-M):s.z=M}else h&&(s.z=h.z+e(s._,h._));s.parent.A=w(s,h,s.parent.A||b[0])}function d(s){s._.x=s.z+s.parent.m,s.m+=s.parent.m}function w(s,j,b){if(j){for(var h=s,M=s,S=j,E=h.parent.children[0],k=h.m,m=M.m,N=S.m,D=E.m,T;S=ce(S),h=le(h),S&&h;)E=le(E),M=ce(M),M.a=s,T=S.z+N-h.z-k+e(S._,h._),T>0&&(ut(dt(S,s,b),s,T),k+=T,m+=T),N+=S.m,k+=h.m,D+=E.m,m+=M.m;S&&!ce(M)&&(M.t=S,M.m+=N-m),h&&!le(E)&&(E.t=h,E.m+=k-D,b=s)}return b}function C(s){s.x*=n,s.y=s.depth*i}return u.separation=function(s){return arguments.length?(e=s,u):e},u.size=function(s){return arguments.length?(o=!1,n=+s[0],i=+s[1],u):o?null:[n,i]},u.nodeSize=function(s){return arguments.length?(o=!0,n=+s[0],i=+s[1],u):o?[n,i]:null},u}const ee=e=>()=>e;function pt(e,{sourceEvent:n,target:i,transform:o,dispatch:u}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},transform:{value:o,enumerable:!0,configurable:!0},_:{value:u}})}function ue(e){e.stopImmediatePropagation()}function Q(e){e.preventDefault(),e.stopImmediatePropagation()}function gt(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function xt(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function ye(){return this.__zoom||be}function yt(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function bt(){return navigator.maxTouchPoints||"ontouchstart"in this}function _t(e,n,i){var o=e.invertX(n[0][0])-i[0][0],u=e.invertX(n[1][0])-i[1][0],f=e.invertY(n[0][1])-i[0][1],d=e.invertY(n[1][1])-i[1][1];return e.translate(u>o?(o+u)/2:Math.min(0,o)||Math.max(0,u),d>f?(f+d)/2:Math.min(0,f)||Math.max(0,d))}function vt(){var e=gt,n=xt,i=_t,o=yt,u=bt,f=[0,1/0],d=[[-1/0,-1/0],[1/0,1/0]],w=250,C=Fe,s=Se("start","zoom","end"),j,b,h,M=500,S=150,E=0,k=10;function m(t){t.property("__zoom",ye).on("wheel.zoom",W,{passive:!1}).on("mousedown.zoom",_).on("dblclick.zoom",y).filter(u).on("touchstart.zoom",v).on("touchmove.zoom",I).on("touchend.zoom touchcancel.zoom",R).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}m.transform=function(t,a,r,l){var g=t.selection?t.selection():t;g.property("__zoom",ye),t!==g?$(t,a,r,l):g.interrupt().each(function(){O(this,arguments).event(l).start().zoom(null,typeof a=="function"?a.apply(this,arguments):a).end()})},m.scaleBy=function(t,a,r,l){m.scaleTo(t,function(){var g=this.__zoom.k,x=typeof a=="function"?a.apply(this,arguments):a;return g*x},r,l)},m.scaleTo=function(t,a,r,l){m.transform(t,function(){var g=n.apply(this,arguments),x=this.__zoom,p=r==null?T(g):typeof r=="function"?r.apply(this,arguments):r,z=x.invert(p),B=typeof a=="function"?a.apply(this,arguments):a;return i(D(N(x,B),p,z),g,d)},r,l)},m.translateBy=function(t,a,r,l){m.transform(t,function(){return i(this.__zoom.translate(typeof a=="function"?a.apply(this,arguments):a,typeof r=="function"?r.apply(this,arguments):r),n.apply(this,arguments),d)},null,l)},m.translateTo=function(t,a,r,l,g){m.transform(t,function(){var x=n.apply(this,arguments),p=this.__zoom,z=l==null?T(x):typeof l=="function"?l.apply(this,arguments):l;return i(be.translate(z[0],z[1]).scale(p.k).translate(typeof a=="function"?-a.apply(this,arguments):-a,typeof r=="function"?-r.apply(this,arguments):-r),x,d)},l,g)};function N(t,a){return a=Math.max(f[0],Math.min(f[1],a)),a===t.k?t:new ie(a,t.x,t.y)}function D(t,a,r){var l=a[0]-r[0]*t.k,g=a[1]-r[1]*t.k;return l===t.x&&g===t.y?t:new ie(t.k,l,g)}function T(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function $(t,a,r,l){t.on("start.zoom",function(){O(this,arguments).event(l).start()}).on("interrupt.zoom end.zoom",function(){O(this,arguments).event(l).end()}).tween("zoom",function(){var g=this,x=arguments,p=O(g,x).event(l),z=n.apply(g,x),B=r==null?T(z):typeof r=="function"?r.apply(g,x):r,Y=Math.max(z[1][0]-z[0][0],z[1][1]-z[0][1]),A=g.__zoom,P=typeof a=="function"?a.apply(g,x):a,G=C(A.invert(B).concat(Y/A.k),P.invert(B).concat(Y/P.k));return function(V){if(V===1)V=P;else{var H=G(V),ne=Y/H[2];V=new ie(ne,B[0]-H[0]*ne,B[1]-H[1]*ne)}p.zoom(null,V)}})}function O(t,a,r){return!r&&t.__zooming||new L(t,a)}function L(t,a){this.that=t,this.args=a,this.active=0,this.sourceEvent=null,this.extent=n.apply(t,a),this.taps=0}L.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,a){return this.mouse&&t!=="mouse"&&(this.mouse[1]=a.invert(this.mouse[0])),this.touch0&&t!=="touch"&&(this.touch0[1]=a.invert(this.touch0[0])),this.touch1&&t!=="touch"&&(this.touch1[1]=a.invert(this.touch1[0])),this.that.__zoom=a,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var a=q(this.that).datum();s.call(t,this.that,new pt(t,{sourceEvent:this.sourceEvent,target:m,transform:this.that.__zoom,dispatch:s}),a)}};function W(t,...a){if(!e.apply(this,arguments))return;var r=O(this,a).event(t),l=this.__zoom,g=Math.max(f[0],Math.min(f[1],l.k*Math.pow(2,o.apply(this,arguments)))),x=K(t);if(r.wheel)(r.mouse[0][0]!==x[0]||r.mouse[0][1]!==x[1])&&(r.mouse[1]=l.invert(r.mouse[0]=x)),clearTimeout(r.wheel);else{if(l.k===g)return;r.mouse=[x,l.invert(x)],re(this),r.start()}Q(t),r.wheel=setTimeout(p,S),r.zoom("mouse",i(D(N(l,g),r.mouse[0],r.mouse[1]),r.extent,d));function p(){r.wheel=null,r.end()}}function _(t,...a){if(h||!e.apply(this,arguments))return;var r=t.currentTarget,l=O(this,a,!0).event(t),g=q(t.view).on("mousemove.zoom",B,!0).on("mouseup.zoom",Y,!0),x=K(t,r),p=t.clientX,z=t.clientY;De(t.view),ue(t),l.mouse=[x,this.__zoom.invert(x)],re(this),l.start();function B(A){if(Q(A),!l.moved){var P=A.clientX-p,G=A.clientY-z;l.moved=P*P+G*G>E}l.event(A).zoom("mouse",i(D(l.that.__zoom,l.mouse[0]=K(A,r),l.mouse[1]),l.extent,d))}function Y(A){g.on("mousemove.zoom mouseup.zoom",null),Oe(A.view,l.moved),Q(A),l.event(A).end()}}function y(t,...a){if(e.apply(this,arguments)){var r=this.__zoom,l=K(t.changedTouches?t.changedTouches[0]:t,this),g=r.invert(l),x=r.k*(t.shiftKey?.5:2),p=i(D(N(r,x),l,g),n.apply(this,a),d);Q(t),w>0?q(this).transition().duration(w).call($,p,l,t):q(this).call(m.transform,p,l,t)}}function v(t,...a){if(e.apply(this,arguments)){var r=t.touches,l=r.length,g=O(this,a,t.changedTouches.length===l).event(t),x,p,z,B;for(ue(t),p=0;p<l;++p)z=r[p],B=K(z,this),B=[B,this.__zoom.invert(B),z.identifier],g.touch0?!g.touch1&&g.touch0[2]!==B[2]&&(g.touch1=B,g.taps=0):(g.touch0=B,x=!0,g.taps=1+!!j);j&&(j=clearTimeout(j)),x&&(g.taps<2&&(b=B[0],j=setTimeout(function(){j=null},M)),re(this),g.start())}}function I(t,...a){if(this.__zooming){var r=O(this,a).event(t),l=t.changedTouches,g=l.length,x,p,z,B;for(Q(t),x=0;x<g;++x)p=l[x],z=K(p,this),r.touch0&&r.touch0[2]===p.identifier?r.touch0[0]=z:r.touch1&&r.touch1[2]===p.identifier&&(r.touch1[0]=z);if(p=r.that.__zoom,r.touch1){var Y=r.touch0[0],A=r.touch0[1],P=r.touch1[0],G=r.touch1[1],V=(V=P[0]-Y[0])*V+(V=P[1]-Y[1])*V,H=(H=G[0]-A[0])*H+(H=G[1]-A[1])*H;p=N(p,Math.sqrt(V/H)),z=[(Y[0]+P[0])/2,(Y[1]+P[1])/2],B=[(A[0]+G[0])/2,(A[1]+G[1])/2]}else if(r.touch0)z=r.touch0[0],B=r.touch0[1];else return;r.zoom("touch",i(D(p,z,B),r.extent,d))}}function R(t,...a){if(this.__zooming){var r=O(this,a).event(t),l=t.changedTouches,g=l.length,x,p;for(ue(t),h&&clearTimeout(h),h=setTimeout(function(){h=null},M),x=0;x<g;++x)p=l[x],r.touch0&&r.touch0[2]===p.identifier?delete r.touch0:r.touch1&&r.touch1[2]===p.identifier&&delete r.touch1;if(r.touch1&&!r.touch0&&(r.touch0=r.touch1,delete r.touch1),r.touch0)r.touch0[1]=this.__zoom.invert(r.touch0[0]);else if(r.end(),r.taps===2&&(p=K(p,this),Math.hypot(b[0]-p[0],b[1]-p[1])<k)){var z=q(this).on("dblclick.zoom");z&&z.apply(this,arguments)}}}return m.wheelDelta=function(t){return arguments.length?(o=typeof t=="function"?t:ee(+t),m):o},m.filter=function(t){return arguments.length?(e=typeof t=="function"?t:ee(!!t),m):e},m.touchable=function(t){return arguments.length?(u=typeof t=="function"?t:ee(!!t),m):u},m.extent=function(t){return arguments.length?(n=typeof t=="function"?t:ee([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),m):n},m.scaleExtent=function(t){return arguments.length?(f[0]=+t[0],f[1]=+t[1],m):[f[0],f[1]]},m.translateExtent=function(t){return arguments.length?(d[0][0]=+t[0][0],d[1][0]=+t[1][0],d[0][1]=+t[0][1],d[1][1]=+t[1][1],m):[[d[0][0],d[0][1]],[d[1][0],d[1][1]]]},m.constrain=function(t){return arguments.length?(i=t,m):i},m.duration=function(t){return arguments.length?(w=+t,m):w},m.interpolate=function(t){return arguments.length?(C=t,m):C},m.on=function(){var t=s.on.apply(s,arguments);return t===s?m:t},m.clickDistance=function(t){return arguments.length?(E=(t=+t)*t,m):Math.sqrt(E)},m.tapDistance=function(t){return arguments.length?(k=+t,m):k},m}const wt=({x:e,y:n,person:i,relation:o,onViewDetail:u})=>{const f=F.useRef(null),[d,w]=F.useState(!1);F.useEffect(()=>{const s=f.current;w(s&&s.scrollWidth>s.clientWidth)},[i]);const C=d?"text-xs":"text-sm";return c.jsx("foreignObject",{x:e,y:n,width:260,height:150,children:c.jsx("div",{className:`bg-white rounded-xl shadow-md border p-3 w-[240px] text-sm transition-all duration-200 hover:shadow-lg hover:border-2
        ${o==="Self"?"border-blue-400":"border-gray-300"}`,children:c.jsxs("div",{className:"flex items-start space-x-3",children:[c.jsx("img",{src:(i==null?void 0:i.resident_picture_path)==null?"/images/default-avatar.jpg":`/storage/${i.resident_picture_path}`,alt:`${i==null?void 0:i.firstname}'s photo`,className:"w-14 h-14 rounded-full object-cover border"}),c.jsxs("div",{className:"flex-1 space-y-1",children:[c.jsxs("p",{ref:f,className:`m-0 leading-tight font-medium whitespace-nowrap overflow-hidden ${C}`,children:[i==null?void 0:i.lastname,", ",i==null?void 0:i.firstname," ",i!=null&&i.middlename?i.middlename.charAt(0)+". ":"",(i==null?void 0:i.suffix)??""]}),c.jsx("h2",{className:"m-0 font-semibold text-gray-800",children:o}),c.jsxs("button",{onClick:()=>u({...i,relation:o}),className:"m-0 p-0 text-xs text-blue-500 hover:underline flex items-center space-x-1",children:[c.jsx(Me,{className:"text-base"}),c.jsx("span",{children:"View details"})]})]})]})})})};function jt(e){var b,h,M,S,E;const n=(b=e.self)==null?void 0:b.data,i=((h=e.spouse)==null?void 0:h.data)||[],o=((M=e.siblings)==null?void 0:M.data)||[],u=((S=e.children)==null?void 0:S.data)||[],f=((E=e.parents)==null?void 0:E.data)||[],d={id:"virtual-root",relation:"Root",children:[]},w={...n,id:`self-${n.id}`,relation:"Self",children:[]},C=o.map(k=>({...k,id:`sibling-${k.id}`,relation:"Sibling",children:[]})),s=u.map(k=>{const m=[n==null?void 0:n.id,...i.map(N=>N.id)].filter(Boolean);return{...k,id:`child-${k.id}`,relation:"Child",children:[],parents:m}});let j;if(i.length>0){const k=i.map(m=>({...m,id:`spouse-${m.id}`,relation:"Spouse",children:[]}));j={id:`couple-${n.id}`,isCouple:!0,relation:"Couple",children:s,members:[w,...k]}}else j={...w,children:s};if(f.length>0){const k=f.map(N=>({...N,id:`parent-${N.id}`,relation:"Parent",children:[]})),m={id:`couple-parents-${n.id}`,isCouple:!0,relation:"ParentCouple",members:k,children:[j,...C]};d.children.push(m)}else d.children.push(j,...C);return d}const X=240,U=90,zt=({familyData:e})=>{const n=F.useRef(),[i,o]=F.useState([]),[u,f]=F.useState([]),[d,w]=F.useState(!1),[C,s]=F.useState(null),j=b=>{s(b),w(!0)};return F.useEffect(()=>{const b=jt(e),h=me(b);ft().nodeSize([350,180])(h);const S=h.descendants(),E=Math.min(...S.map(_=>_.y)),k=Math.max(...S.map(_=>_.y)),m=600,N=1200,D=(m-(k-E))/2,T=[];h.descendants().forEach(_=>{var I;const y=_.x+N,v=_.y+D;if(_.data.isCouple&&((I=_.data.members)==null?void 0:I.length)>=1){const R=_.data.members,t=X+130;if(R.length===1)T.push({...R[0],x:y,y:v,relation:R[0].relation||"Relative",id:R[0].id});else{const a=R.find(l=>l.relation==="Self"),r=R.filter(l=>l.relation==="Spouse");if(a)T.push({...a,x:y,y:v,relation:"Self",id:a.id}),r.forEach((l,g)=>{const x=g%2===0?-1:1,p=Math.ceil((g+1)/2),z=y+x*t*p;T.push({...l,x:z,y:v,relation:"Spouse",id:l.id})});else{const l=Math.floor(R.length/2);R.forEach((g,x)=>{const p=(x-l)*t;T.push({...g,x:y+p,y:v,relation:g.relation||"Relative",id:g.id})})}}}else _.data.id!=="virtual-root"&&T.push({..._.data,x:y-X/2-65,y:v,relation:_.data.relation||"Relative",id:_.data.id})}),o(T);const $=[];h.descendants().forEach(_=>{var y,v;if(_.data.isCouple&&((y=_.data.members)==null?void 0:y.length)>=1){const I=_.y+D,t=_.data.members.map(a=>T.find(r=>r.id===a.id)).filter(Boolean);for(let a=0;a<t.length-1;a++)$.push({from:{x:t[a].x+X/2,y:t[a].y+U/2},to:{x:t[a+1].x+X/2,y:t[a+1].y+U/2}});if(((v=_.children)==null?void 0:v.length)>0){const a=_.children.map(p=>T.find(z=>z.id===p.data.id)).filter(Boolean);if(a.length===0)return;const r=t.map(p=>p.x+X/2),l=(Math.min(...r)+Math.max(...r))/2,g=I+U/2,x=g+90;if(a.length===1&&t.length===1){const p=a[0],z=p.x+X/2;$.push({from:{x:l,y:g},to:{x:z,y:p.y}})}else if(a.length===1){const p=a[0],z=p.x+X/2;$.push({from:{x:l,y:g},to:{x:l,y:x}}),$.push({from:{x:l,y:x},to:{x:z,y:p.y}})}else{$.push({from:{x:l,y:g},to:{x:l,y:x}});const p=a.map(Y=>Y.x+X/2),z=Math.min(...p),B=Math.max(...p);$.push({from:{x:z,y:x},to:{x:B,y:x}}),a.forEach(Y=>{const A=Y.x+X/2;$.push({from:{x:A,y:x},to:{x:A,y:Y.y}})})}}}}),h.descendants().forEach(_=>{var y;if(!_.data.isCouple&&((y=_.children)==null?void 0:y.length)>0){const v=T.find(r=>r.id===_.data.id);if(!v)return;const I=v.x+X/2,R=v.y+U/2,t=R+90,a=_.children.map(r=>T.find(l=>l.id===r.data.id)).filter(Boolean);if(a.length===1){const r=a[0],l=r.x+X/2;$.push({from:{x:I,y:R},to:{x:l,y:r.y}})}else if(a.length>1){$.push({from:{x:I,y:R},to:{x:I,y:t}});const r=a.map(x=>x.x+X/2),l=Math.min(...r),g=Math.max(...r);$.push({from:{x:l,y:t},to:{x:g,y:t}}),a.forEach(x=>{const p=x.x+X/2;$.push({from:{x:p,y:t},to:{x:p,y:x.y}})})}}});const O=new Map;h.descendants().forEach(_=>{if(_.parent){const y=_.parent.data.id,v=T.some(R=>R.id===y);if(y==="virtual-root"||!v&&!_.parent.data.isCouple){O.has(y)||O.set(y,[]);const R=T.find(t=>t.id===_.data.id);R&&O.get(y).push(R)}}}),O.forEach(_=>{if(_.length>1){_.sort((R,t)=>R.x-t.x);const y=_[0],v=_[_.length-1],I=y.y+U/2+5;$.push({from:{x:y.x+X/2,y:I},to:{x:v.x+X/2,y:I}}),_.forEach(R=>{$.push({from:{x:R.x+X/2,y:I},to:{x:R.x+X/2,y:R.y+U/2}})})}}),f($);const L=q(n.current),W=L.select("g");L.call(vt().scaleExtent([.3,2]).on("zoom",_=>{W.attr("transform",_.transform)}))},[e]),c.jsxs("div",{className:"w-[1170px] border rounded-lg bg-dot-grid",children:[c.jsx("div",{className:"overflow-auto max-h-[600px] max-w-full rounded-lg",children:c.jsx("svg",{ref:n,width:1100,height:1e3,viewBox:"0 0 2000 2000",className:"block",children:c.jsxs("g",{children:[u.map((b,h)=>c.jsx("line",{x1:b.from.x,y1:b.from.y,x2:b.to.x,y2:b.to.y,stroke:"#1E40AF",strokeWidth:2},`line-${h}`)),i.map((b,h)=>c.jsx(wt,{x:b.x,y:b.y,person:b,relation:b.relation,onViewDetail:j},`card-${h}`))]})})}),c.jsx(_e,{isOpen:d,onClose:()=>w(!1),title:Te,children:c.jsx(ke,{person:C})})]})};function dn({family_tree:e,residents:n}){var O,L,W,_;const i=((W=(L=(O=e==null?void 0:e.self)==null?void 0:O.data)==null?void 0:L.family)==null?void 0:W.family_name)||"Unnamed",o=[{label:"Residents Information",showOnMobile:!1},{label:"Residents Table",href:route("resident.index"),showOnMobile:!1},{label:"Family Tree",showOnMobile:!0}],u=ve().props,f=(u==null?void 0:u.success)??null,d=(u==null?void 0:u.error)??null,w=n.map(y=>({value:y.id,label:`${y.firstname} ${y.middlename} ${y.lastname} ${y.suffix??""}`,image:y.resident_picture_path||null,birthdate:y.birthdate||null,purok_number:y.purok_number||null})),[C,s]=F.useState(!1),j=((_=e==null?void 0:e.self)==null?void 0:_.data)||null,{data:b,setData:h,post:M,errors:S,reset:E,clearErrors:k}=we({resident_id:null,related_to:null,relationship:"",family_relation_id:null,_method:void 0}),m=()=>{j&&h({resident_id:j.id,resident_id_name:`${j.firstname} ${j.middlename} ${j.lastname}`,resident_birthdate:j.birthdate,resident_image:j.resident_picture_path,resident_purok:j.purok_number,related_to:null,related_to_name:"",related_to_birthdate:null,related_to_image:null,related_to_purok:null,relationship:""}),s(!0)},N=y=>{y.preventDefault(),M(route("family_tree.store"),{onError:v=>{const I=Object.values(v).map((R,t)=>`<div key=${t}> ${R}</div>`);se.error("Validation Error",{description:c.jsx("div",{dangerouslySetInnerHTML:{__html:I.join("")}}),duration:4e3,closeButton:!0})}})},D=()=>{s(!1),E(),k()},T=(y,v)=>{v&&(h(`${y}`,v.value||v.id),h(`${y}_name`,v.label||`${v.firstname} ${v.middlename} ${v.lastname}`),h(`${y}_image`,v.image||null),h(`${y}_birthdate`,v.birthdate||null),h(`${y}_purok`,v.purok_number||null))},$=y=>{const v=w.find(I=>I.value==y);T("related_to",v)};return F.useEffect(()=>{f&&(D(),se.success(f,{description:"Operation successful!",duration:3e3,closeButton:!0})),u.success=null},[f]),F.useEffect(()=>{d&&(se.error(d,{description:"Operation failed!",duration:3e3,closeButton:!0}),D()),u.error=null},[d]),c.jsxs(Ee,{children:[c.jsx(je,{title:"Resident Dashboard"}),c.jsx(ze,{breadcrumbs:o}),c.jsx(Ce,{richColors:!0}),c.jsx(c.Fragment,{children:c.jsxs("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:[c.jsxs("div",{className:"overflow-hidden bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 my-8",children:[c.jsxs("div",{className:"flex justify-between",children:[c.jsxs("h2",{className:"text-xl font-bold mb-3",children:[i," Family Tree"]}),c.jsxs("div",{className:"relative group z-5 mr-4",children:[c.jsx(ge,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",onClick:m,children:c.jsx(Ie,{})}),c.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add A Relation"})]})]}),c.jsx("div",{className:"h-[600px] w-[1000px]",children:c.jsx(zt,{familyData:e})})]}),c.jsxs(F.Suspense,{fallback:null,children:[" ",c.jsx(_e,{isOpen:C,onClose:()=>D(),title:"Add a Relationship to the Tree",children:c.jsx("div",{className:"w-full rounded-xl border border-white/20 bg-white/10 backdrop-blur-md shadow-lg text-sm text-black p-4 space-y-4",children:c.jsxs("form",{className:"space-y-8 bg-white p-6 rounded-xl shadow-md border border-gray-200",onSubmit:N,children:[c.jsxs("div",{className:"mb-6",children:[c.jsx("h3",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Add Family Relation"}),c.jsx("p",{className:"text-gray-600 text-sm",children:"Define the relationship between residents in the household. This helps maintain a proper family tree and household hierarchy."})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("h4",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Resident Info"}),c.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"Select the primary resident. Their basic details will auto-populate."}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 md:gap-x-6",children:[c.jsxs("div",{className:"md:row-span-2 md:col-span-2 flex flex-col items-center space-y-2",children:[c.jsx(ae,{htmlFor:"resident_image",value:"Resident Profile"}),c.jsx("img",{src:b.resident_image?`/storage/${b.resident_image}`:"/images/default-avatar.jpg",alt:"Resident",className:"w-32 h-32 object-cover rounded-full border border-gray-200 shadow-sm"})]}),c.jsxs("div",{className:"md:col-span-4 space-y-4",children:[c.jsx(fe,{label:"Resident",name:"resident_id_name",value:b.resident_id_name||"",placeholder:"Select a resident",items:w,onChange:y=>{const v=w.find(I=>I.id===y);v&&(h("resident_id",v.id),h("resident_id_name",v.name),h("resident_image",v.image),h("resident_birthdate",v.birthdate),h("resident_purok",v.purok_number))},disabled:!0}),c.jsx(oe,{message:S.resident_id,className:"mt-1 text-sm text-red-500"}),c.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[c.jsx(J,{label:"Birthdate",name:"resident_birthdate",value:b.resident_birthdate||"",readOnly:!0}),c.jsx(J,{label:"Purok Number",name:"resident_purok",value:b.resident_purok||"",readOnly:!0})]})]})]})]}),c.jsxs("div",{className:"space-y-4 mt-6",children:[c.jsx("h4",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Related Resident Info"}),c.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"Select the related resident and specify their relationship to the primary resident."}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 md:gap-x-6",children:[c.jsxs("div",{className:"md:row-span-2 md:col-span-2 flex flex-col items-center space-y-2",children:[c.jsx(ae,{htmlFor:"related_to_image",value:"Related Resident Profile"}),c.jsx("img",{src:b.related_to_image?`/storage/${b.related_to_image}`:"/images/default-avatar.jpg",alt:"Related Resident",className:"w-32 h-32 object-cover rounded-full border border-gray-200 shadow-sm"})]}),c.jsxs("div",{className:"md:col-span-4 space-y-4",children:[c.jsx(fe,{label:"Related To",name:"related_to_name",value:b.related_to_name||"",placeholder:"Select related resident",items:w,onChange:y=>{$(y.target.value)}}),c.jsx(oe,{message:S.related_to,className:"mt-1 text-sm text-red-500"}),c.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[c.jsx(J,{label:"Birthdate",name:"related_to_birthdate",value:b.related_to_birthdate||"",readOnly:!0}),c.jsx(J,{label:"Purok Number",name:"related_to_purok",value:b.related_to_purok||"",readOnly:!0})]})]})]})]}),c.jsxs("div",{className:"mt-6",children:[c.jsx(ae,{value:"Relationship Type"}),c.jsx("p",{className:"text-gray-500 text-sm mb-2",children:"Select the type of relationship between the primary resident and the related resident."}),c.jsx(Re,{label:"Relationship",name:"relationship",value:b.relationship,onChange:y=>h("relationship",y.target.value),placeholder:"Select relationship",items:[{label:"Spouse",value:"spouse",subtitle:"Legally married partner of the head"},{label:"Child",value:"child",subtitle:"Son or daughter of the head"},{label:"Sibling",value:"sibling",subtitle:"Brother or sister of the head"},{label:"Parent",value:"parent",subtitle:"Father or mother of the head"}]}),c.jsx(oe,{message:S.relationship,className:"mt-1 text-sm text-red-500"})]}),c.jsx("div",{className:"flex justify-end mt-8",children:c.jsx(ge,{className:"bg-blue-700 hover:bg-blue-600 text-white px-6 py-2 rounded-lg shadow-md transition-all duration-200 ease-in-out",type:"submit",children:"Add Relation"})})]})})})]})]})})]})}export{dn as default};
