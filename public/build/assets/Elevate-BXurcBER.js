import{K as J,m as Q,r as O,j as e,L as X}from"./app-OMiIBAVv.js";import Z from"./BreadcrumbsHeader-D7yXDAqZ.js";import{I as j}from"./InputError-LtgWhWIb.js";import{I as h}from"./InputField-BN9Kcp6u.js";import{I as d}from"./InputLabel-Cqcva6ji.js";import{B as E}from"./button-DSR4zr8t.js";import{S as ee}from"./AdminLayout-CUYq8DRk.js";import{S as y}from"./SelectField-0PSr83-z.js";import{T as N}from"./textarea-Cw2TG8Ij.js";import{P as w}from"./ParticipantSection-BcTddEag.js";import{t as S,T as se}from"./index-0Qv22I-m.js";import{R as ae}from"./rotate-ccw-X1iZFrTN.js";import{c as ne}from"./createLucideIcon-Axl_0YCz.js";import"./breadcrumb-BupgMzbl.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./chevron-right-Cy23RFOt.js";import"./sidebar-8I0oMIHa.js";import"./input-BGuCCM3F.js";import"./index-CI6SsBKC.js";import"./index-BLQZ4u8d.js";import"./floating-ui.react-dom-CMRH_ZRG.js";import"./x-CWRGpm6F.js";import"./skeleton-B3ns0wAt.js";import"./tooltip-DovJGv4D.js";import"./nav-user-CHo7Aeqf.js";import"./avatar-EoKRnGG_.js";import"./dropdown-menu-Bvu9yf_7.js";import"./check-CuPlmUjy.js";import"./useAppUrl-D_iSPAaw.js";import"./users-round-DM5XvS4t.js";import"./heart-pulse-BEye5CQy.js";import"./chevron-up-aIKK6lnp.js";import"./index-CK7UpZTr.js";import"./iconBase-DPQdzrdi.js";import"./DropdownInputField-BkfrznIy.js";import"./constants-iESbBslm.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]],oe=ne("calendar-check",re);function Ke({residents:G,blotter_details:s}){var k,C,R,D,A,T,_,B,L,M,P,$,F,H;const K=[{label:"Katarungang Pambarangay",showOnMobile:!1},{label:"Blotter Reports",href:route("blotter_report.index"),showOnMobile:!1},{label:"Summons",href:route("summon.index"),showOnMobile:!1},{label:"Elevate to Summon",showOnMobile:!0}],u=J().props,v=(u==null?void 0:u.success)??null,p=(u==null?void 0:u.error)??null,f=(a,o)=>(a==null?void 0:a.filter(r=>r.role_type===o).map(r=>{var t,c,i,l,x;return{resident_id:r.resident_id||"",resident_name:r.name||r.display_name||"",birthdate:((t=r.resident)==null?void 0:t.birthdate)||"",gender:((c=r.resident)==null?void 0:c.gender)||"",purok_number:((i=r.resident)==null?void 0:i.purok_number)||"",email:((l=r.resident)==null?void 0:l.email)||"",contact_number:((x=r.resident)==null?void 0:x.contact_number)||"",notes:r.notes||""}}))||[{resident_id:""}],{data:n,setData:m,post:U,errors:g,reset:V}=Q({type_of_incident:(s==null?void 0:s.type_of_incident)||"",narrative_details:(s==null?void 0:s.narrative_details)||"",actions_taken:(s==null?void 0:s.actions_taken)||"",report_status:(s==null?void 0:s.report_status)||"pending",location:(s==null?void 0:s.location)||"",resolution:(s==null?void 0:s.resolution)||"",recommendations:(s==null?void 0:s.recommendations)||"",incident_date:(s==null?void 0:s.incident_date)||"",recorded_by:(s==null?void 0:s.recorded_by)||null,complainants:f(s==null?void 0:s.participants,"complainant"),respondents:f(s==null?void 0:s.participants,"respondent"),witnesses:f(s==null?void 0:s.participants,"witness"),summons:(s==null?void 0:s.summons)||[],newSession:{session_number:"",hearing_date:"",session_status:"scheduled",session_remarks:""},summon_status:(k=s==null?void 0:s.summons)!=null&&k.length?s.summons[s.summons.length-1].status:"",summon_remarks:(C=s==null?void 0:s.summons)!=null&&C.length?s.summons[s.summons.length-1].remarks:"",blotter_id:s.id}),b=G.map(a=>({label:`${a.firstname} ${a.middlename} ${a.lastname} ${a.suffix??""}`,value:a.id.toString()})),W=a=>{a.preventDefault(),U(route("summon.store"),{onError:o=>{console.error("Validation Errors:",o);const r=Object.values(o).map((t,c)=>`<div key=${c} class="mb-1">â€¢ ${t}</div>`);S.error("Validation Error",{description:e.jsx("div",{className:"text-sm text-red-700 space-y-1",dangerouslySetInnerHTML:{__html:r.join("")}}),duration:5e3,closeButton:!0})}})},Y=(R=n.summons)==null?void 0:R.some(a=>{var o;return(o=a.takes)==null?void 0:o.some(r=>r.originallyScheduled||r.session_status==="scheduled")}),z=(D=n.summons)==null?void 0:D.some(a=>{var o;return(o=a.takes)==null?void 0:o.some(r=>(r.session_number??0)>=3)}),q=!Y&&!z;return O.useEffect(()=>{v&&S.success(v,{description:"Operation successful!",duration:3e3,closeButton:!0}),u.success=null},[v]),O.useEffect(()=>{p&&S.error(p,{description:"Operation failed!",duration:3e3,closeButton:!0}),u.error=null},[p]),e.jsxs(ee,{children:[e.jsx(X,{title:"Resident Dashboard"}),e.jsx(se,{richColors:!0}),e.jsx(Z,{breadcrumbs:K}),e.jsx("div",{children:e.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6",children:e.jsx("div",{className:"overflow-hidden bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 my-8",children:e.jsxs("div",{className:" my-2 p-5",children:[p&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:p}),e.jsx("div",{children:e.jsxs("form",{onSubmit:W,children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-blue-800 mb-2",children:n.summon_status==="closed"?"Summon Details (Closed)":((A=n.summons)==null?void 0:A.length)>0&&((_=(T=n.summons[0])==null?void 0:T.takes)==null?void 0:_.length)>0?"Update Summon Details":"Create Summon Schedule"}),e.jsx("p",{className:"text-sm text-gray-600",children:n.summon_status==="closed"?e.jsxs(e.Fragment,{children:["This summon has been"," ",e.jsx("span",{className:"font-semibold text-red-600",children:"closed"}),". You can review the blotter details, participants, and hearing history, but no new sessions can be scheduled."]}):((B=n.summons)==null?void 0:B.length)>0&&((M=(L=n.summons[0])==null?void 0:L.takes)==null?void 0:M.length)>0?e.jsxs(e.Fragment,{children:["You can"," ",e.jsx("span",{className:"font-semibold text-gray-800",children:"update summon details"})," ","for this blotter report. Review past sessions, adjust status or remarks, and make necessary updates to the summon information."]}):e.jsxs(e.Fragment,{children:["This form allows you to create a"," ",e.jsx("span",{className:"font-semibold text-gray-800",children:"summon"})," ","for the selected"," ",e.jsx("span",{className:"font-semibold text-gray-800",children:"blotter report"}),". Review the blotter details, update fields like"," ",e.jsx("span",{className:"font-semibold",children:"actions taken"}),","," ",e.jsx("span",{className:"font-semibold",children:"recommendations"}),", status, and participants, and schedule the new hearing session."]})})]}),e.jsxs("div",{className:"mb-6 p-6 bg-blue-50 border-l-4 border-blue-400 rounded-xl shadow-sm space-y-4",children:[e.jsx("h3",{className:"text-2xl font-semibold text-blue-700 mb-2",children:"Blotter Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{value:"Type of Incident"}),e.jsx("p",{className:"text-gray-900 font-semibold",children:n.type_of_incident})]}),e.jsxs("div",{children:[e.jsx(d,{value:"Incident Date"}),e.jsx("p",{className:"text-gray-900 font-semibold",children:n.incident_date})]}),e.jsxs("div",{children:[e.jsx(d,{value:"Location"}),e.jsx("p",{className:"text-gray-900 font-semibold",children:n.location})]}),e.jsxs("div",{className:"col-span-1 md:col-span-2 lg:col-span-4",children:[e.jsx(d,{value:"Narrative Details"}),e.jsx("p",{className:"whitespace-pre-line text-gray-800 font-medium",children:n.narrative_details})]})]})]}),e.jsxs("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{value:"Actions Taken"}),e.jsx(N,{value:n.actions_taken||"",onChange:a=>m("actions_taken",a.target.value),placeholder:"What actions were taken?",rows:3,className:"border-blue-300 focus:ring-blue-400 focus:border-blue-400"}),e.jsx(j,{message:g.actions_taken,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(d,{value:"Recommendations"}),e.jsx(N,{value:n.recommendations||"",onChange:a=>m("recommendations",a.target.value),placeholder:"Any recommendations?",rows:3,className:"border-blue-300 focus:ring-blue-400 focus:border-blue-400"}),e.jsx(j,{message:g.recommendations,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(y,{label:"Report Status",value:n.report_status||"",onChange:a=>m("report_status",a.target.value),items:[{label:"Pending",value:"pending"},{label:"On Going",value:"on_going"},{label:"Resolved",value:"resolved"},{label:"Elevated",value:"elevated"}],className:"font-semibold text-gray-800"}),e.jsx(j,{message:g.report_status,className:"mt-1"})]}),e.jsx("div",{children:e.jsx(y,{value:n.summon_status||"",label:"Summon Status",onChange:a=>m("summon_status",a.target.value),items:[{label:"On Going",value:"on_going"},{label:"Closed",value:"closed"}],placeholder:"Select Summon Status",className:"font-semibold text-gray-800"})})]}),e.jsxs("div",{children:[e.jsx(d,{value:"Summon Remarks"}),e.jsx(N,{value:n.summon_remarks||"",onChange:a=>m("summon_remarks",a.target.value),placeholder:"Enter summon remarks",rows:3,className:"mb-4 border-blue-300 focus:ring-blue-400 focus:border-blue-400"}),e.jsx(j,{message:g.summon_remarks,className:"mt-1"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(w,{title:"Complainants",dataArray:n.complainants,setDataArray:a=>m("complainants",a),errors:g,residentsList:b,className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-lg",disableAdd:n.summon_status=="closed"}),e.jsx(w,{title:"Respondents",dataArray:n.respondents,setDataArray:a=>m("respondents",a),errors:g,residentsList:b,className:"bg-red-50 border-l-4 border-red-400 p-4 rounded-lg",disableAdd:n.summon_status=="closed"}),e.jsx(w,{title:"Witnesses",dataArray:n.witnesses,setDataArray:a=>m("witnesses",a),errors:g,residentsList:b,className:"bg-green-50 border-l-4 border-green-400 p-4 rounded-lg",disableAdd:n.summon_status=="closed"})]}),n.summons&&n.summons.length>0&&e.jsxs("div",{className:"mt-8 p-6 bg-gray-50 border-l-4 border-gray-400 rounded-xl space-y-4 shadow-sm",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-700 mb-4",children:"Previous Summon Sessions"}),n.summons.map((a,o)=>e.jsx("div",{className:"space-y-3",children:a.takes.map((r,t)=>{r.originallyScheduled===void 0&&(r.originallyScheduled=r.session_status==="scheduled");const c=r.originallyScheduled;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-3 p-4 bg-white rounded-lg shadow",children:[e.jsxs("div",{children:[e.jsx(d,{value:"Session #"}),c?e.jsx(h,{type:"number",value:r.session_number||"",onChange:i=>{const l=[...n.summons];l[o].takes[t].session_number=i.target.value,m("summons",l)},className:"border-gray-300 focus:ring-gray-400 focus:border-gray-400 font-semibold rounded"}):e.jsx("p",{className:"text-gray-900 font-semibold",children:r.session_number})]}),e.jsxs("div",{children:[e.jsx(d,{value:"Hearing Date"}),c?e.jsx(h,{type:"date",value:r.hearing_date||"",onChange:i=>{const l=[...n.summons];l[o].takes[t].hearing_date=i.target.value,m("summons",l)},className:"border-gray-300 focus:ring-gray-400 focus:border-gray-400 font-semibold rounded"}):e.jsx("p",{className:"text-gray-900 font-semibold",children:r.hearing_date})]}),e.jsxs("div",{children:[e.jsx(d,{value:"Status"}),c?e.jsx(y,{value:r.session_status||"scheduled",onChange:i=>{var I;const l=((I=i==null?void 0:i.target)==null?void 0:I.value)??i,x=[...n.summons];x[o].takes[t].session_status=l,m("summons",x)},items:[{label:"Scheduled",value:"scheduled"},{label:"In Progress",value:"in_progress"},{label:"Completed",value:"completed"},{label:"Adjourned",value:"adjourned"},{label:"Cancelled",value:"cancelled"},{label:"No Show",value:"no_show"}],className:"font-semibold text-gray-800 rounded"}):e.jsx("p",{className:"capitalize text-gray-900 font-semibold",children:r.session_status})]}),e.jsxs("div",{children:[e.jsx(d,{value:"Remarks"}),c?e.jsx(h,{value:r.session_remarks||"",onChange:i=>{const l=[...n.summons];l[o].takes[t].session_remarks=i.target.value,m("summons",l)},placeholder:"Optional remarks",className:"border-gray-300 focus:ring-gray-400 focus:border-gray-400 font-medium rounded"}):e.jsx("p",{className:"text-gray-900 font-medium",children:r.session_remarks||"-"})]})]},t)})},o))]}),n.summon_status!=="closed"&&q&&e.jsxs("div",{className:"mt-8 p-6 bg-gray-50 border-l-4 border-blue-600 rounded-xl space-y-4 shadow-sm",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-700 mb-4",children:"New Summon Session"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{value:"Session #"}),e.jsx(h,{type:"number",value:((P=n.newSession)==null?void 0:P.session_number)||"",onChange:a=>m("newSession",{...n.newSession,session_number:a.target.value}),className:"border-gray-300 focus:ring-gray-400 focus:border-gray-400 rounded-lg p-2 w-full font-semibold text-gray-800"})]}),e.jsxs("div",{children:[e.jsx(d,{value:"Hearing Date"}),e.jsx(h,{type:"date",value:(($=n.newSession)==null?void 0:$.hearing_date)||"",onChange:a=>m("newSession",{...n.newSession,hearing_date:a.target.value}),className:"border-gray-300 focus:ring-gray-400 focus:border-gray-400 rounded-lg p-2 w-full font-semibold text-gray-800"})]}),e.jsxs("div",{children:[e.jsx(d,{value:"Session Status"}),e.jsx(y,{value:((F=n.newSession)==null?void 0:F.session_status)||"scheduled",onChange:a=>{var r;const o=((r=a==null?void 0:a.target)==null?void 0:r.value)??a;m("newSession",{...n.newSession,session_status:o})},items:[{label:"Scheduled",value:"scheduled"},{label:"In Progress",value:"in_progress"},{label:"Completed",value:"completed"},{label:"Adjourned",value:"adjourned"},{label:"Cancelled",value:"cancelled"},{label:"No Show",value:"no_show"}],className:"border-gray-300 focus:ring-gray-400 focus:border-gray-400 rounded-lg p-2 w-full font-semibold text-gray-800"})]}),e.jsxs("div",{children:[e.jsx(d,{value:"Remarks"}),e.jsx(h,{value:((H=n.newSession)==null?void 0:H.session_remarks)||"",onChange:a=>m("newSession",{...n.newSession,session_remarks:a.target.value}),placeholder:"Optional remarks",className:"border-gray-300 focus:ring-gray-400 focus:border-gray-400 rounded-lg p-2 w-full font-medium text-gray-700"})]})]})]}),e.jsxs("div",{className:"flex w-full justify-end items-center mt-7 gap-4",children:[e.jsxs(E,{type:"button",onClick:()=>V(),className:"bg-gray-200 hover:bg-gray-300 text-gray-800",children:[e.jsx(ae,{})," Reset"]}),e.jsxs(E,{type:"submit",className:`w-60 ${n.summon_status==="closed"?"bg-red-700 hover:bg-red-600":"bg-blue-700 hover:bg-blue-600"} text-white`,children:[e.jsx(oe,{className:"w-4 h-4 mr-1"}),n.summon_status==="closed"?"Update Summon Details":"Create Summon Schedule"]})]})]})})]})})})})]})}export{Ke as default};
