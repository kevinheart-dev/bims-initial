import{r as a,m as W,j as t,L as Z,a as ee,S as te}from"./app-CSbLTV9t.js";import{S as se,a as ae}from"./AdminLayout-CQAB1boG.js";import{B as I}from"./button-Baqcf9KW.js";import re from"./BreadcrumbsHeader-CQaDVuiA.js";import"./index-CLKsPuj0.js";import{B as le,U as ie,X as oe}from"./constants-CQOY_faM.js";import{u as ne}from"./useAppUrl-CCPDQKWJ.js";import{t as f,T as ce}from"./index-BKWT8n_e.js";import de from"./DynamicTableControls-nJkmjrjE.js";import{I as ue}from"./input-HZV2GfRj.js";import{F as me}from"./FillterToggle-p8HB-wA3.js";import pe from"./DynamicTable-CYX8Y7lr.js";import xe from"./ActionMenu-BTyRiOW7.js";import fe from"./SidebarModal-Ca0ENWih.js";import he from"./Request-Cz6vkYWC.js";import{S as be}from"./search-w3rx2qu6.js";import{c as ge}from"./createLucideIcon-K65SoRPX.js";import{T as _e}from"./trash-2-D7SnOmvm.js";import"./sidebar-EM1pc_Vu.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./index-BWMtPXXG.js";import"./floating-ui.react-dom-DHVDvaGl.js";import"./x-DSSMIW7T.js";import"./skeleton-C3jJoeQy.js";import"./tooltip-b0GAWXCC.js";import"./nav-user-qFIfSs4r.js";import"./avatar-DBnd5X0z.js";import"./dropdown-menu-DsAxoPEU.js";import"./check-xGOvrYiq.js";import"./chevron-right-ZDo9j4tz.js";import"./users-round-CTpkNJgD.js";import"./heart-pulse-CgKjARwL.js";import"./chevron-up-BdT9BwPw.js";import"./breadcrumb-BysmSHHT.js";import"./ellipsis-Ci4G0pTK.js";import"./InputField-B1L9QxNV.js";import"./DropdownInputField-D-lPqSgr.js";import"./InputError-BCqWxJV0.js";import"./rotate-ccw-CP5E-4aB.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4",key:"1pf5j1"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 15h10",key:"jfw4w8"}],["path",{d:"m9 18 3-3-3-3",key:"112psh"}]],ve=ge("file-input",ye);function pt({documents:h,residents:je,certificates:T,queryParams:r=null,success:d=null,error:i=null}){const A=[{label:"Residents Information",showOnMobile:!1},{label:"Certificate Issuance",showOnMobile:!0}],R=ne(),[Se,k]=a.useState(!1),F=["fullname","fullname_2","day","month","year","ctrl_no","civil_status","civil_status_2","purpose","purpose_2","purok","day_2","month_2","year_2","issued_on"],{data:o,setData:n,post:O,errors:M,setError:b,reset:g,clearErrors:_}=W({resident_id:null,resident_name:"",document_id:null,document_name:"",birthdate:null,age:null,civil_status:"",resident_image:"",purpose:"",placeholders:null}),D=[{label:"January",value:"1"},{label:"February",value:"2"},{label:"March",value:"3"},{label:"April",value:"4"},{label:"May",value:"5"},{label:"June",value:"6"},{label:"July",value:"7"},{label:"August",value:"8"},{label:"September",value:"9"},{label:"October",value:"10"},{label:"November",value:"11"},{label:"December",value:"12"}],L=async e=>{const s=h.find(l=>l.id==e);if(s){n("document_name",s.name),n("document_id",s.id);try{const l=await ee.get(`${R}/document/fetchplaceholders/${e}`);n("placeholders",l.data.placeholders)}catch(l){console.error("Error fetching placeholders:",l)}}},y=h.map(e=>({label:e.name.replace(/\s+/g," ").trim(),value:e.id.toString()})),U=e=>{if(e.preventDefault(),_(),!o.document_id){b("document_id","Please select a certificate.");return}if(!o.purpose){b("purpose","Please provide the purpose.");return}O(route("resident.certificate.store"),o,{onError:s=>{console.error("Validation Errors:",s);const l=Object.values(s).flat();f.error("Validation Error",{description:t.jsx("ul",{className:"list-disc pl-5",children:l.map((Y,G)=>t.jsx("li",{children:Y},G))})})}})};r=r||{};const[v,B]=a.useState(r.name??""),V=e=>{e.preventDefault(),u("name",v)},u=(e,s)=>{s&&s.trim()!==""?r[e]=s:delete r[e],r.page&&delete r.page,te.get(route("certificate.index",r))},q=(e,s)=>{if(s.key==="Enter")u(e,s.target.value);else return},[J,j]=a.useState(!1),[z,S]=a.useState(""),m=Object.entries(r||{}).some(([e,s])=>["certificate_type","request_status","issued_by","issued_at"].includes(e)&&s&&s!=="");a.useEffect(()=>{m&&N(!0)},[m]);const p=[{key:"id",label:"Issued ID"},{key:"certificate",label:"Certificate"},{key:"purpose",label:"Purpose"},{key:"request_status",label:"Request Status"},{key:"issued_by",label:"Issued By"},{key:"issued_at",label:"Issued At"},{key:"control_number",label:"Control Number"},{key:"actions",label:"Actions"}],[w,N]=a.useState(m),P=()=>{window.print()},[Q,we]=a.useState(!0),[C,X]=a.useState(!1),[Ne,Ce]=a.useState(null),$=p.map(e=>e.key),[c,E]=a.useState(()=>{const e=localStorage.getItem("certificate_visible_columns");return e?JSON.parse(e):$});a.useEffect(()=>{localStorage.setItem("certificate_visible_columns",JSON.stringify(c))},[c]);const H={id:e=>t.jsx("span",{className:"text-xs text-gray-700",children:e.id}),certificate:e=>{var s;return t.jsx("span",{className:"text-xs text-indigo-700 font-medium",children:((s=e.document)==null?void 0:s.name)??"—"})},purpose:e=>t.jsx("span",{className:"text-xs text-gray-700",children:e.purpose??"—"}),request_status:e=>t.jsx("span",{className:`text-xs font-medium ${oe[e.request_status]}`,children:ie[e.request_status]??"—"}),issued_by:e=>{var s;return t.jsx("span",{className:"text-xs text-gray-700",children:le[(s=e.issued_by)==null?void 0:s.position]??"—"})},issued_at:e=>t.jsx("span",{className:"text-xs text-gray-600",children:e.issued_at??"—"}),control_number:e=>t.jsx("span",{className:"text-xs text-gray-600",children:e.control_number??"—"}),actions:e=>t.jsx(xe,{actions:[{label:"Delete",icon:t.jsx(_e,{className:"w-4 h-4 text-red-600"}),onClick:()=>handleDelete(e.id)}]})},K=()=>{S("add"),j(!0)},x=()=>{j(!1),S(""),g(),_(),k(!1)};return a.useEffect(()=>{if(d){x(),f.success(d,{description:"Operation successful!",duration:3e3,className:"bg-green-100 text-green-800"});const e=new URL(window.location.href);e.searchParams.delete("success"),window.history.replaceState({},"",e.pathname+e.search)}},[d]),a.useEffect(()=>{if(!i)return;x();const e=typeof i=="string"?i:i.message||"An error occurred.";f.error(e,{description:"Operation failed!",duration:3e3,className:"bg-red-100 text-red-800"}),typeof clearError=="function"&&clearError()},[i]),t.jsxs(se,{children:[t.jsx(Z,{title:"Certificate Issuance"}),t.jsxs("div",{children:[t.jsx(re,{breadcrumbs:A}),t.jsx(ce,{richColors:!0}),t.jsxs("div",{className:"p-2 md:p-4",children:[t.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:t.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[t.jsx("div",{className:"mb-6",children:t.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-xl shadow-sm",children:[t.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:t.jsx(ae,{className:"w-6 h-6 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:"My Certificates"}),t.jsxs("p",{className:"text-sm text-gray-500",children:["View and request"," ",t.jsx("span",{className:"font-medium",children:"official certificates"})," ","from your barangay. You can check your records, request new certificates, or download available documents below."]})]})]})}),t.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[t.jsx("div",{className:"flex items-start gap-2 flex-wrap",children:t.jsx(de,{allColumns:p,visibleColumns:c,setVisibleColumns:E,onPrint:P,showFilters:w,toggleShowFilters:()=>N(e=>!e)})}),t.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[t.jsxs("form",{onSubmit:V,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[t.jsx(ue,{type:"text",placeholder:"Search Name",value:v,onChange:e=>B(e.target.value),onKeyDown:e=>q("name",e),className:"w-full"}),t.jsxs("div",{className:"relative group z-50",children:[t.jsx(I,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:t.jsx(be,{})}),t.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]})]}),t.jsxs("div",{className:"relative group z-50",children:[t.jsx(I,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",onClick:K,children:t.jsx(ve,{className:"w-4 h-4"})}),t.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Request Certificate"})]})]})]}),w&&t.jsx(me,{queryParams:r,searchFieldName:u,visibleFilters:["certificate_type","request_status","issued_by","issued_at"],certificateTypes:y,showFilters:!0,months:D,clearRouteName:"certificate.index",clearRouteParams:{}}),t.jsx(pe,{passedData:T,allColumns:p,columnRenderers:H,queryParams:r,is_paginated:Q,toggleShowAll:()=>X(!C),showAll:C,visibleColumns:c,setVisibleColumns:E})]})}),t.jsx(fe,{isOpen:J,onClose:x,title:"Request a Certificate",children:z==="add"&&t.jsx(he,{data:o,setData:n,errors:M,documentsList:y,handleDocumentChange:L,handleRequest:U,reset:g,defaultPlacehodlers:F})})]})]})]})}export{pt as default};
