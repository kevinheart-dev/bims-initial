import{r,K as ue,m as pe,j as e,S as ge,a as L}from"./app-D2VBHUnE.js";import xe from"./DynamicTable-XHjF8o-O.js";import be from"./DynamicTableControls-I3Z4kOWV.js";import{B as y}from"./button-JXF2cuM-.js";import{I as he}from"./input-CsX4RkmY.js";import{u as ye}from"./useAppUrl-BohVm5NF.js";import{u as fe}from"./useQuery-Cm86VOUJ.js";import{S as P}from"./skeleton-CZuzpLfI.js";import je from"./ActionMenu-DEwdglpY.js";import{F as ve}from"./FillterToggle-C9gZhFi5.js";import{d as _e}from"./constants-B2gvBLga.js";import{D as U}from"./DropdownInputField-DZmkJTl1.js";import{I as m}from"./InputError-BL45JlCV.js";import{I as B}from"./InputField-CpgW95UT.js";import{S as Ne}from"./SelectField-COOdf5oK.js";import{I as Se,a as we,b as Ce}from"./index-DoJK41tF.js";import Re from"./SidebarModal-DNYbxHgQ.js";import{t as f,T as Ee}from"./index-CmbHX13U.js";import ke from"./DeleteConfirmationModal-mSKtI5Ku.js";import{I as Ae}from"./InputLabel-k09HPs3i.js";import{S as De}from"./search-D4RGGk5s.js";import{L as Te}from"./list-plus-DO7sqO6R.js";import{R as Fe}from"./rotate-ccw-B0YuVpYV.js";import{S as Oe}from"./square-pen-D6Zluk2r.js";import{T as $e}from"./trash-2-Ix8CbBXs.js";import"./createLucideIcon-qFzIO3KD.js";import"./dropdown-menu-DG5UGZdM.js";import"./index-6s3vvleY.js";import"./index-C2GEi9Oq.js";import"./floating-ui.react-dom-DwQNVWkT.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./check-C5u2RFjT.js";import"./chevron-right-BJZaoRcX.js";import"./tooltip-Cb0wL2_a.js";import"./ellipsis-DAg75UxB.js";import"./chevron-up-CnPsG_gG.js";import"./iconBase-CwqvEYsG.js";import"./x-DtldsTYz.js";const va=()=>{const E=ye(),[z,j]=r.useState(!1),[V,v]=r.useState(""),[n,k]=r.useState(null),g=ue().props,_=(g==null?void 0:g.error)??null,[c,A]=r.useState({}),[D,T]=r.useState(c.name??""),[q,N]=r.useState(!1),[F,K]=r.useState(null),{data:l,isLoading:G,isError:Q,error:H,refetch:S}=fe({queryKey:["roads",c],queryFn:async()=>{const{data:a}=await L.get(`${E}/barangay_road`,{params:c});return a},keepPreviousData:!0,staleTime:1e3*60*5}),J=l==null?void 0:l.roads,X=l==null?void 0:l.types,Y=l==null?void 0:l.maintains,w=[{key:"id",label:"ID"},{key:"image",label:"Road Image"},{key:"road_type",label:"Road Type"},{key:"maintained_by",label:"Maintained By"},{key:"length",label:"Length"},{key:"status",label:"Status"},{key:"condition",label:"Condition"},{key:"created_at",label:"Created At"},{key:"updated_at",label:"Updated At"},{key:"actions",label:"Actions"}],W=w.map(a=>a.key),[x,Z]=r.useState(()=>{const a=localStorage.getItem("roads_visible_columns");return a?JSON.parse(a):W}),C=Object.entries(c).some(([a,t])=>["road_type","maintained_by","road_status","road_condition"].includes(a)&&t&&t!==""),[O,$]=r.useState(C);r.useEffect(()=>{C&&$(!0)},[C]),r.useEffect(()=>{localStorage.setItem("roads_visible_columns",JSON.stringify(x))},[x]);const ee=a=>{a.preventDefault(),R("name",D)},R=(a,t)=>{A(s=>{const o={...s};return t&&t.trim()!==""&&t!=="All"?o[a]=t:delete o[a],delete o.page,o})},ae=(a,t)=>{t.key==="Enter"&&R(a,t.target.value)},te={id:a=>a.id,image:a=>e.jsx("img",{src:a.road_image?`/storage/${a.road_image}`:"/images/default-avatar.jpg",onError:t=>{t.target.onerror=null,t.target.src="/images/default-avatar.jpg"},alt:"Resident",className:"w-16 h-16 min-w-16 min-h-16 object-cover rounded-sm border"}),road_type:a=>e.jsx("span",{className:"font-medium text-gray-900",children:_e[a.road_type]||"—"}),maintained_by:a=>e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-0.5 rounded-md text-xs font-medium capitalize",children:a.maintained_by||"—"}),length:a=>e.jsx("span",{className:"text-sm text-gray-700",children:a.length!=null?`${a.length} Km`:"—"}),condition:a=>{const t={good:"bg-green-100 text-green-800",fair:"bg-yellow-100 text-yellow-800",poor:"bg-red-100 text-red-800"};return e.jsx("span",{className:`px-2 py-0.5 rounded-md text-xs font-medium capitalize ${t[a.condition]||"bg-gray-100 text-gray-600"}`,children:a.condition||"—"})},status:a=>{const t={active:"bg-blue-100 text-blue-800",under_maintenance:"bg-orange-100 text-orange-800",closed:"bg-gray-200 text-gray-700"};return e.jsx("span",{className:`px-2 py-0.5 rounded-md text-xs font-medium capitalize ${t[a.status]||"bg-gray-100 text-gray-600"}`,children:a.status||"—"})},created_at:a=>e.jsx("span",{className:"text-sm text-gray-500",children:a.created_at?new Date(a.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}),updated_at:a=>e.jsx("span",{className:"text-sm text-gray-500",children:a.updated_at?new Date(a.updated_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}),actions:a=>e.jsx(je,{actions:[{label:"Edit",icon:e.jsx(Oe,{className:"w-4 h-4 text-green-500"}),onClick:()=>ie(a.id)},{label:"Delete",icon:e.jsx($e,{className:"w-4 h-4 text-red-600"}),onClick:()=>me(a.id)}]})},se=()=>{v("add"),j(!0)},{data:u,setData:b,post:M,errors:i,reset:I,clearErrors:re}=pe({roads:[[]],_method:void 0,road_id:null}),oe=()=>{b("roads",[...u.roads||[],{}])},le=a=>{const t=[...u.roads||[]];t.splice(a,1),b("roads",t),f.warning("Road removed.",{duration:2e3})},h=()=>{j(!1),v(""),k(null),I(),re()},d=(a,t,s)=>{b(o=>{const p=[...o.roads];return s==="road_image"&&a instanceof File?p[t]={...p[t],road_image:a,previewImage:URL.createObjectURL(a)}:p[t]={...p[t],[s]:a},{...o,roads:p}})},ne=a=>{a.preventDefault(),M(route("barangay_road.store"),{onError:t=>{const s=Object.values(t).join("<br />");f.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:s}}),duration:3e3,closeButton:!0})},onSuccess:()=>{S(),h()}})},ie=async a=>{v("edit");try{const s=(await L.get(`${E}/barangay_road/details/${a}`)).data.road;console.log(s),k(s),b({roads:[{road_image:null,previewImage:s.road_image?`/storage/${s.road_image}`:null,road_type:s.road_type||"",length:s.length||"",condition:s.condition||"",status:s.status||"",maintained_by:s.maintained_by||""}],_method:"PUT",road_id:s.id}),j(!0)}catch(t){console.error("Error fetching road details:",t)}},de=a=>{a.preventDefault(),M(route("barangay_road.update",n.id),{_method:"PUT",roads:u.roads,onError:t=>{console.error("Validation Errors:",t)},onSuccess:()=>{S(),h()}})},me=a=>{K(a),N(!0)},ce=()=>{ge.delete(route("barangay_road.destroy",F),{onError:a=>{console.error("Validation Errors:",a);const t=Object.values(a).join("<br />");f.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:t}}),duration:3e3,closeButton:!0})},onSuccess:()=>{S(),h()}}),N(!1)};return r.useEffect(()=>{_&&f.error(_,{description:"Operation failed!",duration:3e3,closeButton:!0}),g.error=null},[_]),G?e.jsxs("div",{className:"gap-2 space-y-4",children:[e.jsx(P,{className:"h-[20px] w-[100px] rounded-full"}),e.jsx(P,{className:"h-[10px] w-[100px] rounded-full"})]}):Q?e.jsxs("div",{className:"text-red-500",children:["Error: ",H.message]}):e.jsxs("div",{className:"p-2 md:px-2 md:py-2",children:[e.jsx(Ee,{richColors:!0}),e.jsxs("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx(be,{allColumns:w,visibleColumns:x,setVisibleColumns:Z,showFilters:O,toggleShowFilters:()=>$(a=>!a)})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[e.jsxs("form",{onSubmit:ee,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[e.jsx(he,{type:"text",placeholder:"Search road lengths",value:D,onChange:a=>T(a.target.value),onKeyDown:a=>ae("name",a.target.value),className:"ml-4"}),e.jsx(y,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(De,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(y,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",onClick:se,children:e.jsx(Te,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add a Road"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[O&&e.jsx(ve,{queryParams:c,searchFieldName:R,visibleFilters:["road_type","maintained_by","road_status","road_condition"],showFilters:!0,types:X,names:Y,setQueryParams:A,setQuery:T,clearRouteAxios:!0}),e.jsx(xe,{passedData:J,allColumns:w,columnRenderers:te,visibleColumns:x,showTotal:!0})]}),e.jsx(Re,{isOpen:z,onClose:()=>{h()},title:V=="add"?"Add Road":"Edit Road",children:e.jsxs("form",{className:"bg-gray-50 p-4 rounded-lg",onSubmit:n?de:ne,children:[e.jsx("h3",{className:"text-2xl font-medium text-gray-700",children:"Barangay Roads"}),e.jsx("p",{className:"text-sm text-gray-500 mb-8",children:"Please provide details about roads within the barangay."}),Array.isArray(u.roads)&&u.roads.map((a,t)=>e.jsxs("div",{className:"border p-4 mb-4 rounded-md relative bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 mb-6 gap-4",children:[e.jsxs("div",{className:"md:col-span-2 flex flex-col items-center space-y-2",children:[e.jsx(Ae,{htmlFor:`facility_image_${t}`,value:"Road Image"}),e.jsx("img",{src:a.previewImage||"/images/default-avatar.jpg",alt:"Road Image",className:"w-32 h-32 object-cover rounded-sm border border-gray-200"}),e.jsx("input",{id:`facility_image_${t}`,type:"file",accept:"image/*",onChange:s=>{const o=s.target.files[0];o&&d(o,t,"road_image")},className:`block w-full text-sm text-gray-500
                                                                                                                                    file:mr-2 file:py-1 file:px-3
                                                                                                                                    file:rounded file:border-0
                                                                                                                                    file:text-xs file:font-semibold
                                                                                                                                    file:bg-blue-50 file:text-blue-700
                                                                                                                                    hover:file:bg-blue-100`}),e.jsx(m,{message:i[`roads.${t}.road_image`],className:"mt-2"})]}),e.jsxs("div",{className:"md:col-span-4 space-y-4",children:[e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(U,{label:"Road Type",name:"road_type",value:a.road_type||"",onChange:s=>d(s.target.value,t,"road_type"),placeholder:"Select road type",items:[{label:"Asphalt",value:"asphalt"},{label:"Concrete",value:"concrete"},{label:"Gravel",value:"gravel"},{label:"Natural Earth Surface",value:"natural_earth_surface"}]}),e.jsx(m,{message:i[`roads.${t}.road_type`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(B,{label:"Length (km)",name:"length",type:"number",step:"0.01",value:a.length||"",onChange:s=>d(s.target.value,t,"length"),placeholder:"e.g. 2.50"}),e.jsx(m,{message:i[`roads.${t}.length`],className:"mt-1"})]})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(U,{label:"Condition",name:"condition",value:a.condition||"",onChange:s=>d(s.target.value,t,"condition"),placeholder:"Select condition",items:[{label:"Good",value:"good"},{label:"Fair",value:"fair"},{label:"Poor",value:"poor"},{label:"Under Construction",value:"under_construction"},{label:"Impassable",value:"impassable"}]}),e.jsx(m,{message:i[`roads.${t}.condition`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(Ne,{label:"Status",name:"status",value:a.status||"",onChange:s=>d(s.target.value,t,"status"),items:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"}]}),e.jsx(m,{message:i[`roads.${t}.status`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-6",children:[e.jsx(B,{label:"Maintained By",name:"maintained_by",value:a.maintained_by||"",onChange:s=>d(s.target.value,t,"maintained_by"),placeholder:"e.g. Barangay Government"}),e.jsx(m,{message:i[`roads.${t}.maintained_by`],className:"mt-1"})]})]}),n===null&&e.jsx("button",{type:"button",onClick:()=>le(t),className:"absolute top-1 right-2 flex items-center gap-1 text-sm text-red-400 hover:text-red-800 font-medium mt-1 mb-5 transition-colors duration-200",children:e.jsx(Se,{className:"text-2xl"})})]},t)),e.jsxs("div",{className:"flex justify-between items-center p-3",children:[n===null?e.jsxs("button",{type:"button",onClick:oe,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800 font-medium mt-4 transition-colors duration-200",children:[e.jsx(we,{className:"text-2xl"}),e.jsx("span",{children:"Add Road"})]}):e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end items-center text-end mt-5 gap-4",children:[n==null&&e.jsxs(y,{type:"button",onClick:()=>I(),children:[e.jsx(Fe,{})," Reset"]}),e.jsxs(y,{className:"bg-blue-700 hover:bg-blue-400",type:"submit",children:[n?"Update":"Add"," ",e.jsx(Ce,{})]})]})]})]})})," ",e.jsx(ke,{isOpen:q,onClose:()=>{N(!1)},onConfirm:ce,residentId:F})]})]})};export{va as default};
