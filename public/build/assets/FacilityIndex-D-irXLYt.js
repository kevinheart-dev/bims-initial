import{r as s,K as de,m as ue,j as e,S as pe,a as P}from"./app-CSbLTV9t.js";import ye from"./DynamicTable-CYX8Y7lr.js";import{u as xe}from"./useAppUrl-CCPDQKWJ.js";import{S as $}from"./skeleton-C3jJoeQy.js";import{u as fe}from"./useQuery-CDQnuoFr.js";import ge from"./ActionMenu-BTyRiOW7.js";import be from"./DynamicTableControls-nJkmjrjE.js";import{I as he}from"./input-HZV2GfRj.js";import{B as b}from"./button-Baqcf9KW.js";import{F as je}from"./FillterToggle-p8HB-wA3.js";import ve from"./SidebarModal-Ca0ENWih.js";import{I as R}from"./InputField-B1L9QxNV.js";import{I as h}from"./InputError-BCqWxJV0.js";import{D as Ne}from"./DropdownInputField-D-lPqSgr.js";import{I as _e,a as Se,b as we}from"./index-k6Ra7WmB.js";import Fe from"./DeleteConfirmationModal-C2yWkaRr.js";import{t as d,T as Ce}from"./index-BKWT8n_e.js";import{I as Ee}from"./InputLabel-D9dJg9rZ.js";import{S as ke}from"./search-w3rx2qu6.js";import{L as De}from"./list-plus-D4Korl0C.js";import{R as Te}from"./rotate-ccw-CP5E-4aB.js";import{S as Ae}from"./square-pen-BBjInpuo.js";import{T as Ie}from"./trash-2-D7SnOmvm.js";import"./createLucideIcon-K65SoRPX.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./dropdown-menu-DsAxoPEU.js";import"./index-BWMtPXXG.js";import"./index-CLKsPuj0.js";import"./floating-ui.react-dom-DHVDvaGl.js";import"./check-xGOvrYiq.js";import"./chevron-right-ZDo9j4tz.js";import"./tooltip-b0GAWXCC.js";import"./ellipsis-Ci4G0pTK.js";import"./chevron-up-BdT9BwPw.js";import"./constants-CQOY_faM.js";import"./x-DSSMIW7T.js";import"./iconBase-DIY0yPu9.js";const bt=()=>{const E=xe(),[U,j]=s.useState(!1),[V,v]=s.useState(""),[o,k]=s.useState(null),u=de().props,N=(u==null?void 0:u.error)??null,[n,D]=s.useState({}),[T,A]=s.useState(n.name??""),[B,_]=s.useState(!1),[I,Q]=s.useState(null),{data:l,isLoading:z,isError:K,error:H,refetch:S}=fe({queryKey:["facilities",n],queryFn:async()=>{const{data:t}=await P.get(`${E}/barangay_facility`,{params:n});return t},keepPreviousData:!0,staleTime:1e3*60*5}),J=l==null?void 0:l.facilities,G=l==null?void 0:l.types,W=l==null?void 0:l.names,w=[{key:"id",label:"ID"},{key:"image",label:"Image"},{key:"name",label:"Name"},{key:"facility_type",label:"Facilitiy Type"},{key:"quantity",label:"Quantity"},{key:"created_at",label:"Created At"},{key:"updated_at",label:"Updated At"},{key:"actions",label:"Actions"}],X=w.map(t=>t.key),[p,Y]=s.useState(()=>{const t=localStorage.getItem("facilities_visible_columns");return t?JSON.parse(t):X}),F=Object.entries(n||{}).some(([t,a])=>["faci_name","faci_type"].includes(t)&&a&&a!==""),[O,q]=s.useState(F);s.useEffect(()=>{F&&q(!0)},[F]),s.useEffect(()=>{localStorage.setItem("facilities_visible_columns",JSON.stringify(p))},[p]);const Z=t=>{t.preventDefault(),C("name",T)},C=(t,a)=>{D(i=>{const r={...i};return a&&a.trim()!==""&&a!=="All"?r[t]=a:delete r[t],delete r.page,r})},ee=(t,a)=>{a.key==="Enter"&&C(t,a.target.value)},te={id:t=>t.id,image:t=>e.jsx("img",{src:t.facility_image?`/storage/${t.facility_image}`:"/images/default-avatar.jpg",onError:a=>{a.target.onerror=null,a.target.src="/images/default-avatar.jpg"},alt:"Resident",className:"w-16 h-16 min-w-16 min-h-16 object-cover rounded-sm border"}),name:t=>e.jsx("span",{className:"font-medium text-gray-900",children:t.name||"—"}),facility_type:t=>e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-0.5 rounded-md text-xs font-medium capitalize",children:t.facility_type||"—"}),quantity:t=>e.jsx("span",{className:"text-sm text-gray-700",children:t.quantity??"—"}),created_at:t=>e.jsx("span",{className:"text-sm text-gray-500",children:t.created_at?new Date(t.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}),updated_at:t=>e.jsx("span",{className:"text-sm text-gray-500",children:t.updated_at?new Date(t.updated_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}),actions:t=>e.jsx(ge,{actions:[{label:"Edit",icon:e.jsx(Ae,{className:"w-4 h-4 text-green-500"}),onClick:()=>oe(t.id)},{label:"Delete",icon:e.jsx(Ie,{className:"w-4 h-4 text-red-600"}),onClick:()=>ce(t.id)}]})},ae=()=>{v("add"),j(!0)},{data:c,setData:y,post:L,errors:x,reset:M,clearErrors:ie}=ue({facilities:[[]],_method:void 0,facility_id:null}),se=()=>{y("facilities",[...c.facilities||[],{}])},re=t=>{const a=[...c.facilities||[]];a.splice(t,1),y("facilities",a),d.warning("Facility removed.",{duration:2e3})},f=()=>{j(!1),v(""),k(null),M(),ie()},g=(t,a,i)=>{y(r=>{const m=[...r.facilities];return i==="facility_image"&&t instanceof File?m[a]={...m[a],facility_image:t,previewImage:URL.createObjectURL(t)}:m[a]={...m[a],[i]:t},{...r,facilities:m}})},le=t=>{t.preventDefault(),L(route("barangay_facility.store"),{onError:a=>{console.error("Validation Errors:",a);const i=Object.values(a).join("<br />");d.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:i}}),duration:3e3,closeButton:!0})},onSuccess:()=>{S(),f()}})},oe=async t=>{v("edit");try{const i=(await P.get(`${E}/barangay_facility/details/${t}`)).data.facility;y({facilities:[{facility_image:null,previewImage:i.facility_image?`/storage/${i.facility_image}`:null,name:i.name||"",facility_type:i.facility_type||"",quantity:i.quantity||1}],_method:"PUT",facility_id:i.id}),k(i),j(!0)}catch(a){console.error("Error fetching facility details:",a)}},ne=t=>{t.preventDefault(),L(route("barangay_facility.update",c.facility_id),{onError:a=>{console.error("Validation Errors:",a);const i=Object.values(a).join("<br />");d.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:i}}),duration:3e3,closeButton:!0})},onSuccess:()=>{S(),f()}})},ce=t=>{Q(t),_(!0)},me=()=>{pe.delete(route("barangay_facility.destroy",I),{onError:t=>{console.error("Validation Errors:",t);const a=Object.values(t).join("<br />");d.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:a}}),duration:3e3,closeButton:!0})},onSuccess:()=>{S(),f()}}),_(!1)};return s.useEffect(()=>{N&&d.error(N,{description:"Operation failed!",duration:3e3,closeButton:!0}),u.error=null},[N]),z?e.jsxs("div",{className:"gap-2 space-y-4",children:[e.jsx($,{className:"h-[20px] w-[100px] rounded-full"}),e.jsx($,{className:"h-[10px] w-[100px] rounded-full"})]}):K?e.jsxs("div",{className:"text-red-500",children:["Error: ",H.message]}):e.jsxs("div",{className:"p-2 md:px-2 md:py-2",children:[e.jsx(Ce,{richColors:!0}),e.jsxs("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx(be,{allColumns:w,visibleColumns:p,setVisibleColumns:Y,showFilters:O,toggleShowFilters:()=>q(t=>!t)})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[e.jsxs("form",{onSubmit:Z,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[e.jsx(he,{type:"text",placeholder:"Search facility name",value:T,onChange:t=>A(t.target.value),onKeyDown:t=>ee("name",t.target.value),className:"ml-4"}),e.jsx(b,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(ke,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(b,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",onClick:ae,children:e.jsx(De,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add a Facility"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[O&&e.jsx(je,{queryParams:n,searchFieldName:C,visibleFilters:["faci_name","faci_type"],showFilters:!0,types:G,names:W,setQueryParams:D,setQuery:A,clearRouteAxios:!0}),e.jsx(ye,{passedData:J,allColumns:w,columnRenderers:te,visibleColumns:p,showTotal:!0})]})]}),e.jsx(ve,{isOpen:U,onClose:()=>{f()},title:V=="add"?"Add Facility":"Edit Facility",children:e.jsxs("form",{className:"bg-gray-50 p-4 rounded-lg",onSubmit:o?ne:le,children:[e.jsx("h3",{className:"text-2xl font-medium text-gray-700",children:"Barangay Facility Information"}),e.jsx("p",{className:"text-sm text-gray-500 mb-8",children:"Please provide details about the existing facilities in the barangay."}),Array.isArray(c.facilities)&&c.facilities.map((t,a)=>e.jsxs("div",{className:"border p-4 mb-4 rounded-md relative bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 mb-6",children:[e.jsxs("div",{className:"md:col-span-2 flex flex-col items-center space-y-2",children:[e.jsx(Ee,{htmlFor:`facility_image_${a}`,value:"Facility Photo"}),e.jsx("img",{src:t.previewImage||"/images/default-avatar.jpg",alt:"Facility Image",className:"w-32 h-32 object-cover rounded-sm border border-gray-200"}),e.jsx("input",{id:`facility_image_${a}`,type:"file",accept:"image/*",onChange:i=>{const r=i.target.files[0];r&&g(r,a,"facility_image")},className:`block w-full text-sm text-gray-500
                                                                                            file:mr-2 file:py-1 file:px-3
                                                                                            file:rounded file:border-0
                                                                                            file:text-xs file:font-semibold
                                                                                            file:bg-blue-50 file:text-blue-700
                                                                                            hover:file:bg-blue-100`}),e.jsx(h,{message:x[`facilities.${a}.facility_image`],className:"mt-2"})]}),e.jsxs("div",{className:"md:col-span-4 space-y-4",children:[e.jsx(R,{label:"Facility Name",type:"text",name:"name",value:t.name||"",onChange:i=>g(i.target.value,a,"name"),placeholder:"Enter Facility Name"}),e.jsx(h,{message:x[`facilities.${a}.name`],className:"mt-1"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(Ne,{label:"Facility Type",name:"facility_type",value:t.facility_type||"",onChange:i=>g(i.target.value,a,"facility_type"),items:[{label:"Government",value:"government"},{label:"Protection",value:"protection"},{label:"Security",value:"security"},{label:"Finance",value:"finance"},{label:"Service",value:"service"},{label:"Commerce",value:"commerce"}],placeholder:"Select Facility Type"}),e.jsx(h,{message:x[`facilities.${a}.facility_type`],className:"mt-1"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(R,{type:"number",label:"Quantity",name:"quantity",value:t.quantity||"",onChange:i=>g(i.target.value,a,"quantity"),placeholder:"Enter Quantity"}),e.jsx(h,{message:x[`facilities.${a}.quantity`],className:"mt-1"})]})]})]})]}),o===null&&e.jsx("button",{type:"button",onClick:()=>re(a),className:"absolute top-1 right-2 flex items-center gap-1 text-sm text-red-400 hover:text-red-800 font-medium mt-1 mb-5 transition-colors duration-200",children:e.jsx(_e,{className:"text-2xl"})})]},a)),e.jsxs("div",{className:"flex justify-between items-center p-3",children:[o===null?e.jsxs("button",{type:"button",onClick:se,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800 font-medium mt-4 transition-colors duration-200",children:[e.jsx(Se,{className:"text-2xl"}),e.jsx("span",{children:"Add Facility"})]}):e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end items-center text-end mt-5 gap-4",children:[o==null&&e.jsxs(b,{type:"button",onClick:()=>M(),children:[e.jsx(Te,{})," Reset"]}),e.jsxs(b,{className:"bg-blue-700 hover:bg-blue-400 ",type:"submit",children:[o?"Update":"Add"," ",e.jsx(we,{})]})]})]})]})}),e.jsx(Fe,{isOpen:B,onClose:()=>{_(!1)},onConfirm:me,residentId:I})]})};export{bt as default};
