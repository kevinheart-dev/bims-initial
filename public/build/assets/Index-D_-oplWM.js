import{K as ve,r as l,m as be,j as e,L as ge,S as B,a as z}from"./app-NONmr2q7.js";import fe from"./ActionMenu-D3kPT4Zy.js";import je from"./BreadcrumbsHeader-D8tiVWTI.js";import ye from"./DynamicTable-ujRScrKI.js";import{B as f}from"./button-B60YSiq3.js";import{I as _e}from"./input-BFFeM9xD.js";import{S as Ne}from"./AdminLayout-CAq8111M.js";import{I as we,a as Se,b as ke}from"./index-D52x4y4z.js";import{F as Ce}from"./FillterToggle-JLvHC3EY.js";import Le from"./DynamicTableControls-BOelTzLL.js";import $e from"./PersonDetailContent-Dmp-bGJK.js";import De from"./SidebarModal-DNyQltY0.js";import{u as Ee}from"./useAppUrl-C81wl3Q_.js";import{I as Re}from"./InputLabel-BLUQeTh-.js";import{I as p}from"./InputField-DYlBd11g.js";import{I as n}from"./InputError-BaM3HfGO.js";import{R as Fe}from"./RadioGroup-BiK_18OU.js";import{D as U}from"./DropdownInputField-dSSBcj-O.js";import{t as k,T as Oe}from"./index-WVyhkiLH.js";import{u as Ae}from"./handleResidentChange-zVcsoc40.js";import{S as Y}from"./SelectField-CNsQEAgs.js";import Ie from"./DeleteConfirmationModal-CuJjCqMn.js";import{S as Me}from"./search-Cesp6vtA.js";import{S as Te}from"./square-plus-BOQVYyby.js";import{R as Ve}from"./rotate-ccw-qZj_W-eF.js";import{E as Be}from"./eye-DQ7bscOP.js";import{S as ze}from"./square-pen-CFWvPkQK.js";import{T as Ue}from"./trash-2-DmQV4y5G.js";import"./dropdown-menu-4X7q6_gv.js";import"./index-RBJTYTCy.js";import"./index-CvNDV1A-.js";import"./floating-ui.react-dom-jFzDCjY_.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./check-DPirRqHD.js";import"./createLucideIcon-BjswQhwn.js";import"./chevron-right-DBIVXYWk.js";import"./tooltip-Cn5LYVv3.js";import"./ellipsis-Dvsd1NpA.js";import"./breadcrumb-CDexVwyR.js";import"./sidebar-CwuwXzjO.js";import"./x-sF-KpabD.js";import"./skeleton-uAG2kVnC.js";import"./nav-user-D01iDzqt.js";import"./avatar-CuINGoVe.js";import"./users-round-BQO22qvz.js";import"./heart-pulse-t-V8Bniw.js";import"./chevron-up-K4GnFQxP.js";import"./iconBase-DbCAZpIL.js";import"./constants-CCklgWBc.js";import"./index-HxxjH0K9.js";import"./index-QFjp5_DJ.js";function Ut({livelihoods:K,puroks:P,queryParams:a=null,residents:C=[],livelihood_types:L}){const H=[{label:"Residents Information",showOnMobile:!1},{label:"Residents Livelihoods",showOnMobile:!0}];a=a||{};const $=Ee(),d=ve().props,j=(d==null?void 0:d.success)??null,y=(d==null?void 0:d.error)??null,[D,J]=l.useState(a.name??""),G=t=>{t.preventDefault(),_("name",D)},_=(t,s)=>{s&&s.trim()!==""?a[t]=s:delete a[t],a.page&&delete a.page,B.get(route("livelihood.index",a))},Q=(t,s)=>{if(s.key==="Enter")_(t,s.target.value);else return},[W,x]=l.useState(!1),[v,b]=l.useState(""),[u,E]=l.useState(null),[X,N]=l.useState(!1),[R,Z]=l.useState(null),w=Object.entries(a||{}).some(([t,s])=>["purok","livelihood_type","livelihood_status","is_main"].includes(t)&&s&&s!=="");l.useEffect(()=>{w&&O(!0)},[w]);const S=[{key:"id",label:"Livelihood ID"},{key:"name",label:"Resident Name"},{key:"livelihood_type",label:"Livelihood"},{key:"description",label:"Description"},{key:"status",label:"Livelihood Status"},{key:"started_at",label:"Year Started"},{key:"ended_at",label:"Year Ended"},{key:"is_main_livelihood",label:"Is Main Livelihood"},{key:"purok_number",label:"Purok"},{key:"actions",label:"Actions"}],[F,O]=l.useState(w),[A,I]=l.useState(null),q=S.map(t=>t.key),[g,ee]=l.useState(()=>{const t=localStorage.getItem("livelihood_visible_columns");return t?JSON.parse(t):q});l.useEffect(()=>{localStorage.setItem("livelihood_visible_columns",JSON.stringify(g))},[g]);const te={id:t=>t.id,name:t=>{const{firstname:s,middlename:i,lastname:c,suffix:xe}=t.resident??{};return`${s??""} ${i??""} ${c??""} ${xe??""}`.trim()||"—"},livelihood_type:t=>e.jsx("span",{className:"text-xs font-medium",children:t.livelihood_type||"—"}),description:t=>e.jsx("span",{className:"text-xs text-gray-600",children:t.description||"—"}),status:t=>{const s=t.status??"—",i=s==="active"?"bg-green-100 text-green-800":s==="inactive"?"bg-red-100 text-red-800":s==="seasonal"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-700";return e.jsx("span",{className:`${i} px-2 py-0.5 rounded-md text-xs font-medium capitalize`,children:s.replaceAll("_"," ")})},started_at:t=>e.jsx("span",{className:"text-xs text-gray-700",children:t.started_at??"—"}),ended_at:t=>e.jsx("span",{className:"text-xs text-gray-700",children:t.ended_at??"—"}),average_monthly_income:t=>e.jsx("span",{className:"text-xs text-gray-800",children:t.monthly_income?`₱${parseFloat(t.monthly_income).toLocaleString()}`:"—"}),is_main_livelihood:t=>e.jsx("span",{className:`px-2 py-0.5 rounded-md text-xs font-medium ${t.is_main_livelihood?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-700"}`,children:t.is_main_livelihood?"Yes":"No"}),purok_number:t=>{var s,i,c;return e.jsx("span",{className:"text-xs text-gray-800",children:((c=(i=(s=t.resident)==null?void 0:s.street)==null?void 0:i.purok)==null?void 0:c.purok_number)??"—"})},actions:t=>e.jsx(fe,{actions:[{label:"View",icon:e.jsx(Be,{className:"w-4 h-4 text-indigo-600"}),onClick:()=>se(t.resident.id)},{label:"Edit",icon:e.jsx(ze,{className:"w-4 h-4 text-green-500"}),onClick:()=>me(t.id)},{label:"Delete",icon:e.jsx(Ue,{className:"w-4 h-4 text-red-600"}),onClick:()=>pe(t.id)}]})},se=async t=>{b("view"),I(null);try{const s=await z.get(`${$}/resident/showresident/${t}`);I(s.data.resident)}catch(s){console.error("Error fetching placeholders:",s)}x(!0)},ie=C.map(t=>({label:`${t.firstname} ${t.middlename} ${t.lastname} ${t.suffix??""}`,value:t.id.toString()})),{data:o,setData:h,post:M,errors:r,reset:T,clearErrors:le}=be({resident_id:null,resident_name:"",resident_image:null,birthdate:null,purok_number:null,livelihoods:[[]],_method:void 0,livelihood_id:null}),ae=Ae(C,h),oe=()=>{h("livelihoods",[...o.livelihoods||[],{}])},re=t=>{const s=[...o.livelihoods||[]];s.splice(t,1),h("livelihoods",s),k.warning("Livelihood removed.",{duration:2e3})},m=(t,s,i)=>{const c=[...o.livelihoods||[]];c[s]={...c[s],[i]:t.target.value},h("livelihoods",c)},ne=L.map(t=>({label:t,value:t})),de=()=>{b("add"),x(!0)},me=async t=>{b("add");try{const i=(await z.get(`${$}/livelihood/details/${t}`)).data.livelihood;console.log(i),E(i),h({resident_id:i.resident.id,resident_name:`${i.resident.firstname} ${i.resident.middlename??""} ${i.resident.lastname}`,resident_image:i.resident.image??null,birthdate:i.resident.birthdate??null,purok_number:i.resident.purok_number??null,employment_status:i.resident.employment_status,livelihoods:[{livelihood_type:i.livelihood_type||"",description:i.description||"",status:i.status||"",employer:i.employer||"",is_main_livelihood:i.is_main_livelihood?i.is_main_livelihood.toString():"0",income:i.monthly_income||0,income_frequency:"monthly",started_at:i.started_at||"",ended_at:i.ended_at||""}],_method:"PUT",livelihood_id:i.id}),x(!0)}catch(s){console.error("Error fetching livelihood details:",s)}},V=()=>{x(!1),b(""),E(null),T(),le()},ce=t=>{t.preventDefault(),M(route("livelihood.store"),{onError:()=>{console.error("Validation Errors:",r)}})},ue=t=>{t.preventDefault(),M(route("livelihood.update",o.livelihood_id),{onError:()=>{console.error("Validation Errors:",r)}})},pe=t=>{Z(t),N(!0)},he=()=>{B.delete(route("livelihood.destroy",R)),N(!1)};return l.useEffect(()=>{j&&(V(),k.success(j,{description:"Operation successful!",duration:3e3})),d.success=null},[j]),l.useEffect(()=>{y&&k.error(y,{description:"Operation failed!",duration:3e3,closeButton:!0}),d.error=null},[y]),e.jsxs(Ne,{children:[e.jsx(ge,{title:"Residents Livelihood"}),e.jsx(je,{breadcrumbs:H}),e.jsx(Oe,{richColors:!0}),e.jsx("div",{className:"p-2 md:p-4",children:e.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx(Le,{allColumns:S,visibleColumns:g,setVisibleColumns:ee,showFilters:F,toggleShowFilters:()=>O(t=>!t)})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[e.jsxs("form",{onSubmit:G,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[e.jsx(_e,{type:"text",placeholder:"Search Name",value:D,onChange:t=>J(t.target.value),onKeyDown:t=>Q("name",t),className:"w-full"}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(f,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(Me,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(f,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",onClick:de,children:e.jsx(Te,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add a Livelihood"})]})]})]}),F&&e.jsx(Ce,{queryParams:a,searchFieldName:_,visibleFilters:["purok","livelihood_type","livelihood_status","is_main"],puroks:P,showFilters:!0,clearRouteName:"livelihood.index",clearRouteParams:{},livelihood_types:L}),e.jsx(ye,{passedData:K,allColumns:S,columnRenderers:te,queryParams:a,visibleColumns:g,showTotal:!0})]})})}),e.jsxs(De,{isOpen:W,onClose:()=>{V()},title:v==="add"&&u?"Edit Livelihood":v==="add"?"Add Livelihood":"View Resident",children:[v==="add"&&e.jsx("div",{className:"w-full rounded-xl border border-white/20 bg-white/10 backdrop-blur-md shadow-lg text-sm text-black p-4 space-y-4",children:e.jsxs("form",{onSubmit:u?ue:ce,children:[e.jsx("h3",{className:"text-xl font-medium text-gray-700 mb-8",children:"Resident's Info"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-y-2 md:gap-x-4 mb-5 w-full",children:[e.jsxs("div",{className:"md:row-span-2 md:col-span-2 flex flex-col items-center space-y-2",children:[e.jsx(Re,{htmlFor:"resident_image",value:"Profile Photo"}),e.jsx("img",{src:o.resident_image?`/storage/${o.resident_image}`:"/images/default-avatar.jpg",alt:"Resident Image",className:"w-32 h-32 object-cover rounded-full border border-gray-200"})]}),e.jsxs("div",{className:"md:col-span-4 space-y-2",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(U,{label:"Full Name",name:"resident_name",value:o.resident_name||"",placeholder:"Select a resident",onChange:t=>ae(t),items:ie,readOnly:u}),e.jsx(n,{message:r.resident_id,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx(p,{label:"Birthdate",name:"birthdate",value:o.birthdate||"",readOnly:!0})}),e.jsx("div",{children:e.jsx(p,{label:"Purok Number",name:"purok_number",value:o.purok_number,readOnly:!0})})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col mt-12",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-1 mt-1",children:"Livelihood Information"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Please provide the resident's livelihood background."})]}),Array.isArray(o.livelihoods)&&o.livelihoods.map((t,s)=>e.jsxs("div",{className:"border p-4 mb-4 rounded-md relative bg-gray-50",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(U,{label:"Livelihood",name:"livelihood_type",value:t.livelihood_type||"",onChange:i=>m(i,s,"livelihood_type"),placeholder:"Select or Enter Livelihood",items:ne}),e.jsx(n,{message:r[`livelihoods.${s}.livelihood_type`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(Y,{label:"Livelihood Status",name:"status",value:t.status||"",onChange:i=>m(i,s,"status"),items:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"},{label:"Seasonal",value:"seasonal"},{label:"Ended",value:"ended"}]}),e.jsx(n,{message:r[`livelihoods.${s}.status`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(Fe,{label:"Is Main Livelihood",name:"is_main_livelihood",selectedValue:t.is_main_livelihood||"",options:[{label:"Yes",value:1},{label:"No",value:0}],onChange:i=>m(i,s,"is_main_livelihood")}),e.jsx(n,{message:r[`livelihoods.${s}.is_main_livelihood`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(p,{label:"Description",name:"description",type:"text",value:t.description||"",onChange:i=>m(i,s,"description"),placeholder:"Enter livelihood description"}),e.jsx(n,{message:r[`livelihoods.${s}.description`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(p,{label:"Date Started",name:"started_at",type:"date",value:t.started_at||"",onChange:i=>m(i,s,"started_at")}),e.jsx(n,{message:r[`livelihoods.${s}.started_at`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(p,{label:"Date Ended",name:"ended_at",type:"date",value:t.ended_at||"",onChange:i=>m(i,s,"ended_at"),disabled:t.occupation_status==="active"}),e.jsx(n,{message:r[`livelihoods.${s}.ended_at`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(p,{type:"number",label:"Income",name:"income",value:t.income?t.income||"":t.monthly_income||"",onChange:i=>m(i,s,"income"),placeholder:"Enter Income"}),e.jsx(n,{message:r[`livelihoods.${s}.income`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(Y,{label:"Income Frequency",name:"income_frequency",value:t.income_frequency,onChange:i=>m(i,s,"income_frequency"),items:[{label:"Daily",value:"daily"},{label:"Bi-weekly",value:"bi_weekly"},{label:"Weekly",value:"weekly"},{label:"Monthly",value:"monthly"},{label:"Annually",value:"annually"}]}),e.jsx(n,{message:r[`livelihoods.${s}.income_frequency`],className:"mt-2"})]})]}),u?e.jsx(e.Fragment,{}):e.jsx("button",{type:"button",onClick:()=>re(s),className:"absolute top-1 right-2 flex items-center gap-1 text-sm text-red-400 hover:text-red-800 font-medium mt-1 mb-5 transition-colors duration-200",children:e.jsx(we,{className:"text-2xl"})})]},s)),e.jsxs("div",{className:"flex justify-between items-center p-3",children:[u===null?e.jsxs("button",{type:"button",onClick:oe,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800 font-medium mt-4 transition-colors duration-200",children:[e.jsx(Se,{className:"text-2xl"}),e.jsx("span",{children:"Add Livelihood"})]}):e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end items-center text-end mt-5 gap-4",children:[u==null&&e.jsxs(f,{type:"button",onClick:()=>T(),children:[e.jsx(Ve,{})," Reset"]}),e.jsxs(f,{className:"bg-blue-700 hover:bg-blue-400 ",type:"submit",children:[u?"Update":"Add"," ",e.jsx(ke,{})]})]})]})]})]})}),v==="view"&&A?e.jsx($e,{person:A}):null]}),e.jsx(Ie,{isOpen:X,onClose:()=>{N(!1)},onConfirm:he,residentId:R})]})}export{Ut as default};
