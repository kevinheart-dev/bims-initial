import{r as s,K as de,m as pe,j as e,S as fe,a as q}from"./app-DWLvIQdF.js";import ge from"./DynamicTable-D6nhkc6_.js";import xe from"./DynamicTableControls-Zyjm1i4x.js";import{u as ye}from"./useAppUrl-DygNqr49.js";import{u as be}from"./useQuery-C7hK2GdS.js";import{S as B}from"./skeleton-DxhMNfTQ.js";import he from"./ActionMenu-BTp0V9kb.js";import{F as ve}from"./FillterToggle-C8sWYfDm.js";import{I as je}from"./InputField-DCBd0Ia9.js";import{B as b}from"./button-D5oOHpih.js";import{I as _e}from"./input-Bjq-UOVg.js";import Ce from"./SidebarModal-vxJbyoHl.js";import{I as Se,a as Ne,b as we}from"./index-BK-nQiHO.js";import{D as L}from"./DropdownInputField-CGF8rdIi.js";import{I as h}from"./InputError-B2rpTTc2.js";import{t as m,T as Ie}from"./index-DiQ2ABd4.js";import{I as De}from"./InputLabel-CbfaVs9z.js";import Ee from"./DeleteConfirmationModal-BeH75Yd3.js";import{S as Me}from"./search-G9nvaKgi.js";import{L as Fe}from"./list-plus-D54S5Rjd.js";import{R as Pe}from"./rotate-ccw-D5bcHjGp.js";import{S as ke}from"./square-pen-Cxeeoy9N.js";import{T as Ae}from"./trash-2-DlJ2Uvw3.js";import"./createLucideIcon-COg8xDid.js";import"./dropdown-menu-301tgmQC.js";import"./index-C7xi9LN0.js";import"./index-DaxHkuH7.js";import"./floating-ui.react-dom-TXoiB1Cy.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./check-DAMLPx8H.js";import"./chevron-right-B7veGfa5.js";import"./tooltip-DGgHmMGp.js";import"./ellipsis-BLBb_BVq.js";import"./chevron-up-DDEZVR48.js";import"./constants-BC8DDBPg.js";import"./x-Dj4h3Hl7.js";import"./iconBase-BwLSqiDZ.js";const ht=()=>{const D=ye(),[U,v]=s.useState(!1),[H,j]=s.useState(""),[n,E]=s.useState(null),d=de().props,_=(d==null?void 0:d.error)??null,[o,M]=s.useState({}),[F,P]=s.useState(o.name??""),[$,C]=s.useState(!1),[k,V]=s.useState(null),{data:i,isLoading:Q,isError:z,error:K,refetch:S}=be({queryKey:["infrastructure",o],queryFn:async()=>{const{data:t}=await q.get(`${D}/barangay_infrastructure`,{params:o});return t},keepPreviousData:!0,staleTime:1e3*60*5}),G=i==null?void 0:i.infrastructure,J=i==null?void 0:i.types,W=i==null?void 0:i.categories,N=[{key:"id",label:"ID"},{key:"image",label:"Image"},{key:"infrastructure_type",label:"Type"},{key:"infrastructure_category",label:"Category"},{key:"quantity",label:"Quantity"},{key:"created_at",label:"Created At"},{key:"updated_at",label:"Updated At"},{key:"actions",label:"Actions"}],X=N.map(t=>t.key),[p,Y]=s.useState(()=>{const t=localStorage.getItem("infrastructures_visible_columns");return t?JSON.parse(t):X}),w=Object.entries(o||{}).some(([t,r])=>["infra_type","infra_category","created_at","updated_at"].includes(t)&&r&&r!==""),[A,T]=s.useState(w);s.useEffect(()=>{w&&T(!0)},[w]),s.useEffect(()=>{localStorage.setItem("infrastructures_visible_columns",JSON.stringify(p))},[p]);const Z=t=>{t.preventDefault(),I("name",F)},I=(t,r)=>{M(a=>{const l={...a};return r&&r.trim()!==""?l[t]=r:delete l[t],delete l.page,l})},ee=(t,r)=>{r.key==="Enter"&&I(t,r.target.value)},te={id:t=>t.id,image:t=>e.jsx("img",{src:t.infrastructure_image?`/storage/${t.infrastructure_image}`:"/images/default-avatar.jpg",onError:r=>{r.target.onerror=null,r.target.src="/images/default-avatar.jpg"},alt:"Resident",className:"w-20 h-20 min-w-20 min-h-20 object-cover rounded-sm border"}),infrastructure_type:t=>e.jsx("span",{className:"font-medium text-gray-900",children:t.infrastructure_type||"—"}),infrastructure_category:t=>e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-0.5 rounded-md text-xs font-medium capitalize",children:t.infrastructure_category||"—"}),quantity:t=>e.jsx("span",{className:"text-sm text-gray-700",children:t.quantity??"—"}),created_at:t=>e.jsx("span",{className:"text-sm text-gray-500",children:t.created_at?new Date(t.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}),updated_at:t=>e.jsx("span",{className:"text-sm text-gray-500",children:t.updated_at?new Date(t.updated_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}),actions:t=>e.jsx(he,{actions:[{label:"Edit",icon:e.jsx(ke,{className:"w-4 h-4 text-green-500"}),onClick:()=>oe(t.id)},{label:"Delete",icon:e.jsx(Ae,{className:"w-4 h-4 text-red-600"}),onClick:()=>ce(t.id)}]})},re=()=>{j("add"),v(!0)},{data:u,setData:f,post:O,errors:g,reset:R,clearErrors:ae}=pe({infrastructures:[[]],_method:void 0,infrastructure_id:null}),se=()=>{f("infrastructures",[...u.infrastructures||[],{}])},le=t=>{const r=[...u.infrastructures||[]];r.splice(t,1),f("infrastructures",r),m.warning("Infrastructure removed.",{duration:2e3})},x=(t,r,a)=>{f(l=>{const c=[...l.infrastructures];return a==="infrastructure_image"&&t instanceof File?c[r]={...c[r],infrastructure_image:t,previewImage:URL.createObjectURL(t)}:c[r]={...c[r],[a]:t},{...l,infrastructures:c}})},y=()=>{v(!1),j(""),E(null),R(),ae()},ie=[{label:"Evacuation Center",value:"Evacuation Center"},{label:"Flood Control",value:"Flood Control"},{label:"Rain Water Harvester (Communal)",value:"Rain Water Harvester (Communal)"},{label:"Barangay Disaster Operation Center",value:"Barangay Disaster Operation Center"},{label:"Public Comfort Room/Toilet",value:"Public Comfort Room/Toilet"},{label:"Community Garden",value:"Community Garden"},{label:"Barangay Health Center",value:"Barangay Health Center"},{label:"Hospital",value:"Hospital"},{label:"Maternity Clinic",value:"Maternity Clinic"},{label:"Child Clinic",value:"Child Clinic"},{label:"Private Medical Clinic",value:"Private Medical Clinic"},{label:"Barangay Drug Store",value:"Barangay Drug Store"},{label:"City/Municipal Public Drug Store",value:"City/Municipal Public Drug Store"},{label:"Private Drug Store",value:"Private Drug Store"},{label:"Quarantine/Isolation Facility",value:"Quarantine/Isolation Facility"},{label:"Child Development Center",value:"Child Development Center"},{label:"Preschool",value:"Preschool"},{label:"Elementary",value:"Elementary"},{label:"Secondary",value:"Secondary"},{label:"Vocational",value:"Vocational"},{label:"College/University",value:"College/University"},{label:"Islamic School",value:"Islamic School"},{label:"Rice Mill",value:"Rice Mill"},{label:"Corn Mill",value:"Corn Mill"},{label:"Feed Mill",value:"Feed Mill"},{label:"Agricultural Produce Market",value:"Agricultural Produce Market"}],ne=t=>{t.preventDefault(),O(route("barangay_infrastructure.store"),{onError:r=>{console.error("Validation Errors:",r);const a=Object.values(r).join("<br />");m.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:a}}),duration:3e3,closeButton:!0})},onSuccess:()=>{S(),y()}})},oe=async t=>{j("edit");try{const a=(await q.get(`${D}/barangay_infrastructure/details/${t}`)).data.infra;console.log(a),E(a),f({infrastructures:[{infrastructure_image:null,previewImage:a.infrastructure_image?`/storage/${a.infrastructure_image}`:null,infrastructure_type:a.infrastructure_type||"",infrastructure_category:a.infrastructure_category||"",quantity:a.quantity||""}],_method:"PUT",infrastructure_id:a.id}),v(!0)}catch(r){console.error("Error fetching infrastructure details:",r)}},ue=t=>{t.preventDefault(),O(route("barangay_infrastructure.update",u.infrastructure_id),{onError:r=>{console.error("Validation Errors:",r);const a=Object.values(r).join("<br />");m.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:a}}),duration:3e3,closeButton:!0})},onSuccess:()=>{S(),y()}})},ce=t=>{V(t),C(!0)},me=()=>{fe.delete(route("barangay_infrastructure.destroy",k),{onError:t=>{console.error("Validation Errors:",t);const r=Object.values(t).join("<br />");m.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:r}}),duration:3e3,closeButton:!0})},onSuccess:()=>{S(),y()}}),C(!1)};return s.useEffect(()=>{_&&m.error(_,{description:"Operation failed!",duration:3e3,closeButton:!0}),d.error=null},[_]),Q?e.jsxs("div",{className:"gap-2 space-y-4",children:[e.jsx(B,{className:"h-[20px] w-[100px] rounded-full"}),e.jsx(B,{className:"h-[10px] w-[100px] rounded-full"})]}):z?e.jsxs("div",{className:"text-red-500",children:["Error: ",K.message]}):e.jsxs("div",{className:"p-2 md:px-2 md:py-2",children:[e.jsx(Ie,{richColors:!0}),e.jsxs("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx(xe,{allColumns:N,visibleColumns:p,setVisibleColumns:Y,showFilters:A,toggleShowFilters:()=>T(t=>!t)})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[e.jsxs("form",{onSubmit:Z,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[e.jsx(_e,{type:"text",placeholder:"Search infrastructure name",value:F,onChange:t=>P(t.target.value),onKeyDown:t=>ee("name",t.target.value),className:"ml-4"}),e.jsx(b,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(Me,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(b,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",onClick:()=>re(),children:e.jsx(Fe,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add an Infrastructure"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[A&&e.jsx(ve,{queryParams:o,searchFieldName:I,visibleFilters:["infra_type","infra_category","created_at","updated_at"],showFilters:!0,categories:W,types:J,setQueryParams:M,setQuery:P,clearRouteAxios:!0}),e.jsx(ge,{passedData:G,allColumns:N,columnRenderers:te,visibleColumns:p,showTotal:!0})]})]}),e.jsx(Ce,{isOpen:U,onClose:()=>{y()},title:H=="add"?"Add Infrastructure":"Edit Infrastructure",children:e.jsxs("form",{className:"bg-gray-50 p-4 rounded-lg",onSubmit:n?ue:ne,children:[e.jsx("h3",{className:"text-2xl font-medium text-gray-700",children:"Barangay Infrastructure Information"}),e.jsx("p",{className:"text-sm text-gray-500 mb-8",children:"Please provide details about the existing facilities, utilities, and structures within the barangay."}),Array.isArray(u.infrastructures)&&u.infrastructures.map((t,r)=>e.jsxs("div",{className:"border p-4 mb-4 rounded-md relative bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 mb-6",children:[e.jsxs("div",{className:"md:col-span-2 flex flex-col items-center space-y-2",children:[e.jsx(De,{htmlFor:`infrastructure_image_${r}`,value:"Infrastructure Photo"}),e.jsx("img",{src:t.previewImage?t.previewImage:"/images/default-avatar.jpg",alt:"Infrastructure Image",className:"w-32 h-32 object-cover rounded-sm border border-gray-200"}),e.jsx("input",{id:`infrastructure_image_${r}`,type:"file",accept:"image/*",onChange:a=>{const l=a.target.files[0];l&&x(l,r,"infrastructure_image")},className:`block w-full text-sm text-gray-500
                                                        file:mr-2 file:py-1 file:px-3
                                                        file:rounded file:border-0
                                                        file:text-xs file:font-semibold
                                                        file:bg-blue-50 file:text-blue-700
                                                        hover:file:bg-blue-100`}),e.jsx(h,{message:g[`infrastructures.${r}.infrastructure_image`],className:"mt-2"})]}),e.jsxs("div",{className:"md:col-span-4 space-y-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(L,{label:"Infrastructure Type",name:"infrastructure_type",value:t.infrastructure_type||"",onChange:a=>x(a.target.value,r,"infrastructure_type"),items:ie,placeholder:"Select or Enter Type"}),e.jsx(h,{message:g[`infrastructures.${r}.infrastructure_type`],className:"mt-1"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(L,{label:"Infrastructure Category",name:"infrastructure_category",value:t.infrastructure_category||"",onChange:a=>x(a.target.value,r,"infrastructure_category"),placeholder:"Select or Enter Category",items:[{label:"Disaster and Community Facilities",value:"Disaster and Community Facilities"},{label:"Health and Medical",value:"Health and Medical"},{label:"Educational",value:"Educational"},{label:"Agricultural",value:"Agricultural"}]}),e.jsx(h,{message:g[`infrastructures.${r}.infrastructure_category`],className:"mt-1"})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(je,{type:"number",label:"Quantity",name:"quantity",value:t.quantity||"",onChange:a=>x(a.target.value,r,"quantity"),placeholder:"Enter Quantity"}),e.jsx(h,{message:g[`infrastructures.${r}.quantity`],className:"mt-1"})]})]})]})]}),n===null&&e.jsx("button",{type:"button",onClick:()=>le(r),className:"absolute top-1 right-2 flex items-center gap-1 text-sm text-red-400 hover:text-red-800 font-medium mt-1 mb-5 transition-colors duration-200",children:e.jsx(Se,{className:"text-2xl"})})]},r)),e.jsxs("div",{className:"flex justify-between items-center p-3",children:[n===null?e.jsxs("button",{type:"button",onClick:se,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800 font-medium mt-4 transition-colors duration-200",children:[e.jsx(Ne,{className:"text-2xl"}),e.jsx("span",{children:"Add Infrastructure"})]}):e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end items-center text-end mt-5 gap-4",children:[n==null&&e.jsxs(b,{type:"button",onClick:()=>R(),children:[e.jsx(Pe,{})," Reset"]}),e.jsxs(b,{className:"bg-blue-700 hover:bg-blue-400 ",type:"submit",children:[n?"Update":"Add"," ",e.jsx(we,{})]})]})]})]})}),e.jsx(Ee,{isOpen:$,onClose:()=>{C(!1)},onConfirm:me,residentId:k})]})};export{ht as default};
