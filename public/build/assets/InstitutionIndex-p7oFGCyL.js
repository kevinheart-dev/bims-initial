import{r as i,K as oe,m as le,j as e,$ as de,S as ue,a as U}from"./app-CxQIk-Ug.js";import ce from"./DynamicTable-CqqNB_Qd.js";import{u as me}from"./useAppUrl-CjqOY4Q6.js";import{S as Y}from"./skeleton-DNA1kKC7.js";import{u as pe}from"./useQuery-D8TZOE0x.js";import xe from"./ActionMenu-BbqZ2nO_.js";import he from"./DynamicTableControls-BBZXxs2q.js";import{I as be}from"./input-C3invO0g.js";import{B as y}from"./button-eWlrO1vI.js";import{F as ge}from"./FillterToggle-DxBAgWQx.js";import{I as ye,a as fe}from"./constants-DEVjsWMH.js";import{I as je}from"./InputField-ClYvY_TS.js";import{I as m}from"./InputError-B_I55Pol.js";import{D as ve}from"./DropdownInputField-CATmAO2Q.js";import{Y as Ne}from"./YearDropdown-CAAPiKtH.js";import{I as Se,a as _e,b as Ie}from"./index-YqE4AmIH.js";import Te from"./SidebarModal-BwBQKpMA.js";import{T as we}from"./textarea-DuLHQFIs.js";import{t as p,T as Ce}from"./index-BxD4ZtM3.js";import{S as Ee}from"./SelectField-D1KU0e9Z.js";import De from"./DeleteConfirmationModal-BIRqOANr.js";import{S as ke}from"./search-CXT4UFH7.js";import{L as Ae}from"./list-plus-CG1NM5AP.js";import{R as Oe}from"./rotate-ccw-DgX9TvGC.js";import{S as Fe}from"./square-pen-BRCyuNmj.js";import{T as $e}from"./trash-2-BAENtbzN.js";import"./createLucideIcon-DUzL0oSb.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./dropdown-menu-BIG2J05K.js";import"./index-a0Ptbf1R.js";import"./index-D20yT8t5.js";import"./floating-ui.react-dom-CDryE2et.js";import"./check-BlEJph0r.js";import"./chevron-right-9pm6d_Wd.js";import"./tooltip-DJWjtVs0.js";import"./ellipsis-lwZyIBcE.js";import"./chevron-up-DDsNXP0q.js";import"./iconBase-CyZ4dN64.js";import"./x-CoOb-UyO.js";const Nt=()=>{const w=me(),[L,f]=i.useState(!1),[B,j]=i.useState(""),[n,C]=i.useState(null),x=oe().props,v=(x==null?void 0:x.error)??null,[o,E]=i.useState({}),[D,k]=i.useState(o.name??""),[R,N]=i.useState(!1),[A,V]=i.useState(null),{data:O,isLoading:q,isError:z,error:H,refetch:S}=pe({queryKey:["institutions",o],queryFn:async()=>{const{data:t}=await U.get(`${w}/barangay_institution`,{params:o});return t.institutions},keepPreviousData:!0,staleTime:1e3*60*5}),_=[{key:"id",label:"ID"},{key:"name",label:"Name"},{key:"type",label:"Institution Type"},{key:"head",label:"Head of Institution"},{key:"description",label:"Description"},{key:"year_established",label:"Year Established"},{key:"status",label:"Status"},{key:"created_at",label:"Created At"},{key:"updated_at",label:"Updated At"},{key:"actions",label:"Actions"}],K=_.map(t=>t.key),[h,G]=i.useState(()=>{const t=localStorage.getItem("instutions_visible_columns");return t?JSON.parse(t):K}),I=Object.entries(o||{}).some(([t,s])=>["institution"].includes(t)&&s&&s!==""),[F,$]=i.useState(I);i.useEffect(()=>{I&&$(!0)},[I]),i.useEffect(()=>{localStorage.setItem("instutions_visible_columns",JSON.stringify(h))},[h]);const Q=t=>{t.preventDefault(),T("name",D)},T=(t,s)=>{E(a=>{const r={...a};return s&&s.trim()!==""?r[t]=s:delete r[t],delete r.page,r})},J=(t,s)=>{s.key==="Enter"&&T(t,s.target.value)},X={id:t=>t.id,name:t=>e.jsx(de,{href:route("barangay_institution.show",t.id),children:e.jsx("span",{className:"font-medium text-gray-900 hover:text-blue-500 hover:underline",children:t.name||"—"})}),type:t=>e.jsx("span",{className:"text-sm text-gray-700",children:fe[t.type]||"—"}),head:t=>{var a;const s=(a=t==null?void 0:t.head)==null?void 0:a.resident;return s?`${s.firstname} ${s.middlename??""} ${s.lastname} ${s.suffix??""}`:"No assigned head"},description:t=>e.jsx("span",{className:"text-sm text-gray-500 line-clamp-2",children:t.description||"—"}),year_established:t=>e.jsx("span",{className:"text-sm text-gray-700",children:t.year_established||"—"}),status:t=>{const s={active:"bg-green-100 text-green-800",inactive:"bg-yellow-100 text-yellow-800",dissolved:"bg-red-100 text-red-800"};return e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${s[t.status]||"bg-gray-100 text-gray-800"}`,children:ye[t.status]||"—"})},created_at:t=>e.jsx("span",{className:"text-sm text-gray-500",children:t.created_at?new Date(t.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}),updated_at:t=>e.jsx("span",{className:"text-sm text-gray-500",children:t.updated_at?new Date(t.updated_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}),actions:t=>e.jsx(xe,{actions:[{label:"Edit",icon:e.jsx(Fe,{className:"w-4 h-4 text-green-500"}),onClick:()=>ae(t.id)},{label:"Delete",icon:e.jsx($e,{className:"w-4 h-4 text-red-600"}),onClick:()=>re(t.id)}]})},W=()=>{j("add"),f(!0)},{data:l,setData:b,post:M,errors:d,reset:P,clearErrors:Z}=le({institutions:[[]],_method:void 0,institution_id:null}),ee=()=>{b("institutions",[...l.institutions||[],{}])},te=t=>{const s=[...l.institutions||[]];s.splice(t,1),b("institutions",s),p.warning("Institution removed.",{duration:2e3})},g=()=>{f(!1),j(""),C(null),P(),Z()},u=(t,s,a)=>{b(r=>{const c=[...r.institutions];return c[s]||(c[s]={}),c[s]={...c[s],[a]:t},{...r,institutions:c}})},se=t=>{t.preventDefault(),M(route("barangay_institution.store"),{onError:s=>{console.error("Validation Errors:",s);const a=Object.values(s).join("<br />");p.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:a}}),duration:3e3,closeButton:!0})},onSuccess:()=>{S(),g()}})},ae=async t=>{j("edit");try{const a=(await U.get(`${w}/barangay_institution/details/${t}`)).data.institution;console.log(a),C(a),b({institutions:[{name:a.name||"",type:a.type||"",status:a.status||"",description:a.description||"",year_established:a.year_established||""}],_method:"PUT",institution_id:a.id}),f(!0)}catch(s){console.error("Error fetching institution details:",s)}},ie=t=>{t.preventDefault(),M(route("barangay_institution.update",l.institution_id),{onError:s=>{const a=Object.values(s).join("<br />");p.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:a}}),duration:3e3,closeButton:!0})},onSuccess:()=>{S(),g()}})},re=t=>{V(t),N(!0)},ne=()=>{ue.delete(route("barangay_institution.destroy",A),{onError:t=>{console.error("Validation Errors:",t);const s=Object.values(t).join("<br />");p.error("Validation Error",{description:e.jsx("span",{dangerouslySetInnerHTML:{__html:s}}),duration:3e3,closeButton:!0})},onSuccess:()=>{S(),g()}}),N(!1)};return i.useEffect(()=>{v&&p.error(v,{description:"Operation failed!",duration:3e3,closeButton:!0}),x.error=null},[v]),q?e.jsxs("div",{className:"gap-2 space-y-4",children:[e.jsx(Y,{className:"h-[20px] w-[100px] rounded-full"}),e.jsx(Y,{className:"h-[10px] w-[100px] rounded-full"})]}):z?e.jsxs("div",{className:"text-red-500",children:["Error: ",H.message]}):e.jsxs("div",{className:"p-2 md:px-2 md:py-2",children:[e.jsx(Ce,{richColors:!0}),e.jsxs("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx(he,{allColumns:_,visibleColumns:h,setVisibleColumns:G,showFilters:F,toggleShowFilters:()=>$(t=>!t)})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[e.jsxs("form",{onSubmit:Q,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[e.jsx(be,{type:"text",placeholder:"Search institutions",value:D,onChange:t=>k(t.target.value),onKeyDown:t=>J("name",t.target.value),className:"ml-4"}),e.jsx(y,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(ke,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(y,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",onClick:W,children:e.jsx(Ae,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add an Institution"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[F&&e.jsx(ge,{queryParams:o,searchFieldName:T,visibleFilters:["institution"],showFilters:!0,institutions:O.data,setQueryParams:E,setQuery:k,clearRouteAxios:!0}),e.jsx(ce,{passedData:O,allColumns:_,columnRenderers:X,visibleColumns:h,showTotal:!0})]})]}),e.jsx(Te,{isOpen:L,onClose:()=>{g()},title:B=="add"?"Add Institution":"Edit Institution",children:e.jsxs("form",{className:"bg-gray-50 p-4 rounded-lg",onSubmit:n?ie:se,children:[e.jsx("h3",{className:"text-2xl font-medium text-gray-700",children:"Barangay Institutions / Groups"}),e.jsx("p",{className:"text-sm text-gray-500 mb-8",children:"Please provide details about existing institutions, organizations, or groups within the barangay."}),Array.isArray(l.institutions)&&l.institutions.map((t,s)=>e.jsxs("div",{className:"border p-4 mb-4 rounded-md relative bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 mb-6 gap-4",children:[e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(je,{label:"Institution Name",name:"name",value:t.name||"",onChange:a=>u(a.target.value,s,"name"),placeholder:"e.g. Fisherfolk Association"}),e.jsx(m,{message:d[`institutions.${s}.name`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(ve,{label:"Institution Type",name:"type",value:t.type||"",onChange:a=>u(a.target.value,s,"type"),placeholder:"Select or enter type",items:[{label:"Youth Organization",value:"youth_org"},{label:"Cooperative",value:"coop"},{label:"Religious Group",value:"religious"},{label:"Farmers Association",value:"farmers"},{label:"Transport Group",value:"transport"}]}),e.jsx(m,{message:d[`institutions.${s}.type`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-6",children:[e.jsx(we,{label:"Description",name:"description",value:t.description||"",onChange:a=>u(a.target.value,s,"description"),className:"text-gray-600",placeholder:"Brief description of the institution..."}),e.jsx(m,{message:d[`institutions.${s}.description`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(Ne,{label:"Year Established",name:"year_established",value:t.year_established||"",onChange:a=>u(a.target.value,s,"year_established"),placeholder:"YYYY"}),e.jsx(m,{message:d[`institutions.${s}.year_established`],className:"mt-1"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(Ee,{label:"Status",name:"status",value:t.status||"",onChange:a=>u(a.target.value,s,"status"),items:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"},{label:"Dissolved",value:"dissolved"}]}),e.jsx(m,{message:d[`institutions.${s}.status`],className:"mt-1"})]})]}),n===null&&e.jsx("button",{type:"button",onClick:()=>te(s),className:"absolute top-1 right-2 flex items-center gap-1 text-sm text-red-400 hover:text-red-800 font-medium mt-1 mb-5 transition-colors duration-200",children:e.jsx(Se,{className:"text-2xl"})})]},s)),e.jsxs("div",{className:"flex justify-between items-center p-3",children:[n===null?e.jsxs("button",{type:"button",onClick:ee,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800 font-medium mt-4 transition-colors duration-200",children:[e.jsx(_e,{className:"text-2xl"}),e.jsx("span",{children:"Add Institution"})]}):e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end items-center text-end mt-5 gap-4",children:[n==null&&e.jsxs(y,{type:"button",onClick:()=>P(),children:[e.jsx(Oe,{})," Reset"]}),e.jsxs(y,{className:"bg-blue-700 hover:bg-blue-400",type:"submit",children:[n?"Update":"Add"," ",e.jsx(Ie,{})]})]})]})]})}),e.jsx(De,{isOpen:R,onClose:()=>{N(!1)},onConfirm:ne,residentId:A})]})};export{Nt as default};
