import{r as a,m as ae,j as e,L as re,a as le,S as ie}from"./app-FQbzxGIw.js";import{S as oe,F as ne}from"./AdminLayout-D681-fmM.js";import{B as m}from"./button-9tywdtpe.js";import ce from"./BreadcrumbsHeader-BKQz8BHC.js";import{D as de}from"./DropdownInputField-D0XusS6V.js";import{I as F}from"./InputField-DUwBnDWI.js";import{I as g}from"./InputError-BKQpvrj7.js";import{B as me,C as ue,i as pe}from"./constants-0uClA9D3.js";import{u as xe}from"./useAppUrl-zATTBKeL.js";import{t as y,T as he}from"./index-CMTh6Y7Z.js";import fe from"./DynamicTableControls-Dp8-Etap.js";import{I as be}from"./input-BxejiG4V.js";import{F as ge}from"./FillterToggle-C5Vn0ru6.js";import ye from"./DynamicTable-BMSA2BaJ.js";import je from"./ActionMenu-CzwL-S4C.js";import ve from"./SidebarModal-DD4dEoye.js";import{S as Ne}from"./search-BMvlfdsT.js";import{c as M}from"./createLucideIcon-CbmRPBK-.js";import{R as _e}from"./rotate-ccw-C8GY2dtN.js";import{T as we}from"./trash-2-DbTjliIz.js";import"./sidebar-kMsPs0kt.js";import"./index-D9GFQlD6.js";import"./index-BvtReL5S.js";import"./floating-ui.react-dom-Bv5Tn9NB.js";import"./x-SzE7BJuj.js";import"./skeleton-C5JXX0Vb.js";import"./tooltip-D5qIOJrT.js";import"./nav-user-NQ1-22E_.js";import"./avatar-B4QdFqbk.js";import"./dropdown-menu-Mj4r6j7K.js";import"./check-KP9WahT6.js";import"./chevron-right-KG4eDgaU.js";import"./users-round-fHMLq3qJ.js";import"./chevron-up-D1MoY1rl.js";import"./clsx-B-dksMZM.js";import"./breadcrumb-CZJEnQm8.js";import"./ellipsis-CzsbrfyR.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4",key:"1pf5j1"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 15h10",key:"jfw4w8"}],["path",{d:"m9 18 3-3-3-3",key:"112psh"}]],Ce=M("file-input",Se);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ee=M("file-warning",Ie);function bt({documents:j,residents:ke,certificates:O,queryParams:r=null,success:u=null,error:o=null}){var A;const D=[{label:"Residents Information",showOnMobile:!1},{label:"Certificate Issuance",showOnMobile:!0}],q=xe(),[Te,P]=a.useState(!1),L=["fullname","fullname_2","day","month","year","ctrl_no","civil_status","civil_status_2","purpose","purpose_2","purok","day_2","month_2","year_2","issued_on"],v=t=>t.toLowerCase().replace(/(?:^|_)([a-z])/g,(s,l)=>l.toUpperCase()),{data:i,setData:n,post:U,errors:p,setError:N,reset:_,clearErrors:w}=ae({resident_id:null,resident_name:"",document_id:null,document_name:"",birthdate:null,age:null,civil_status:"",resident_image:"",purpose:"",placeholders:null}),z=[{label:"January",value:"1"},{label:"February",value:"2"},{label:"March",value:"3"},{label:"April",value:"4"},{label:"May",value:"5"},{label:"June",value:"6"},{label:"July",value:"7"},{label:"August",value:"8"},{label:"September",value:"9"},{label:"October",value:"10"},{label:"November",value:"11"},{label:"December",value:"12"}],V=async t=>{const s=j.find(l=>l.id==t);if(s){n("document_name",s.name),n("document_id",s.id);try{const l=await le.get(`${q}/document/fetchplaceholders/${t}`);n("placeholders",l.data.placeholders)}catch(l){console.error("Error fetching placeholders:",l)}}},c=j.map(t=>({label:t.name.replace(/\s+/g," ").trim(),value:t.id.toString()})),B=t=>{if(t.preventDefault(),w(),!i.document_id){N("document_id","Please select a certificate.");return}if(!i.purpose){N("purpose","Please provide the purpose.");return}U(route("resident.certificate.store"),i,{onError:s=>{console.error("Validation Errors:",s);const l=Object.values(s).flat();y.error("Validation Error",{description:e.jsx("ul",{className:"list-disc pl-5",children:l.map((te,se)=>e.jsx("li",{children:te},se))})})}})};r=r||{};const[S,J]=a.useState(r.name??""),$=t=>{t.preventDefault(),x("name",S)},x=(t,s)=>{s&&s.trim()!==""?r[t]=s:delete r[t],r.page&&delete r.page,ie.get(route("certificate.index",r))},H=(t,s)=>{if(s.key==="Enter")x(t,s.target.value);else return},[Q,C]=a.useState(!1),[K,I]=a.useState(""),h=Object.entries(r||{}).some(([t,s])=>["certificate_type","request_status","issued_by","issued_at"].includes(t)&&s&&s!=="");a.useEffect(()=>{h&&k(!0)},[h]);const f=[{key:"id",label:"Issued ID"},{key:"certificate",label:"Certificate"},{key:"purpose",label:"Purpose"},{key:"request_status",label:"Request Status"},{key:"issued_by",label:"Issued By"},{key:"issued_at",label:"Issued At"},{key:"control_number",label:"Control Number"},{key:"actions",label:"Actions"}],[E,k]=a.useState(h),X=()=>{window.print()},[Y,Re]=a.useState(!0),[T,G]=a.useState(!1),[Ae,Fe]=a.useState(null),W=f.map(t=>t.key),[d,R]=a.useState(()=>{const t=localStorage.getItem("certificate_visible_columns");return t?JSON.parse(t):W});a.useEffect(()=>{localStorage.setItem("certificate_visible_columns",JSON.stringify(d))},[d]);const Z={id:t=>e.jsx("span",{className:"text-xs text-gray-700",children:t.id}),certificate:t=>{var s;return e.jsx("span",{className:"text-xs text-indigo-700 font-medium",children:((s=t.document)==null?void 0:s.name)??"—"})},purpose:t=>e.jsx("span",{className:"text-xs text-gray-700",children:t.purpose??"—"}),request_status:t=>e.jsx("span",{className:`text-xs font-medium ${pe[t.request_status]}`,children:ue[t.request_status]??"—"}),issued_by:t=>{var s;return e.jsx("span",{className:"text-xs text-gray-700",children:me[(s=t.issued_by)==null?void 0:s.position]??"—"})},issued_at:t=>e.jsx("span",{className:"text-xs text-gray-600",children:t.issued_at??"—"}),control_number:t=>e.jsx("span",{className:"text-xs text-gray-600",children:t.control_number??"—"}),actions:t=>e.jsx(je,{actions:[{label:"Delete",icon:e.jsx(we,{className:"w-4 h-4 text-red-600"}),onClick:()=>handleDelete(t.id)}]})},ee=()=>{I("add"),C(!0)},b=()=>{C(!1),I(""),_(),w(),P(!1)};return a.useEffect(()=>{if(u){b(),y.success(u,{description:"Operation successful!",duration:3e3,className:"bg-green-100 text-green-800"});const t=new URL(window.location.href);t.searchParams.delete("success"),window.history.replaceState({},"",t.pathname+t.search)}},[u]),a.useEffect(()=>{if(!o)return;b();const t=typeof o=="string"?o:o.message||"An error occurred.";y.error(t,{description:"Operation failed!",duration:3e3,className:"bg-red-100 text-red-800"}),typeof clearError=="function"&&clearError()},[o]),e.jsxs(oe,{children:[e.jsx(re,{title:"Certificate Issuance"}),e.jsxs("div",{children:[e.jsx(ce,{breadcrumbs:D}),e.jsx(he,{richColors:!0}),e.jsxs("div",{className:"p-2 md:p-4",children:[e.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-xl shadow-sm",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-full",children:e.jsx(ne,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:"My Certificates"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["View and request"," ",e.jsx("span",{className:"font-medium",children:"official certificates"})," ","from your barangay. You can check your records, request new certificates, or download available documents below."]})]})]})}),e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsx("div",{className:"flex items-start gap-2 flex-wrap",children:e.jsx(fe,{allColumns:f,visibleColumns:d,setVisibleColumns:R,onPrint:X,showFilters:E,toggleShowFilters:()=>k(t=>!t)})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[e.jsxs("form",{onSubmit:$,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[e.jsx(be,{type:"text",placeholder:"Search Name",value:S,onChange:t=>J(t.target.value),onKeyDown:t=>H("name",t),className:"w-full"}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(m,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(Ne,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(m,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",onClick:ee,children:e.jsx(Ce,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Request Certificate"})]})]})]}),E&&e.jsx(ge,{queryParams:r,searchFieldName:x,visibleFilters:["certificate_type","request_status","issued_by","issued_at"],certificateTypes:c,showFilters:!0,months:z,clearRouteName:"certificate.index",clearRouteParams:{}}),e.jsx(ye,{passedData:O,allColumns:f,columnRenderers:Z,queryParams:r,is_paginated:Y,toggleShowAll:()=>G(!T),showAll:T,visibleColumns:d,setVisibleColumns:R})]})}),e.jsx(ve,{isOpen:Q,onClose:()=>{b()},title:"Request a Certificate",children:K==="add"&&e.jsxs("div",{className:"bg-white shadow-xl rounded-2xl p-8 my-8 border border-gray-100",children:[e.jsxs("section",{className:"space-y-3 pb-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Certificate Request"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Choose the type of certificate you need and submit your request to the barangay office. Once processed, your certificate will be available for pickup."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:e.jsxs("div",{children:[e.jsx(de,{label:"Select a Certificate",items:c,value:i.document_name||"",onChange:t=>V(t.target.value),disabled:c.length===0}),e.jsx(g,{message:p.document_id,className:"mt-1"}),c.length>0?e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Example: Certificate of Indigency, Residency, etc."}):e.jsxs("p",{className:"flex items-center text-sm text-red-500 mt-2 font-medium gap-2",children:[e.jsx(Ee,{className:"w-8 h-8 flex-shrink-0"}),e.jsxs("span",{children:["No certificates are currently available.",e.jsx("br",{}),"Please contact your barangay office for assistance."]})]})]})})]}),e.jsxs("section",{className:"space-y-3 py-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Purpose"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Provide the purpose of the certificate. This will appear in the certification document."}),e.jsx("div",{className:"space-y-5",children:e.jsxs("div",{children:[e.jsx(F,{label:"Purpose",value:i.purpose||"",onChange:t=>n("purpose",t.target.value)}),e.jsx(g,{message:p.purpose,className:"mt-1"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Example: Scholarship requirement, job application, financial assistance."})]})})]}),((A=i.placeholders)==null?void 0:A.length)>0&&e.jsxs("section",{className:"space-y-3 py-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Additional Information"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Some templates require extra details. Fill out the fields below if they are present in the template."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:i.placeholders.filter(t=>!L.includes(t)).map((t,s)=>e.jsxs("div",{children:[e.jsx(F,{label:v(t),value:i[t]||"",onChange:l=>n(t,l.target.value)}),e.jsx(g,{message:p[t],className:"mt-1"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Provide information for"," ",e.jsx("span",{className:"font-medium",children:v(t)}),"."]})]},s))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6",children:[e.jsxs(m,{type:"button",onClick:()=>_(),variant:"outline",className:"flex items-center gap-2 text-gray-600 hover:text-gray-800",children:[e.jsx(_e,{className:"w-4 h-4"})," Reset"]}),e.jsx(m,{onClick:B,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-xl shadow-md",disabled:!c,children:"Request Certificate"})]})]})})]})]})]})}export{bt as default};
