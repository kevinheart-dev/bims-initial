import{K as $,r as p,j as e,L as q,S as z,a as B}from"./app-CSbLTV9t.js";import{C as O,a as G}from"./card-CvKypycW.js";import{B as h}from"./button-Baqcf9KW.js";import{B as V}from"./badge-eGLk8dnj.js";import{S as X}from"./AdminLayout-CQAB1boG.js";import H from"./DeleteConfirmationModal-C2yWkaRr.js";import K from"./BreadcrumbsHeader-CQaDVuiA.js";import{t as c,T as W}from"./index-BKWT8n_e.js";import{t as Y,B as J,r as Q,R as Z}from"./constants-CQOY_faM.js";import{P as ee}from"./pencil-BIfwdgX-.js";import{T as se}from"./trash-2-D7SnOmvm.js";import{F as D}from"./file-output-CJ6vmdDa.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./sidebar-EM1pc_Vu.js";import"./input-HZV2GfRj.js";import"./index-BWMtPXXG.js";import"./index-CLKsPuj0.js";import"./floating-ui.react-dom-DHVDvaGl.js";import"./x-DSSMIW7T.js";import"./createLucideIcon-K65SoRPX.js";import"./skeleton-C3jJoeQy.js";import"./tooltip-b0GAWXCC.js";import"./nav-user-qFIfSs4r.js";import"./avatar-DBnd5X0z.js";import"./dropdown-menu-DsAxoPEU.js";import"./check-xGOvrYiq.js";import"./chevron-right-ZDo9j4tz.js";import"./useAppUrl-CCPDQKWJ.js";import"./users-round-CTpkNJgD.js";import"./heart-pulse-CgKjARwL.js";import"./chevron-up-BdT9BwPw.js";import"./breadcrumb-BysmSHHT.js";function Le({blotter_details:n}){var S,T,R,C,k;const E=[{label:"Katarungang Pambarangay",showOnMobile:!1},{label:"Summons",href:route("summon.index"),showOnMobile:!1},{label:"View Summon",showOnMobile:!0}],o=$().props,g=(o==null?void 0:o.success)??null,f=(o==null?void 0:o.error)??null,[A,y]=p.useState(!1),[v,F]=p.useState(null),L=t=>{z.get(route("summon.elevate",t))},U=t=>{F(t),y(!0)},I=()=>{console.log("Deleting",v),y(!1)},x=t=>t?new Date(t).toLocaleDateString("en-US",{dateStyle:"medium"}):"-",P=t=>{if(!t)return"-";const s=new Date(t),r=s.toLocaleDateString("en-US",{dateStyle:"medium"}),d=s.toLocaleTimeString([],{hour:"numeric",minute:"2-digit",hour12:!0});return e.jsxs("div",{children:[e.jsx("div",{children:r}),e.jsxs("div",{className:"text-sm text-gray-500",children:["around ",d]})]})},j=(t,s)=>(t==null?void 0:t.filter(r=>r.role_type===s))||[],N=(t,s)=>t!=null&&t.length?e.jsx("ul",{className:"space-y-2",children:t.map(r=>e.jsxs("li",{className:"border p-3 rounded-lg bg-gray-50 flex flex-col",children:[e.jsx("span",{className:"font-medium text-gray-800",children:r.display_name}),r.resident&&e.jsxs("span",{className:"text-sm text-gray-600",children:[Z[r.resident.gender],","," ",r.resident.contact_number||"No contact"]}),r.notes&&e.jsxs("span",{className:"text-xs text-gray-500 italic",children:["Notes: ",r.notes]})]},r.id))}):e.jsxs("p",{className:"text-sm text-gray-500",children:["No ",s,"s recorded."]}),m=(t,s)=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-600",children:t}),typeof s=="string"||typeof s=="number"?e.jsx("p",{className:"text-sm text-gray-900",children:s||"Not provided"}):e.jsx("div",{className:"text-sm text-gray-900",children:s||"Not provided"})]}),u=(t,s)=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 border-b pb-1 mb-2",children:t}),e.jsx("p",{className:"whitespace-pre-line text-sm leading-relaxed text-gray-700",children:(s==null?void 0:s.trim())||"No details provided."})]}),w=t=>{const s={resolved:"bg-green-100 text-green-700",pending:"bg-yellow-100 text-yellow-700",elevated:"bg-red-100 text-red-700"};return e.jsx(V,{className:`capitalize px-2 py-1 rounded ${s[t]||"bg-gray-200 text-gray-700"}`,children:t||"Unknown"})},_=async()=>{var t;try{const s=await B.get(route("summon.generateForm",n.id),{responseType:"blob"}),r=new Blob([s.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),d=window.URL.createObjectURL(r),a=document.createElement("a");a.href=d;const i=s.headers["content-disposition"],l=i==null?void 0:i.match(/filename="?([^"]+)"?/),b=l?l[1]:"summon_form.docx";a.setAttribute("download",b),document.body.appendChild(a),a.click(),a.remove(),c.success("Summon form generated successfully!",{duration:3e3,className:"bg-green-100 text-green-800"})}catch(s){console.error("Summon form generation failed:",s);let r="An unexpected error occurred. Please try again.";s.response?(t=s.response.data)!=null&&t.message?r=s.response.data.message:s.response.status===404?r="The requested summon form could not be found.":s.response.status===500?r="A server error occurred while generating the summon form.":r=`Server responded with status ${s.response.status}.`:s.request?r="No response from server. Please check your internet connection.":r=`Request failed: ${s.message}`,c.error("Failed to generate summon form",{description:r,duration:6e3,className:"bg-red-100 text-red-800",closeButton:!0})}},M=async()=>{var t;try{const s=await B.get(route("summon.fileaction",n.id),{responseType:"blob"}),r=new Blob([s.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),d=window.URL.createObjectURL(r),a=document.createElement("a");a.href=d;const i=s.headers["content-disposition"],l=i==null?void 0:i.match(/filename="?([^"]+)"?/),b=l?l[1]:"certificate_to_file_action.docx";a.setAttribute("download",b),document.body.appendChild(a),a.click(),a.remove(),c.success("Certificate to File Action generated successfully!",{duration:3e3,className:"bg-green-100 text-green-800"})}catch(s){console.error("Certificate generation failed:",s);let r="An unexpected error occurred. Please try again.";s.response?(t=s.response.data)!=null&&t.message?r=s.response.data.message:s.response.status===404?r="The requested certificate could not be found.":s.response.status===500?r="A server error occurred while generating the certificate.":r=`Server responded with status ${s.response.status}.`:s.request?r="No response from server. Please check your internet connection.":r=`Request failed: ${s.message}`,c.error("Failed to generate certificate",{description:r,duration:6e3,className:"bg-red-100 text-red-800",closeButton:!0})}};return p.useEffect(()=>{g&&c.success(g,{description:"Operation successful!",duration:3e3,closeButton:!0}),o.success=null},[g]),p.useEffect(()=>{f&&c.error(f,{description:"Operation failed!",duration:3e3,closeButton:!0}),o.error=null},[f]),e.jsxs(X,{children:[e.jsx(q,{title:"View Blotter Report"}),e.jsx(W,{richColors:!0}),e.jsx(K,{breadcrumbs:E}),e.jsxs("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs(O,{className:"shadow-sm border rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800",children:["Report: ",n.type_of_incident]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Filed on"," ",x(n.created_at)," at"," ",n.location||"Unknown location"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{size:"sm",variant:"outline",onClick:()=>L(n.id),children:[e.jsx(ee,{className:"w-4 h-4 mr-1"})," Edit"]}),e.jsxs(h,{size:"sm",variant:"destructive",onClick:()=>U(n.id),children:[e.jsx(se,{className:"w-4 h-4 mr-1"})," Delete"]}),e.jsxs(h,{size:"sm",className:"bg-green-500 hover:bg-green-600 text-white",onClick:_,children:[e.jsx(D,{className:"w-4 h-4 mr-1"}),"Summon Form"]}),((T=(S=n.summons)==null?void 0:S[0])==null?void 0:T.takes.length)===3&&e.jsxs(h,{size:"sm",className:"bg-blue-500 hover:bg-blue-600 text-white",onClick:M,children:[e.jsx(D,{className:"w-4 h-4 mr-1"}),"Certificate to File Action"]})]})]}),e.jsxs(G,{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[m("Type of Incident",n.type_of_incident),m("Incident Date",P(n.incident_date)),m("Location",n.location),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-600",children:"Report Status"}),w(Y[n.report_status])]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[m("Recorded By",(R=n.recorded_by)!=null&&R.resident?`${n.recorded_by.resident.firstname} ${n.recorded_by.resident.middlename||""} ${n.recorded_by.resident.lastname}`:null),m("Official Position",J[(C=n.recorded_by)==null?void 0:C.position])]}),u("Narrative",n.narrative_details),u("Actions Taken",n.actions_taken),u("Resolution",n.resolution),u("Recommendations",n.recommendations),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-xs text-gray-500",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Created At:"})," ",x(n.created_at)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Last Updated:"})," ",x(n.updated_at)]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Participants"}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-1",children:"Complainants"}),N(j(n.participants,"complainant"),"complainant")]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-1",children:"Respondents"}),N(j(n.participants,"respondent"),"respondent")]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-1",children:"Witnesses"}),N(j(n.participants,"witness"),"witness")]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"Summons"}),(k=n.summons)!=null&&k.length?n.summons.map(t=>e.jsxs(O,{className:"p-4 bg-white border border-gray-200 shadow-sm rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Status:"}),w(Q[t.status])]}),e.jsxs("div",{className:"text-sm text-gray-800 mt-1",children:[e.jsx("span",{className:"font-medium",children:"Issued By:"})," ",t.issued_by||"Unknown"]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("h5",{className:"text-sm font-semibold text-gray-700",children:"Hearing Sessions"}),e.jsx("ul",{className:"space-y-2 mt-2",children:t.takes.map(s=>e.jsxs("li",{className:"border rounded p-2 bg-gray-50",children:[e.jsxs("p",{className:"text-sm text-gray-800",children:[e.jsxs("span",{className:"font-medium",children:["Session"," ",s.session_number,":"]})," ",x(s.hearing_date)]}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Status:"," ",s.session_status]}),s.session_remarks&&e.jsx("p",{className:"text-xs text-gray-500 italic",children:s.session_remarks})]},s.id))})]})]},t.id)):e.jsx("p",{className:"text-sm text-gray-500",children:"No summons issued."})]})]})]}),e.jsx(H,{isOpen:A,onClose:()=>y(!1),onConfirm:I,residentId:v})]})]})}export{Le as default};
