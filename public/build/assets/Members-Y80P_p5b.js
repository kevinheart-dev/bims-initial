import{K as $e,r as l,m as Ce,j as e,L as Ie,S as Z,a as q}from"./app-OMiIBAVv.js";import{S as Ee}from"./AdminLayout-CUYq8DRk.js";import{B as v}from"./button-DSR4zr8t.js";import{I as Me}from"./input-BGuCCM3F.js";import Re from"./BreadcrumbsHeader-D7yXDAqZ.js";import{t as u,T as Oe}from"./index-0Qv22I-m.js";import Ae from"./DynamicTable-UkXv7no2.js";import Le from"./ActionMenu-BwZQbtv1.js";import{R as Fe,b as Te}from"./constants-iESbBslm.js";import Be from"./SidebarModal-BhCVnGdX.js";import Ve from"./DynamicTableControls-D0m5fsZs.js";import{F as Ue}from"./FillterToggle-DNCt5F0M.js";import{u as ze}from"./useAppUrl-D_iSPAaw.js";import Pe from"./PersonDetailContent-DPOW1tjr.js";import He from"./DeleteConfirmationModal-TJ1uBlKB.js";import{D as Ke}from"./DropdownInputField-BkfrznIy.js";import{I}from"./InputError-LtgWhWIb.js";import{I as E}from"./InputLabel-Cqcva6ji.js";import{I as M}from"./InputField-BN9Kcp6u.js";import{I as Ge,a as Ye,b as Qe}from"./index-CK7UpZTr.js";import{S as Xe}from"./search-B5GIhMYd.js";import{L as Je}from"./list-plus-BMoEcxBa.js";import{R as We}from"./rotate-ccw-X1iZFrTN.js";import{E as Ze}from"./eye-Wkg7vRqS.js";import{S as qe}from"./square-pen-CIUQNKLN.js";import{T as et}from"./trash-2-jR1sYQPd.js";import"./sidebar-8I0oMIHa.js";import"./utils-CkmPJWYF.js";import"./clsx-B-dksMZM.js";import"./index-CI6SsBKC.js";import"./index-BLQZ4u8d.js";import"./floating-ui.react-dom-CMRH_ZRG.js";import"./x-CWRGpm6F.js";import"./createLucideIcon-Axl_0YCz.js";import"./skeleton-B3ns0wAt.js";import"./tooltip-DovJGv4D.js";import"./nav-user-CHo7Aeqf.js";import"./avatar-EoKRnGG_.js";import"./dropdown-menu-Bvu9yf_7.js";import"./check-CuPlmUjy.js";import"./chevron-right-Cy23RFOt.js";import"./users-round-DM5XvS4t.js";import"./heart-pulse-BEye5CQy.js";import"./chevron-up-aIKK6lnp.js";import"./breadcrumb-BupgMzbl.js";import"./ellipsis-PuzZ1_TO.js";import"./iconBase-DPQdzrdi.js";import"./index-DoFmE3hV.js";import"./index-vfhmNStI.js";function Jt({members:ee,puroks:te,queryParams:o,residents:R,institution:se}){const re=[{label:"Barangay Information",showOnMobile:!1},{label:"Institution",showOnMobile:!1},{label:"Institution Members",showOnMobile:!0}];o=o||{};const O=ze(),m=$e().props,_=(m==null?void 0:m.success)??null,y=(m==null?void 0:m.error)??null,[ae,N]=l.useState(!1),[A,ie]=l.useState(null),[p,w]=l.useState(null),[L,ne]=l.useState(o.name??""),[le,g]=l.useState(!1),[S,f]=l.useState(""),[F,T]=l.useState(null),oe=t=>{t.preventDefault(),k("name",L)},k=(t,s)=>{s&&s.trim()!==""?o[t]=s:delete o[t],o.page&&delete o.page,Z.get(route("institution_member.index",o))},me=(t,s)=>{if(s.key==="Enter")k(t,s.target.value);else return},D=[{key:"id",label:"ID"},{key:"name",label:"Resident Name"},{key:"sex",label:"Sex"},{key:"age",label:"Age"},{key:"birthdate",label:"Date of Birth"},{key:"member_since",label:"Date of Membership"},{key:"status",label:"Status"},{key:"contact_number",label:"Contact Number"},{key:"purok_number",label:"Purok Number"},{key:"actions",label:"Actions"}],de=R.map(t=>({label:`${t.firstname} ${t.middlename} ${t.lastname} ${t.suffix??""}`,value:t.id.toString()})),[B,V]=l.useState(D.map(t=>t.key)),$=Object.entries(o||{}).some(([t,s])=>["purok","sex","age_group"].includes(t)&&s&&s!=="");l.useEffect(()=>{$&&z(!0)},[$]);const[U,z]=l.useState($),ce=()=>{window.print()},ue=t=>{if(!t)return"Unknown";const s=new Date(t),r=new Date;let a=r.getFullYear()-s.getFullYear();const n=r.getMonth()-s.getMonth();return(n<0||n===0&&r.getDate()<s.getDate())&&a--,a},pe={id:t=>e.jsx("span",{className:"text-xs font-semibold text-gray-500",children:t.id}),name:t=>{const s=t.resident;return e.jsxs("span",{className:"font-medium text-gray-800",children:[s.firstname," ",s.middlename??""," ",s.lastname," ",e.jsx("span",{className:"text-gray-500",children:s.suffix??""})]})},sex:t=>{var n,b,x;const s=(n=t.resident)==null?void 0:n.sex,r=((b=Fe)==null?void 0:b[s])??s??"Unknown",a=((x=Te)==null?void 0:x[s])??"bg-gray-100 text-gray-800";return e.jsx("span",{className:`py-1 px-3 rounded-full text-xs font-semibold shadow-sm whitespace-nowrap ${a}`,children:r})},contact_number:t=>{var a;const s=(a=t.resident)==null?void 0:a.contact_number,r=s||"—";return e.jsx("span",{className:"text-xs font-medium text-gray-700 capitalize",children:r})},age:t=>{const s=t.resident,r=ue(s.birthdate);return r===null?e.jsx("span",{className:"italic text-gray-400",children:"Unknown"}):e.jsxs("div",{className:"flex flex-col text-sm",children:[e.jsxs("span",{className:"font-bold text-indigo-700",children:[r," yrs"]}),r>60&&e.jsx("span",{className:"text-xs text-rose-500 font-semibold mt-0.5",children:"Senior Citizen"})]})},birthdate:t=>{var s;return(s=t.resident)!=null&&s.birthdate?e.jsx("span",{className:"text-gray-700 text-sm",children:new Date(t.resident.birthdate).toLocaleDateString()}):e.jsx("span",{className:"italic text-gray-400",children:"—"})},member_since:t=>t.member_since?e.jsx("span",{className:"text-indigo-600 font-medium text-sm",children:new Date(t.member_since).toLocaleDateString()}):e.jsx("span",{className:"italic text-gray-400",children:"—"}),status:t=>{const s=t.status,r={active:"bg-green-100 text-green-800",inactive:"bg-red-100 text-red-700"};return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold shadow-sm ${r[s]??"bg-gray-100 text-gray-600"}`,children:s})},purok_number:t=>{var s;return e.jsx("span",{className:"text-gray-700 font-medium",children:((s=t.resident)==null?void 0:s.purok_number)??"—"})},actions:t=>e.jsx(Le,{actions:[{label:"View",icon:e.jsx(Ze,{className:"w-4 h-4 text-indigo-600"}),onClick:()=>{var s;return we((s=t.resident)==null?void 0:s.id)}},{label:"Edit",icon:e.jsx(qe,{className:"w-4 h-4 text-green-500"}),onClick:()=>_e(t.id)},{label:"Delete",icon:e.jsx(et,{className:"w-4 h-4 text-red-600"}),onClick:()=>ye(t.id)}]})},{data:c,setData:d,post:P,errors:j,reset:H,clearErrors:be}=Ce({members:[{resident_id:null,resident_name:"",resident_image:null,birthdate:null,purok_number:null,member_since:"",status:"active",is_head:!1}],institution_id:null,member_id:null,_method:void 0}),xe=(t,s)=>{const r=R.find(n=>n.id==t.target.value),a=[...c.members];a[s]={...a[s],resident_id:(r==null?void 0:r.id)||null,resident_name:`${r.firstname} ${r.middlename} ${r.lastname} ${r.suffix??""}`||"",birthdate:(r==null?void 0:r.birthdate)||null,purok_number:(r==null?void 0:r.purok_number)||null,resident_image:(r==null?void 0:r.image)||null},d("members",a),d("institution_id",se.id)},C=(t,s,r)=>{const a=[...c.members];a[s][r]=t.target.type==="checkbox"?t.target.checked:t.target.value,d("members",a)},he=()=>{d("members",[...c.members,{resident_id:null,resident_name:"",resident_image:null,birthdate:null,purok_number:null,member_since:"",status:"active",is_head:!1}])},ge=t=>{const s=[...c.members];s.splice(t,1),d("members",s),u.warning("Member removed.",{duration:2e3})},fe=()=>{f("add"),g(!0)},je=t=>{t.preventDefault(),P(route("institution_member.store"),{onError:s=>{const r=Object.values(s).map((a,n)=>`<div key=${n}> ${a}</div>`);u.error("Validation Error",{description:e.jsx("div",{dangerouslySetInnerHTML:{__html:r.join("")}}),duration:4e3,closeButton:!0})}})},ve=t=>{t.preventDefault(),P(route("institution_member.update",c.member_id),{onError:()=>{const s=Object.values(j).map((r,a)=>`<div key=${a}> ${r}</div>`);u.error("Validation Error",{description:e.jsx("div",{dangerouslySetInnerHTML:{__html:s.join("")}}),duration:4e3,closeButton:!0})}})},K=()=>{f(null),g(!1),T(null),w(null),H(),be()},_e=async t=>{var s,r,a,n,b,x,G,Y,Q,X,J;f("add"),w(null);try{const i=(await q.get(`${O}/institution_member/details/${t}`)).data.member;w(i),d("member_id",i.id),d("_method","PUT"),d("members",[{resident_id:((s=i.resident)==null?void 0:s.id)??null,resident_name:`${((r=i.resident)==null?void 0:r.firstname)??""} ${((a=i.resident)==null?void 0:a.middlename)??""} ${((n=i.resident)==null?void 0:n.lastname)??""} ${((b=i.resident)==null?void 0:b.suffix)??""}`.trim(),resident_image:((x=i.resident)==null?void 0:x.image)??null,birthdate:((G=i.resident)==null?void 0:G.birthdate)??null,purok_number:((Y=i.resident)==null?void 0:Y.purok_number)??null,member_since:i.member_since??"",status:i.status??"active",is_head:i.is_head??!1}])}catch(h){console.error("Error fetching member details:",h);let i="Error",W="Something went wrong. Please try again.";if(((Q=h.response)==null?void 0:Q.status)===422&&((J=(X=h.response)==null?void 0:X.data)!=null&&J.errors)){i="Validation Error";const Se=Object.values(h.response.data.errors).flat();W=e.jsx("ul",{className:"list-disc ml-5",children:Se.map((ke,De)=>e.jsx("li",{children:ke},De))})}u.error(i,{description:W,duration:4e3,closeButton:!0})}finally{g(!0)}},ye=t=>{ie(t),N(!0)},Ne=()=>{Z.delete(route("institution_member.destroy",A),{onError:t=>{const s=Object.values(t).map((r,a)=>`<div key=${a}> ${r}</div>`);u.error("Validation Error",{description:e.jsx("div",{dangerouslySetInnerHTML:{__html:s.join("")}}),duration:4e3,closeButton:!0})}}),N(!1)},we=async t=>{f("view");try{const s=await q.get(`${O}/resident/showresident/${t}`);T(s.data.resident)}catch(s){console.error("Error fetching placeholders:",s)}g(!0)};return l.useEffect(()=>{_&&(K(),u.success(_,{description:"Operation successful!",duration:3e3,closeButton:!0})),m.success=null},[_]),l.useEffect(()=>{y&&u.error(y,{description:"Operation failed!",duration:3e3,closeButton:!0}),m.error=null},[y]),e.jsxs(Ee,{children:[e.jsx(Ie,{title:"Resident Information"}),e.jsxs("div",{children:[e.jsx(Oe,{richColors:!0}),e.jsx(Re,{breadcrumbs:re}),e.jsx("div",{className:"p-2 md:p-4",children:e.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:e.jsx(Ve,{allColumns:D,visibleColumns:B,setVisibleColumns:V,onPrint:ce,showFilters:U,toggleShowFilters:()=>z(t=>!t)})}),e.jsx("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:e.jsxs("form",{onSubmit:oe,className:"flex w-[380px] max-w-lg items-center space-x-1",children:[e.jsx(Me,{type:"text",placeholder:"Search Resident Name",value:L,onChange:t=>ne(t.target.value),onKeyDown:t=>me("name",t.target.value),className:"w-full"}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(v,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(Xe,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(v,{className:"bg-blue-700 hover:bg-blue-400 ",type:"button",onClick:fe,children:e.jsx(Je,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add Institution Member"})]})]})})]}),U&&e.jsx(Ue,{queryParams:o,searchFieldName:k,visibleFilters:["purok","sex","age_group"],puroks:te,showFilters:!0,clearRouteName:"institution_member.index",clearRouteParams:{}}),e.jsx(Ae,{passedData:ee,allColumns:D,columnRenderers:pe,queryParams:o,visibleColumns:B,setVisibleColumns:V})]})})}),e.jsxs(Be,{isOpen:le,onClose:K,title:S==="add"?p?"Edit Resident Death Details":"Add Resident Death Details":"View Resident Details",children:[S==="add"&&e.jsx("div",{className:"w-full rounded-xl border border-white/20 bg-white/10 backdrop-blur-md shadow-lg text-sm text-black p-4 space-y-4",children:e.jsxs("form",{onSubmit:p?ve:je,children:[c.members.map((t,s)=>e.jsxs("div",{className:"border p-4 mb-4 rounded-md relative bg-gray-50",children:[e.jsxs("h3",{className:"text-2xl font-bold text-gray-900 mb-3 flex items-center gap-2",children:["Institution Member –"," ",t.resident_name||"Select a Resident"]}),e.jsx("p",{className:"text-gray-600 mb-6 text-sm",children:"Please provide the membership details of the resident, including their status and role."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-y-2 md:gap-x-4 mb-5 w-full",children:[e.jsxs("div",{className:"md:row-span-2 md:col-span-2 flex flex-col items-center space-y-2",children:[e.jsx(E,{htmlFor:`resident_image_${s}`,value:"Profile Photo"}),e.jsx("img",{src:t.resident_image?`/storage/${t.resident_image}`:"/images/default-avatar.jpg",alt:"Resident Image",className:"w-32 h-32 object-cover rounded-full border border-gray-200"})]}),e.jsxs("div",{className:"md:col-span-4 space-y-2",children:[e.jsx(Ke,{label:"Full Name",name:`members.${s}.resident_name`,value:t.resident_name||"",placeholder:"Select a resident",onChange:r=>xe(r,s),items:de}),e.jsx(I,{message:j[`members.${s}.resident_id`],className:"mt-2"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsx(M,{label:"Birthdate",name:`members.${s}.birthdate`,value:t.birthdate||"",readOnly:!0}),e.jsx(M,{label:"Purok Number",name:`members.${s}.purok_number`,value:t.purok_number||"",readOnly:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(E,{value:"Member Since"}),e.jsx(M,{type:"date",name:`members.${s}.member_since`,value:t.member_since||"",onChange:r=>C(r,s,"member_since")}),e.jsx(I,{message:j[`members.${s}.member_since`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(E,{value:"Status"}),e.jsxs("select",{name:`members.${s}.status`,value:t.status||"active",onChange:r=>C(r,s,"status"),className:"w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 text-sm",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]}),e.jsx(I,{message:j[`members.${s}.status`],className:"mt-2"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",id:`is_head_${s}`,checked:!!t.is_head,onChange:r=>C(r,s,"is_head"),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("label",{htmlFor:`is_head_${s}`,className:"text-sm text-gray-700",children:"Set as Head of Institution"})]})]})]}),c.members.length>1&&e.jsx("button",{type:"button",onClick:()=>ge(s),className:"absolute top-1 right-2 flex items-center gap-1 text-sm text-red-400 hover:text-red-800 font-medium transition-colors duration-200",children:e.jsx(Ge,{className:"text-2xl"})})]},s)),e.jsxs("div",{className:"flex justify-between items-center p-3",children:[p===null?e.jsxs("button",{type:"button",onClick:he,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800 font-medium mt-4 transition-colors duration-200",children:[e.jsx(Ye,{className:"text-2xl"}),e.jsx("span",{children:"Add Member"})]}):e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end items-center text-end mt-5 gap-4",children:[p===null&&e.jsxs(v,{type:"button",onClick:()=>H(),children:[e.jsx(We,{})," Reset"]}),e.jsxs(v,{className:"bg-blue-700 hover:bg-blue-400",type:"submit",children:[p?"Update":"Add"," ",e.jsx(Qe,{})]})]})]})]})}),S==="view"&&F?e.jsx(Pe,{person:F}):null]}),e.jsx(He,{isOpen:ae,onClose:()=>{N(!1)},onConfirm:Ne,residentId:A})]})]})}export{Jt as default};
