import{K as ge,r as o,m as ye,j as e,L as _e,S as U,a as V}from"./app-FQbzxGIw.js";import fe from"./ActionMenu-CzwL-S4C.js";import ve from"./BreadcrumbsHeader-BKQz8BHC.js";import je from"./DynamicTable-BMSA2BaJ.js";import{B as _}from"./button-9tywdtpe.js";import{I as we}from"./input-BxejiG4V.js";import{S as Ne}from"./AdminLayout-D681-fmM.js";import{I as ke,a as Se,b as Ce}from"./index-BtiFw4lQ.js";import{F as Oe}from"./FillterToggle-C5Vn0ru6.js";import Ee from"./DynamicTableControls-Dp8-Etap.js";import Re from"./PersonDetailContent-Bnjnk2Nd.js";import $e from"./SidebarModal-DD4dEoye.js";import{u as Te}from"./useAppUrl-zATTBKeL.js";import{I as Ae}from"./InputLabel-BRo6d_Ci.js";import{I as f}from"./InputField-DUwBnDWI.js";import{I as n}from"./InputError-BKQpvrj7.js";import{R as B}from"./RadioGroup-sRdtrAye.js";import{D as z}from"./DropdownInputField-D0XusS6V.js";import{t as C,T as De}from"./index-CMTh6Y7Z.js";import{T as Fe,W as Me,h as Le}from"./constants-0uClA9D3.js";import{u as Ye}from"./handleResidentChange-CLr1V6n4.js";import{S as x}from"./SelectField-B4xCJfut.js";import{Y as W}from"./YearDropdown-CrpNGByB.js";import Ie from"./DeleteConfirmationModal-B0Xpw4Vn.js";import{E as Ue}from"./ExportButton-tGc-eDMS.js";import{c as Ve}from"./createLucideIcon-CbmRPBK-.js";import{S as Be}from"./search-BMvlfdsT.js";import{L as ze}from"./list-plus-Dr4Qo9k_.js";import{R as We}from"./rotate-ccw-C8GY2dtN.js";import{E as Pe}from"./eye-CGiTKL0k.js";import{S as Xe}from"./square-pen-BPpyNhve.js";import{T as Ke}from"./trash-2-DbTjliIz.js";import"./dropdown-menu-Mj4r6j7K.js";import"./index-D9GFQlD6.js";import"./index-BvtReL5S.js";import"./floating-ui.react-dom-Bv5Tn9NB.js";import"./check-KP9WahT6.js";import"./chevron-right-KG4eDgaU.js";import"./tooltip-D5qIOJrT.js";import"./ellipsis-CzsbrfyR.js";import"./clsx-B-dksMZM.js";import"./breadcrumb-CZJEnQm8.js";import"./sidebar-kMsPs0kt.js";import"./x-SzE7BJuj.js";import"./skeleton-C5JXX0Vb.js";import"./nav-user-NQ1-22E_.js";import"./avatar-B4QdFqbk.js";import"./users-round-fHMLq3qJ.js";import"./chevron-up-D1MoY1rl.js";import"./iconBase-C4pIma2P.js";import"./index-DPWqtkCr.js";import"./index-BDSYX5a9.js";import"./file-output--5Kcqojd.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],Ge=Ve("briefcase",He);function Jt({occupations:P,puroks:X,queryParams:i=null,residents:O=[],occupationTypes:K=[]}){const H=[{label:"Residents Information",showOnMobile:!1},{label:"Residents Occupation",showOnMobile:!0}];i=i||{};const E=Te(),d=ge().props,v=(d==null?void 0:d.success)??null,j=(d==null?void 0:d.error)??null,[R,G]=o.useState(i.name??""),J=t=>{t.preventDefault(),w("name",R)},w=(t,a)=>{a&&a.trim()!==""?i[t]=a:delete i[t],i.page&&delete i.page,U.get(route("occupation.index",i))},Q=(t,a)=>{if(a.key==="Enter")w(t,a.target.value);else return},[Z,b]=o.useState(!1),[h,g]=o.useState(""),[c,$]=o.useState(null),[q,N]=o.useState(!1),[T,ee]=o.useState(null),k=Object.entries(i||{}).some(([t,a])=>["purok","employment_type","work_arrangement","occupation_status","is_ofw","year_started","year_ended","latest_occupation"].includes(t)&&a&&a!=="");o.useEffect(()=>{k&&D(!0)},[k]);const S=[{key:"id",label:"ID"},{key:"name",label:"Name"},{key:"occupation",label:"Occupation / Livelihood"},{key:"employment_type",label:"Employment Type"},{key:"work_arrangement",label:"Work Arrangement"},{key:"occupation_status",label:"Status"},{key:"started_at",label:"Year Started"},{key:"ended_at",label:"Year Ended"},{key:"is_ofw",label:"Is OFW?"},{key:"is_main",label:"Is Main Livelihood?"},{key:"purok_number",label:"Purok"},{key:"actions",label:"Actions"}],[A,D]=o.useState(k),[F,M]=o.useState(null),te=S.map(t=>t.key),[y,ae]=o.useState(()=>{const t=localStorage.getItem("occupation_visible_columns");return t?JSON.parse(t):te});o.useEffect(()=>{localStorage.setItem("occupation_visible_columns",JSON.stringify(y))},[y]);const se={id:t=>t.id,name:t=>{const{firstname:a,middlename:s,lastname:p,suffix:he}=t.resident??{};return`${a??""} ${s??""} ${p??""} ${he??""}`.trim()||"—"},occupation:t=>e.jsx("span",{className:"text-xs font-medium",children:t.occupation||"—"}),employment_type:t=>e.jsx("span",{className:"bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-md text-xs font-medium capitalize",children:Le[t.employment_type]||"—"}),work_arrangement:t=>e.jsx("span",{className:"bg-indigo-100 text-indigo-800 px-2 py-0.5 rounded-md text-xs font-medium capitalize",children:Me[t.work_arrangement]||"—"}),occupation_status:t=>{const a=t.occupation_status??"—",s=a==="active"?"bg-green-100 text-green-800":a==="inactive"?"bg-red-100 text-red-800":a==="retired"?"bg-gray-100 text-gray-700":a==="ended"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-700";return e.jsx("span",{className:`${s} px-2 py-0.5 rounded-md text-xs font-medium capitalize`,children:Fe[a]||a.replaceAll("_"," ")})},started_at:t=>e.jsx("span",{className:"text-xs text-gray-700",children:t.started_at??"—"}),ended_at:t=>e.jsx("span",{className:"text-xs text-gray-700",children:t.ended_at??"—"}),is_ofw:t=>e.jsx("span",{className:`px-2 py-0.5 rounded-md text-xs font-medium ${t.is_ofw?"bg-green-100 text-green-800":"bg-gray-100 text-gray-700"}`,children:t.is_ofw?"Yes":"No"}),is_main:t=>e.jsx("span",{className:`px-2 py-0.5 rounded-md text-xs font-medium ${t.is_main_livelihood?"bg-green-100 text-green-800":"bg-gray-100 text-gray-700"}`,children:t.is_main_livelihood?"Yes":"No"}),purok_number:t=>{var a;return e.jsx("span",{className:"text-xs text-gray-800",children:((a=t.resident)==null?void 0:a.purok_number)??"—"})},actions:t=>e.jsx(fe,{actions:[{label:"View",icon:e.jsx(Pe,{className:"w-4 h-4 text-indigo-600"}),onClick:()=>le(t.resident.id)},{label:"Edit",icon:e.jsx(Xe,{className:"w-4 h-4 text-green-500"}),onClick:()=>ce(t.id)},{label:"Delete",icon:e.jsx(Ke,{className:"w-4 h-4 text-red-600"}),onClick:()=>xe(t.id)}]})},le=async t=>{g("view"),M(null);try{const a=await V.get(`${E}/resident/showresident/${t}`);M(a.data.resident)}catch(a){console.error("Error fetching placeholders:",a)}b(!0)},oe=O.map(t=>({label:`${t.firstname} ${t.middlename} ${t.lastname} ${t.suffix??""}`,value:t.id.toString()})),{data:r,setData:u,post:L,errors:l,reset:Y,clearErrors:ne}=ye({resident_id:null,resident_name:"",resident_image:null,birthdate:null,purok_number:null,employment_status:null,occupations:[[]],_method:void 0,occupation_id:null}),ie=Ye(O,u),re=()=>{u("occupations",[...r.occupations||[],{}])},me=t=>{const a=[...r.occupations||[]];a.splice(t,1),u("occupations",a),C.warning("Occupation removed.",{duration:2e3})},m=(t,a,s)=>{const p=[...r.occupations||[]];p[a]={...p[a],[s]:t.target.value},u("occupations",p)},de=()=>{g("add"),b(!0)},ce=async t=>{g("add");try{const s=(await V.get(`${E}/occupation/details/${t}`)).data.occupation;console.log(s),$(s),u({resident_id:s.resident.id,resident_name:`${s.resident.firstname} ${s.resident.middlename??""} ${s.resident.lastname}`,resident_image:s.resident.image??null,birthdate:s.resident.birthdate??null,purok_number:s.resident.purok_number??null,employment_status:s.resident.employment_status,occupations:[{employer:s.employer||"",occupation:s.occupation||"",occupation_status:s.occupation_status||"",employment_type:s.employment_type||"",is_ofw:s.is_ofw?s.is_ofw.toString():"0",is_main_livelihood:s.is_main_livelihood?s.is_main_livelihood.toString():"0",work_arrangement:s.work_arrangement||"",income:s.monthly_income||0,income_frequency:"monthly",started_at:s.started_at||"",ended_at:s.ended_at||""}],_method:"PUT",occupation_id:s.id}),b(!0)}catch(a){console.error("Error fetching occupation details:",a)}},I=()=>{b(!1),g(""),$(null),Y(),ne()},ue=t=>{t.preventDefault(),L(route("occupation.store"),{onError:()=>{console.error("Validation Errors:",l)}})},pe=t=>{t.preventDefault(),L(route("occupation.update",r.occupation_id),{onError:()=>{console.error("Validation Errors:",l)}})},xe=t=>{ee(t),N(!0)},be=()=>{U.delete(route("occupation.destroy",T)),N(!1)};return o.useEffect(()=>{v&&(I(),C.success(v,{description:"Operation successful!",duration:3e3})),d.success=null},[v]),o.useEffect(()=>{j&&C.error(j,{description:"Operation failed!",duration:3e3,closeButton:!0}),d.error=null},[j]),e.jsxs(Ne,{children:[e.jsx(_e,{title:"Residents Occupations"}),e.jsx(ve,{breadcrumbs:H}),e.jsx(De,{richColors:!0}),e.jsx("div",{className:"p-2 md:p-4",children:e.jsx("div",{className:"mx-auto max-w-8xl px-2 sm:px-4 lg:px-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 shadow-sm rounded-xl sm:rounded-lg p-4 m-0",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl shadow-sm",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-full",children:e.jsx(Ge,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl md:text-2xl font-semibold text-gray-900",children:"Occupation Records"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Manage and track resident occupations, including employment type, work arrangement, and status. Use the tools below to",e.jsx("span",{className:"font-medium",children:" search, filter, and export"})," records for reporting and labor insights."]})]})]})}),e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-2 w-full mb-0",children:[e.jsxs("div",{className:"flex items-start gap-2 flex-wrap",children:[e.jsx(Ee,{allColumns:S,visibleColumns:y,setVisibleColumns:ae,showFilters:A,toggleShowFilters:()=>D(t=>!t)}),e.jsx(Ue,{url:"report/export-occupations-excel",queryParams:i,label:"Export Resident Occupations as XLSX"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[e.jsxs("form",{onSubmit:J,className:"flex w-[300px] max-w-lg items-center space-x-1",children:[e.jsx(we,{type:"text",placeholder:"Search Name",value:R,onChange:t=>G(t.target.value),onKeyDown:t=>Q("name",t),className:"w-full"}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(_,{type:"submit",className:"border active:bg-blue-900 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white flex items-center gap-2 bg-transparent",variant:"outline",children:e.jsx(Be,{})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Search"})]})]}),e.jsxs("div",{className:"relative group z-50",children:[e.jsx(_,{variant:"outline",className:"flex items-center gap-2 border-blue-300 text-blue-700 hover:bg-blue-600 hover:text-white",onClick:de,children:e.jsx(ze,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 mt-2 w-max px-3 py-1.5 rounded-md bg-blue-700 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-10",children:"Add an Occupation"})]})]})]}),A&&e.jsx(Oe,{queryParams:i,searchFieldName:w,visibleFilters:["purok","employment_type","work_arrangement","occupation_status","is_ofw","year_started","year_ended","latest_occupation"],puroks:X,showFilters:!0,clearRouteName:"occupation.index",clearRouteParams:{}}),e.jsx(je,{passedData:P,allColumns:S,columnRenderers:se,queryParams:i,visibleColumns:y,showTotal:!0})]})})}),e.jsxs($e,{isOpen:Z,onClose:()=>{I()},title:h==="add"&&c?"Edit Occupation":h==="add"?"Add Occupation":"View Resident",children:[h==="add"&&e.jsx("div",{className:"w-full rounded-xl border border-white/20 bg-white/10 backdrop-blur-md shadow-lg text-sm text-black p-4 space-y-4",children:e.jsxs("form",{onSubmit:c?pe:ue,children:[e.jsx("h3",{className:"text-xl font-medium text-gray-700 mb-8",children:"Resident's Info"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-y-2 md:gap-x-4 mb-5 w-full",children:[e.jsxs("div",{className:"md:row-span-2 md:col-span-2 flex flex-col items-center space-y-2",children:[e.jsx(Ae,{htmlFor:"resident_image",value:"Profile Photo"}),e.jsx("img",{src:r.resident_image?`/storage/${r.resident_image}`:"/images/default-avatar.jpg",alt:"Resident Image",className:"w-32 h-32 object-cover rounded-full border border-gray-200"})]}),e.jsxs("div",{className:"md:col-span-4 space-y-2",children:[e.jsxs("div",{className:"w-full",children:[e.jsx(z,{label:"Full Name",name:"resident_name",value:r.resident_name||"",placeholder:"Select a resident",onChange:t=>ie(t),items:oe,readOnly:c}),e.jsx(n,{message:l.resident_id,className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx(f,{label:"Birthdate",name:"birthdate",value:r.birthdate||"",readOnly:!0})}),e.jsx("div",{children:e.jsx(f,{label:"Purok Number",name:"purok_number",value:r.purok_number,readOnly:!0})})]}),e.jsxs("div",{className:"w-[200px] mb-4",children:[e.jsx(x,{label:"Current Employment Status",name:"employment_status",value:r.employment_status||"",onChange:t=>u("employment_status",t.target.value),items:[{label:"Employed",value:"employed"},{label:"Unemployed",value:"unemployed"},{label:"Underemployed",value:"under_employed"},{label:"Retired",value:"retired"},{label:"Student",value:"student"}]}),e.jsx(n,{message:l.employment_status,className:"mt-2"})]})]})]}),Array.isArray(r.occupations)&&r.occupations.map((t,a)=>e.jsxs("div",{className:"border p-4 mb-4 rounded-md relative bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(z,{label:"Occupation",name:"occupation",value:t.occupation||"",onChange:s=>m(s,a,"occupation"),placeholder:"Select or Enter Occupation",items:K,disabled:t.employment_status==="unemployed"}),e.jsx(n,{message:l[`occupations.${a}.occupation`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(x,{label:"Employment Type",name:"employment_type",value:t.employment_type||"",onChange:s=>m(s,a,"employment_type"),items:[{label:"Full-time",value:"full_time"},{label:"Part-time",value:"part_time"},{label:"Seasonal",value:"seasonal"},{label:"Contractual",value:"contractual"},{label:"Self-employed",value:"self_employed"}]}),e.jsx(n,{message:l[`occupations.${a}.employment_type`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(x,{label:"Occupation Status",name:"occupation_status",value:t.occupation_status||"",onChange:s=>m(s,a,"occupation_status"),items:[{label:"Active",value:"active"},{label:"Inactive",value:"inactive"},{label:"Ended",value:"ended"},{label:"Retired",value:"retired"},{label:"Terminated",value:"terminated"},{label:"Resigned",value:"resigned"}]}),e.jsx(n,{message:l[`occupations.${a}.occupation_status`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(x,{label:"Work Arrangement",name:"work_arrangement",items:[{label:"Remote",value:"remote"},{label:"On-site",value:"on_site"},{label:"Hybrid",value:"hybrid"}],value:t.work_arrangement||"",onChange:s=>m(s,a,"work_arrangement")}),e.jsx(n,{message:l[`occupations.${a}.work_arrangement`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(f,{label:"Employer name",name:"employer",type:"text",value:t.employer||"",onChange:s=>m(s,a,"employer"),placeholder:"Enter employer name"}),e.jsx(n,{message:l[`occupations.${a}.employer`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(W,{label:"Year Started",name:"started_at",value:t.started_at||"",onChange:s=>m(s,a,"started_at")}),e.jsx(n,{message:l[`occupations.${a}.started_at`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(W,{label:"Year Ended",name:"ended_at",value:t.ended_at||"",onChange:s=>m(s,a,"ended_at"),disabled:t.occupation_status==="active"}),e.jsx(n,{message:l[`occupations.${a}.ended_at`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(f,{type:"number",label:"Income",name:"income",value:t.income||"",onChange:s=>m(s,a,"income"),placeholder:"Enter Income"}),e.jsx(n,{message:l[`occupations.${a}.income`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(x,{label:"Income Frequency",name:"income_frequency",value:t.income_frequency||"",onChange:s=>m(s,a,"income_frequency"),items:[{label:"Daily",value:"daily"},{label:"Bi-weekly",value:"bi_weekly"},{label:"Weekly",value:"weekly"},{label:"Monthly",value:"monthly"},{label:"Annually",value:"annually"}]}),e.jsx(n,{message:l[`occupations.${a}.income_frequency`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(B,{label:"Overseas Filipino Worker",name:"is_ofw",selectedValue:t.is_ofw||"",options:[{label:"Yes",value:1},{label:"No",value:0}],onChange:s=>m(s,a,"is_ofw")}),e.jsx(n,{message:l[`occupations.${a}.is_ofw`],className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(B,{label:"Is Main Livelihood",name:"is_main_livelihood",selectedValue:t.is_main_livelihood||"",options:[{label:"Yes",value:1},{label:"No",value:0}],onChange:s=>m(s,a,"is_main_livelihood")}),e.jsx(n,{message:l[`occupations.${a}.is_main_livelihood`],className:"mt-2"})]})]}),c===null&&e.jsx("button",{type:"button",onClick:()=>me(a),className:"absolute top-1 right-2 flex items-center gap-1 text-sm text-red-400 hover:text-red-800 font-medium mt-1 mb-5 transition-colors duration-200",children:e.jsx(ke,{className:"text-2xl"})})]},a)),e.jsxs("div",{className:"flex justify-between items-center p-3",children:[c===null?e.jsxs("button",{type:"button",onClick:re,className:"flex items-center gap-1 text-sm text-blue-600 hover:text-blue-800 font-medium mt-4 transition-colors duration-200",children:[e.jsx(Se,{className:"text-2xl"}),e.jsx("span",{children:"Add Occupation"})]}):e.jsx("div",{}),e.jsxs("div",{className:"flex justify-end items-center text-end mt-5 gap-4",children:[c==null&&e.jsxs(_,{type:"button",onClick:()=>Y(),children:[e.jsx(We,{})," Reset"]}),e.jsxs(_,{className:"bg-blue-700 hover:bg-blue-400 ",type:"submit",children:[c?"Update":"Add"," ",e.jsx(Ce,{})]})]})]})]})}),h==="view"&&F?e.jsx(Re,{person:F}):null]}),e.jsx(Ie,{isOpen:q,onClose:()=>{N(!1)},onConfirm:be,residentId:T})]})}export{Jt as default};
